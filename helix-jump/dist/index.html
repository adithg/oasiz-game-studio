<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no, minimal-ui">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Helix Jump</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            overflow: hidden;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            font-family: 'Outfit', sans-serif;
            touch-action: none;
            user-select: none;
            -webkit-user-select: none;
        }

        #game-container {
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
        }

        /* Overlays */

        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
            transition: opacity 0.4s ease, visibility 0.4s ease;
            pointer-events: none;
        }

        .overlay.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .overlay:not(.hidden) {
            pointer-events: auto;
        }

        .content {
            text-align: center;
            padding: 40px;
            max-width: 90%;
        }

        /* Title */

        .game-title {
            font-size: 3.5rem;
            font-weight: 800;
            background: linear-gradient(90deg, #FF6B6B, #FFE66D, #4ECDC4, #FF6B6B);
            background-size: 300% 100%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: 2px;
            margin-bottom: 8px;
            text-transform: uppercase;
            animation: gradientShift 4s ease-in-out infinite;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .subtitle {
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.5);
            margin-bottom: 40px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 4px;
        }

        /* Score Display */

        .score-display {
            position: absolute;
            top: 50px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 5;
            text-align: center;
            pointer-events: none;
        }

        .current-score {
            font-size: 4rem;
            font-weight: 800;
            color: rgba(255, 255, 255, 0.9);
            text-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            line-height: 1;
        }

        .current-score.bump {
            animation: scoreBump 0.2s ease-out;
        }

        @keyframes scoreBump {
            0% { transform: scale(1); }
            50% { transform: scale(1.15); }
            100% { transform: scale(1); }
        }

        .combo-display {
            font-size: 1.2rem;
            font-weight: 600;
            color: #FFE66D;
            opacity: 0;
            transform: scale(0.8);
            transition: all 0.2s ease;
            text-shadow: 0 0 20px rgba(255, 230, 109, 0.5);
        }

        .combo-display.active {
            opacity: 1;
            transform: scale(1);
            animation: comboPulse 0.5s ease-out;
        }

        @keyframes comboPulse {
            0% { transform: scale(0.5); text-shadow: 0 0 20px rgba(255, 230, 109, 0.5); }
            50% { transform: scale(1.2); text-shadow: 0 0 40px rgba(255, 230, 109, 0.8); }
            100% { transform: scale(1); text-shadow: 0 0 20px rgba(255, 230, 109, 0.5); }
        }

        @media (pointer: coarse) {
            .score-display {
                top: 130px;
            }
        }

        /* Buttons */

        .btn {
            background: linear-gradient(135deg, #FF6B6B 0%, #FF8E53 100%);
            color: #fff;
            border: none;
            padding: 18px 60px;
            font-family: 'Outfit', sans-serif;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            border-radius: 50px;
            box-shadow: 0 8px 30px rgba(255, 107, 107, 0.4);
            transition: all 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 40px rgba(255, 107, 107, 0.5);
        }

        .btn:active {
            transform: translateY(1px);
            box-shadow: 0 4px 20px rgba(255, 107, 107, 0.3);
        }

        .start-btn {
            animation: buttonPulse 2s ease-in-out infinite;
            position: relative;
            overflow: hidden;
        }

        .start-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            animation: shimmer 2.5s ease-in-out infinite;
        }

        @keyframes buttonPulse {
            0%, 100% { box-shadow: 0 8px 30px rgba(255, 107, 107, 0.4); }
            50% { box-shadow: 0 8px 50px rgba(255, 107, 107, 0.7); }
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        /* Top Buttons */

        .top-btn {
            position: absolute;
            top: 45px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            z-index: 15;
            backdrop-filter: blur(10px);
        }

        .top-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }

        .top-btn svg {
            width: 24px;
            height: 24px;
            fill: rgba(255, 255, 255, 0.8);
        }

        .settings-btn {
            right: 16px;
        }

        .pause-btn {
            left: 16px;
        }

        @media (pointer: coarse) {
            .top-btn {
                top: 120px;
            }
            .settings-btn {
                right: max(16px, env(safe-area-inset-right, 16px));
            }
            .pause-btn {
                left: max(16px, env(safe-area-inset-left, 16px));
            }
        }

        /* Start Screen */

        .ball-preview {
            width: 80px;
            height: 80px;
            margin: 30px auto;
            background: linear-gradient(135deg, #FF6B6B 0%, #FF8E53 100%);
            border-radius: 50%;
            box-shadow: 0 10px 40px rgba(255, 107, 107, 0.5), inset 0 -10px 20px rgba(0, 0, 0, 0.2), inset 0 10px 20px rgba(255, 255, 255, 0.3);
            animation: ballBounce 1.5s ease-in-out infinite;
        }

        @keyframes ballBounce {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-20px) scale(1.05); }
        }

        .start-btn {
            margin-top: 40px;
        }

        .best-score-container {
            margin-bottom: 20px;
        }

        .best-label {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.4);
            text-transform: uppercase;
            letter-spacing: 3px;
            margin-bottom: 4px;
        }

        .best-value {
            font-size: 2.5rem;
            font-weight: 800;
            color: rgba(255, 255, 255, 0.6);
        }

        /* Game Over Screen */

        .game-over-overlay {
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
        }

        .game-over-title {
            font-size: 2.5rem;
            font-weight: 800;
            color: #FF6B6B;
            letter-spacing: 2px;
            margin-bottom: 20px;
            text-transform: uppercase;
            animation: slideDown 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) both;
        }

        @keyframes slideDown {
            0% { transform: translateY(-50px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }

        .final-score-container {
            margin: 30px 0;
            animation: popIn 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) 0.1s both;
        }

        @keyframes popIn {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .final-score-label {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.4);
            text-transform: uppercase;
            letter-spacing: 3px;
            margin-bottom: 8px;
        }

        .final-score {
            font-size: 5rem;
            font-weight: 800;
            background: linear-gradient(135deg, #FF6B6B 0%, #FFE66D 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .new-best {
            display: inline-block;
            background: linear-gradient(135deg, #FFE66D 0%, #FF6B6B 100%);
            color: #1a1a2e;
            padding: 10px 24px;
            border-radius: 30px;
            font-size: 0.9rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-top: 12px;
            animation: badgePulse 1.5s ease-in-out infinite;
        }

        @keyframes badgePulse {
            0%, 100% { transform: scale(1) rotate(-2deg); }
            50% { transform: scale(1.05) rotate(2deg); }
        }

        .game-over-buttons {
            display: flex;
            gap: 16px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 30px;
            animation: slideUp 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) 0.2s both;
        }

        @keyframes slideUp {
            0% { transform: translateY(50px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }

        .btn-secondary {
            background: transparent;
            color: rgba(255, 255, 255, 0.7);
            border: 2px solid rgba(255, 255, 255, 0.3);
            box-shadow: none;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
            box-shadow: none;
        }

        /* Settings Modal */

        .settings-modal {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, rgba(30, 30, 50, 0.95) 0%, rgba(20, 20, 40, 0.95) 100%);
            border-radius: 24px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            padding: 30px 40px;
            z-index: 100;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            min-width: 300px;
            backdrop-filter: blur(20px);
        }

        .settings-modal.hidden {
            display: none;
        }

        .settings-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #fff;
            margin-bottom: 24px;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .settings-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .settings-row:last-of-type {
            border-bottom: none;
        }

        .settings-label {
            font-size: 1rem;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.8);
        }

        .toggle {
            width: 56px;
            height: 30px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            position: relative;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .toggle.active {
            background: linear-gradient(135deg, #4ECDC4 0%, #44CF6C 100%);
        }

        .toggle::after {
            content: '';
            position: absolute;
            width: 24px;
            height: 24px;
            background: #fff;
            border-radius: 50%;
            top: 3px;
            left: 3px;
            transition: transform 0.2s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .toggle.active::after {
            transform: translateX(26px);
        }

        .settings-close {
            margin-top: 24px;
            width: 100%;
        }

        /* Pause Menu */

        .pause-menu {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
        }

        .pause-menu .content {
            background: linear-gradient(135deg, rgba(30, 30, 50, 0.95) 0%, rgba(20, 20, 40, 0.95) 100%);
            border-radius: 24px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .pause-title {
            font-size: 2rem;
            font-weight: 700;
            color: #fff;
            margin-bottom: 24px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .pause-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .pause-buttons .btn {
            width: 100%;
        }

        /* Tap instruction */

        .tap-instruction {
            position: absolute;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255, 255, 255, 0.4);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 3px;
            display: flex;
            align-items: center;
            gap: 12px;
            animation: fadeInOut 2s ease-in-out infinite;
        }

        .tap-instruction svg {
            width: 24px;
            height: 24px;
            fill: rgba(255, 255, 255, 0.4);
        }

        @keyframes fadeInOut {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 0.8; }
        }

        /* Mobile adjustments */

        @media (pointer: coarse) {
            .game-title {
                font-size: 2.5rem;
            }
            .content {
                padding: 28px;
            }
            .btn {
                padding: 16px 48px;
                font-size: 1rem;
            }
        }

        @media (max-height: 600px) {
            .content {
                padding: 20px;
            }
            .game-title {
                font-size: 2rem;
            }
            .ball-preview {
                width: 60px;
                height: 60px;
                margin: 20px auto;
            }
        }

        .hidden {
            display: none !important;
        }
    </style>
  <script type="module" crossorigin>(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const r of l.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function o(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerPolicy&&(l.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?l.credentials="include":s.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function a(s){if(s.ep)return;s.ep=!0;const l=o(s);fetch(s.href,l)}})();const i={BALL_RADIUS:22,BALL_GRAVITY:.5,BALL_BOUNCE_VY:-13,BALL_MAX_VY:18,TOWER_RADIUS:.38,PILLAR_RADIUS:.08,RING_SPACING:70,SEGMENTS_PER_RING:12,RING_HEIGHT:25,GAP_MIN:2,GAP_MAX:4,DANGER_CHANCE:.15,INITIAL_RINGS:50,CAMERA_SMOOTHING:.08,ROTATION_SPEED:.004,KEYBOARD_ROTATION_SPEED:.05,PERSPECTIVE_RATIO:.4,SCALE_PER_RING:.03,VISIBLE_RINGS_BELOW:12,RING_COLOR:"#4A4A5A",RING_SIDE_COLOR:"#3A3A4A",RING_HIGHLIGHT:"#5A5A6A",DANGER_COLOR:"#E74C3C",DANGER_SIDE_COLOR:"#C0392B",PILLAR_COLOR:"#F5F5F5",PARTICLE_COUNT:12,PARTICLE_LIFE:500,COMBO_TIMEOUT:1500};function x(e,t,o){return e+(t-e)*o}function Re(e,t){return e+Math.random()*(t-e)}const G=document.getElementById("gameCanvas"),n=G.getContext("2d");document.getElementById("game-container");const Le=document.getElementById("startScreen"),re=document.getElementById("gameOverScreen"),W=document.getElementById("pauseScreen"),ue=document.getElementById("settingsModal"),Ne=document.getElementById("settingsBtn"),Z=document.getElementById("pauseBtn"),ce=document.getElementById("scoreDisplay"),q=document.getElementById("currentScore"),H=document.getElementById("comboDisplay"),Te=document.getElementById("startBestScore"),Oe=document.getElementById("finalScore"),ge=document.getElementById("newBestBadge");let g="START",R=window.innerWidth,m=window.innerHeight;window.matchMedia("(pointer: coarse)").matches;let A=[],E=0,N=R*i.TOWER_RADIUS,T=0,C=0,b=0,k=0,ae=0,y=0,D=parseInt(localStorage.getItem("helixJump_bestScore")||"0"),I=0,se=0,Y=[],X=[],M=[],U=1,z=1,j=0,O=0,fe="#FFE66D",Q=[],w=0,Be=.9,d={music:localStorage.getItem("helixJump_music")!=="false",fx:localStorage.getItem("helixJump_fx")!=="false",haptics:localStorage.getItem("helixJump_haptics")!=="false"},v=new Set,B=!1,F=0,V=0;const J=[{top:"#1a1a2e",bottom:"#16213e"},{top:"#16213e",bottom:"#0f3460"},{top:"#0f3460",bottom:"#1a1a4e"},{top:"#1a1a4e",bottom:"#2d1b4e"},{top:"#2d1b4e",bottom:"#4a1942"},{top:"#4a1942",bottom:"#1a4a4a"},{top:"#1a4a4a",bottom:"#1a2a3a"}];function ye(e){const t=[],o=Math.floor(Re(i.GAP_MIN,i.GAP_MAX+1)),a=Math.floor(Math.random()*i.SEGMENTS_PER_RING);for(let s=0;s<i.SEGMENTS_PER_RING;s++){let l=!1;for(let r=0;r<o;r++)if((a+r)%i.SEGMENTS_PER_RING===s){l=!0;break}l?t.push({type:"gap"}):Math.random()<i.DANGER_CHANCE?t.push({type:"danger"}):t.push({type:"solid"})}return{y:e,segments:t,passed:!1}}function ve(e,t){const o=[],a=Math.floor(Re(i.GAP_MIN,i.GAP_MAX+1));for(let s=0;s<i.SEGMENTS_PER_RING;s++){let l=!1;for(let r=0;r<a;r++)if((t+r)%i.SEGMENTS_PER_RING===s){l=!0;break}l?o.push({type:"gap"}):Math.random()<i.DANGER_CHANCE?o.push({type:"danger"}):o.push({type:"solid"})}return{y:e,segments:o,passed:!1}}function _e(){A=[],A.push(ve(200,0));for(let e=1;e<i.INITIAL_RINGS;e++)A.push(ye(e*i.RING_SPACING+200));console.log("[generateInitialRings] Generated",A.length,"rings")}function xe(){if(A.length===0)return;const e=A[A.length-1],t=Math.ceil((k+m*2)/i.RING_SPACING)-A.length;for(let o=0;o<t+5;o++){const a=e.y+i.RING_SPACING*(o+1);A.push(ye(a))}}function ne(e,t,o,a){X.push({x:e,y:t,text:o,life:1e3,maxLife:1e3,color:a,scale:.5})}function me(e){for(let t=X.length-1;t>=0;t--){const o=X[t];o.y-=1.5,o.life-=e,o.scale=Math.min(1.2,o.scale+.05),o.life<=0&&X.splice(t,1)}}function we(){for(const e of X){const t=e.life/e.maxLife;n.save(),n.translate(e.x,e.y),n.scale(e.scale,e.scale),n.font="bold 28px Outfit",n.textAlign="center",n.textBaseline="middle",n.fillStyle="rgba(0, 0, 0, "+t*.5+")",n.fillText(e.text,2,2),n.fillStyle=e.color.replace(")",", "+t+")").replace("rgb","rgba"),n.fillText(e.text,0,0),n.restore()}}function De(){const e=Date.now()/1e3;for(const t of Q){const o=(t.y-k*.1)%(m*2),a=o<0?o+m*2:o,s=.3+.4*Math.sin(e*2+t.twinkle);n.beginPath(),n.arc(t.x,a,t.size,0,Math.PI*2),n.fillStyle="rgba(255, 255, 255, "+s+")",n.fill()}}function Ye(){const e=Math.max(0,k),t=Math.floor(e/1e3)%J.length,o=(t+1)%J.length,a=e%1e3/1e3,s=J[t],l=J[o],r=n.createLinearGradient(0,0,0,m);r.addColorStop(0,s.top),r.addColorStop(1,ke(s.bottom,l.bottom,a)),n.fillStyle=r,n.fillRect(0,0,R,m),Q.length>0&&De(),O>0&&(n.fillStyle=fe.replace(")",", "+O+")").replace("#","rgba(").replace(/^rgba\(/,function(){const c=fe,p=parseInt(c.slice(1,3),16),f=parseInt(c.slice(3,5),16),u=parseInt(c.slice(5,7),16);return"rgba("+p+", "+f+", "+u+", "+O+")"}),n.fillStyle="rgba(255, 230, 109, "+O+")",n.fillRect(0,0,R,m),O*=.92,O<.01&&(O=0))}function ke(e,t,o){const a=parseInt(e.slice(1,3),16),s=parseInt(e.slice(3,5),16),l=parseInt(e.slice(5,7),16),r=parseInt(t.slice(1,3),16),c=parseInt(t.slice(3,5),16),p=parseInt(t.slice(5,7),16),f=Math.round(x(a,r,o)),u=Math.round(x(s,c,o)),h=Math.round(x(l,p,o));return"#"+[f,u,h].map(_=>_.toString(16).padStart(2,"0")).join("")}function Fe(){const e=R/2,t=N*i.PILLAR_RADIUS/i.TOWER_RADIUS,o=0,a=m,s=t*1.1,l=t*.7,r=n.createLinearGradient(e-t,0,e+t,0);r.addColorStop(0,"#D0D0D5"),r.addColorStop(.3,"#E8E8EC"),r.addColorStop(.5,i.PILLAR_COLOR),r.addColorStop(.7,"#E8E8EC"),r.addColorStop(1,"#D0D0D5"),n.beginPath(),n.moveTo(e-s,o),n.lineTo(e+s,o),n.lineTo(e+l,a),n.lineTo(e-l,a),n.closePath(),n.fillStyle=r,n.fill(),n.strokeStyle="rgba(180, 180, 190, 0.6)",n.lineWidth=1,n.beginPath(),n.moveTo(e-s,o),n.lineTo(e-l,a),n.stroke(),n.beginPath(),n.moveTo(e+s,o),n.lineTo(e+l,a),n.stroke()}function Pe(e,t){const o=(e-t)/i.RING_SPACING;if(o<-2||o>i.VISIBLE_RINGS_BELOW)return{screenY:0,scale:0,visible:!1};const s=m*.25+o*55,l=Math.max(.5,1-o*i.SCALE_PER_RING);return{screenY:s,scale:l,visible:s<m+100}}function Ve(e,t){const o=R/2,{screenY:a,scale:s,visible:l}=Pe(e.y,t);if(!l)return;const r=N*s,c=N*(i.PILLAR_RADIUS/i.TOWER_RADIUS)*s*1.1,p=i.RING_HEIGHT*s,f=i.PERSPECTIVE_RATIO,u=Math.PI*2/i.SEGMENTS_PER_RING;for(let h=0;h<i.SEGMENTS_PER_RING;h++){const _=e.segments[h];if(_.type==="gap")continue;const L=h*u+E,P=L+u,be=(L+P)/2,Ce=Math.sin(be)>-.3;let $,ee,te;_.type==="danger"?($=i.DANGER_COLOR,ee=i.DANGER_SIDE_COLOR,te="#FF6B6B"):($=i.RING_COLOR,ee=i.RING_SIDE_COLOR,te=i.RING_HIGHLIGHT),Ce&&(n.save(),n.translate(o,a+p*f),n.scale(1,f),n.beginPath(),n.arc(0,0,r,L,P),n.restore(),n.save(),n.translate(o,a),n.scale(1,f),n.arc(0,0,r,P,L,!0),n.closePath(),n.fillStyle=ee,n.fill(),n.restore()),n.save(),n.translate(o,a),n.scale(1,f),n.beginPath(),n.arc(0,0,r,L,P),n.arc(0,0,c,P,L,!0),n.closePath(),n.fillStyle=$,n.fill(),n.strokeStyle=te,n.lineWidth=2*s,n.beginPath(),n.arc(0,0,r-1,L+.02,P-.02),n.stroke(),n.restore()}}function Xe(){const e=R/2,t=m*.25,o=N*.75,a=e+Math.cos(b+E)*o,s=Math.sin(b+E)*o*i.PERSPECTIVE_RATIO*.5;M.unshift({x:a,y:t+s,alpha:1});for(let l=M.length-1;l>=0;l--)M[l].alpha*=.85,M[l].alpha<.05&&M.splice(l,1);M.length>15&&M.pop()}function He(){for(let e=M.length-1;e>=0;e--){const t=M[e],o=i.BALL_RADIUS*(.3+.5*t.alpha);n.beginPath(),n.arc(t.x,t.y,o,0,Math.PI*2),n.fillStyle="rgba(255, 142, 83, "+t.alpha*.4+")",n.fill()}}function Ue(){const e=C/i.BALL_MAX_VY,t=Math.floor(e*8),o=R/2,a=T-k;n.save(),n.strokeStyle="rgba(255, 255, 255, "+e*.3+")",n.lineWidth=2,n.lineCap="round";for(let s=0;s<t;s++){const r=Math.floor(Math.random()*2)===0?o-N*1.5-Math.random()*50:o+N*1.5+Math.random()*50,c=a-100+Math.random()*200,p=30+Math.random()*50;n.beginPath(),n.moveTo(r,c),n.lineTo(r+(Math.random()-.5)*10,c-p),n.stroke()}n.restore()}function ze(){const e=R/2,t=m*.25,o=N*.75,a=e+Math.cos(b+E)*o,s=Math.sin(b+E)*o*i.PERSPECTIVE_RATIO*.5,l=t+s,r=i.BALL_RADIUS;He(),n.save(),n.translate(a,l),n.scale(U,z),n.translate(-a,-l),n.beginPath(),n.ellipse(a+4,l+r*1.5,r*.8,r*.3,0,0,Math.PI*2),n.fillStyle="rgba(0, 0, 0, 0.35)",n.fill();const c=n.createRadialGradient(a-r*.3,l-r*.3,0,a,l,r);c.addColorStop(0,"#FFD93D"),c.addColorStop(.5,"#FF9F1C"),c.addColorStop(1,"#E8890C"),n.beginPath(),n.arc(a,l,r,0,Math.PI*2),n.fillStyle=c,n.fill(),n.beginPath(),n.arc(a-r*.3,l-r*.35,r*.25,0,Math.PI*2),n.fillStyle="rgba(255, 255, 255, 0.8)",n.fill(),n.restore();const p=I>1?2.5+I*.2:1.8,f=I>1?.5+I*.05:.4;n.beginPath(),n.arc(a,l,r*p,0,Math.PI*2);const u=n.createRadialGradient(a,l,r,a,l,r*p);if(I>1){const h=Date.now()/10%360;u.addColorStop(0,"hsla("+h+", 80%, 60%, "+f+")"),u.addColorStop(.5,"hsla("+(h+60)%360+", 80%, 60%, "+f*.5+")"),u.addColorStop(1,"hsla("+(h+120)%360+", 80%, 60%, 0)")}else u.addColorStop(0,"rgba(255, 107, 107, "+f+")"),u.addColorStop(1,"rgba(255, 107, 107, 0)");n.fillStyle=u,n.fill()}function We(e,t,o,a){const l=o,r=o*.4;n.save(),n.globalAlpha=a,n.fillStyle="#FFE66D",n.beginPath();for(let c=0;c<8;c++){const p=c%2===0?l:r,f=c*Math.PI/4-Math.PI/2,u=e+Math.cos(f)*p,h=t+Math.sin(f)*p;c===0?n.moveTo(u,h):n.lineTo(u,h)}n.closePath(),n.fill(),n.restore()}function qe(){for(const e of Y){const t=e.life/e.maxLife;if(e.type==="star"){const o=.7+.3*Math.sin(Date.now()/50+e.x);We(e.x,e.y,e.size*t*1.5,t*o)}else n.beginPath(),n.arc(e.x,e.y,e.size*t,0,Math.PI*2),n.fillStyle=e.color.replace(")",", "+t+")").replace("rgb","rgba"),n.fill()}}function he(e,t,o){for(let a=0;a<i.PARTICLE_COUNT;a++){const s=Math.PI*2*a/i.PARTICLE_COUNT+Math.random()*.5,l=2+Math.random()*4;Y.push({x:e,y:t,vx:Math.cos(s)*l,vy:Math.sin(s)*l-3,life:i.PARTICLE_LIFE,maxLife:i.PARTICLE_LIFE,size:4+Math.random()*4,color:o,type:"bounce"})}for(let a=0;a<5;a++)Y.push({x:e+(Math.random()-.5)*40,y:t,vx:(Math.random()-.5)*2,vy:-4-Math.random()*3,life:800,maxLife:800,size:3+Math.random()*3,color:"#FFE66D",type:"star"})}function pe(e){for(let t=Y.length-1;t>=0;t--){const o=Y[t];o.x+=o.vx,o.y+=o.vy,o.vy+=.15,o.life-=e,o.life<=0&&Y.splice(t,1)}}function Je(){console.log("[resetGame] Starting new game"),y=0,I=0,se=0,T=100,C=2,b=0,E=0,k=0,ae=0,Y=[],X=[],M=[],U=1,z=1,O=0,w=0,Q=[];for(let e=0;e<100;e++)Q.push({x:Math.random()*R,y:Math.random()*m*3,size:1+Math.random()*2,twinkle:Math.random()*Math.PI*2});_e(),ie()}function ie(){q.textContent=y.toString(),q.classList.remove("bump"),q.offsetWidth,q.classList.add("bump"),I>1?(H.textContent="COMBO x"+I,H.classList.remove("active"),H.offsetWidth,H.classList.add("active")):H.classList.remove("active")}function Ke(){const e=T+i.BALL_RADIUS;for(const t of A){if(t.passed||t.y<T-50||t.y>T+i.RING_SPACING*2)continue;const o=t.y,a=t.y+i.RING_THICKNESS;if(e>=o&&T<=a&&C>0){const s=((b+E)%(Math.PI*2)+Math.PI*2)%(Math.PI*2),l=Math.PI*2/i.SEGMENTS_PER_RING,r=Math.floor(s/l),c=t.segments[r];if(c.type==="gap"){if(!t.passed){t.passed=!0;const p=Date.now(),f=R/2,{y:u,scale:h}=depthToScreen(t.y),_=N*h*.85,L=f+Math.cos(b+E)*_,P=u+Math.sin(b+E)*_*i.PERSPECTIVE_TILT;p-se<i.COMBO_TIMEOUT&&I>0?(I++,y+=I,console.log("[checkCollisions] Combo!",I,"Score:",y),O=.15+I*.05,ne(L,P-30,"+"+I+" COMBO!","rgb(255, 230, 109)"),he(L,P,"rgb(255, 230, 109)"),d.haptics&&S("medium"),d.fx&&et(I)):(y++,I=1,ne(L,P-30,"+1","rgb(78, 205, 196)")),ie()}}else if(c.type==="danger"){console.log("[checkCollisions] Hit danger segment! Game over."),w=20,Ge();return}else{T=o-i.BALL_RADIUS,C=i.BALL_BOUNCE_VY,se=Date.now(),I=0,U=1.3,z=.7,j=150;const p=R/2,{y:f,scale:u}=depthToScreen(t.y),h=N*u*.85,_=p+Math.cos(b+E)*h,L=f+Math.sin(b+E)*h*i.PERSPECTIVE_TILT;t.passed||(t.passed=!0,y++,ie(),ne(_,L-30,"+1","rgb(255, 255, 255)")),he(_,L,"rgb(255, 255, 255)"),d.haptics&&S("light"),d.fx&&$e(),console.log("[checkCollisions] Bounce! Score:",y);break}}}}function je(e){C+=i.BALL_GRAVITY,C=Math.min(C,i.BALL_MAX_VY),T+=C,ae=T-m*i.CAMERA_OFFSET,k=x(k,ae,i.CAMERA_SMOOTHING),Ke(),A.length>0&&T>A[A.length-1].y-m&&xe();const t=A.find(o=>!o.passed&&o.y>T);t&&T>t.y+m&&(console.log("[updateBall] Ball fell too far. Game over."),Ge())}function Qe(e){B||(E+=V,V*=.92),(v.has("ArrowLeft")||v.has("a")||v.has("A"))&&(E-=i.KEYBOARD_ROTATION_SPEED),(v.has("ArrowRight")||v.has("d")||v.has("D"))&&(E+=i.KEYBOARD_ROTATION_SPEED)}function Ze(){if(w>.1){const e=(Math.random()-.5)*w,t=(Math.random()-.5)*w;n.translate(e,t),w*=Be}else w=0}let oe=null;function de(){return oe||(oe=new AudioContext),oe}function $e(){if(d.fx)try{const e=de(),t=e.createOscillator(),o=e.createGain();t.connect(o),o.connect(e.destination),t.type="sine",t.frequency.setValueAtTime(600,e.currentTime),t.frequency.exponentialRampToValueAtTime(400,e.currentTime+.1),o.gain.setValueAtTime(.3,e.currentTime),o.gain.exponentialRampToValueAtTime(.01,e.currentTime+.1),t.start(e.currentTime),t.stop(e.currentTime+.1)}catch(e){console.log("[playBounceSound] Audio error:",e)}}function et(e){if(d.fx)try{const t=de(),o=400+e*100,a=t.createOscillator(),s=t.createGain();a.connect(s),s.connect(t.destination),a.type="triangle",a.frequency.setValueAtTime(o,t.currentTime),a.frequency.exponentialRampToValueAtTime(o*1.5,t.currentTime+.15),s.gain.setValueAtTime(.25,t.currentTime),s.gain.exponentialRampToValueAtTime(.01,t.currentTime+.2),a.start(t.currentTime),a.stop(t.currentTime+.2)}catch(t){console.log("[playComboSound] Audio error:",t)}}function tt(){if(d.fx)try{const e=de(),t=e.createOscillator(),o=e.createGain();t.connect(o),o.connect(e.destination),t.type="sawtooth",t.frequency.setValueAtTime(400,e.currentTime),t.frequency.exponentialRampToValueAtTime(100,e.currentTime+.3),o.gain.setValueAtTime(.3,e.currentTime),o.gain.exponentialRampToValueAtTime(.01,e.currentTime+.3),t.start(e.currentTime),t.stop(e.currentTime+.3)}catch(e){console.log("[playGameOverSound] Audio error:",e)}}function S(e){d.haptics&&typeof window.triggerHaptic=="function"&&window.triggerHaptic(e)}function Ge(){if(g!=="PLAYING")return;g="GAME_OVER",console.log("[gameOver] Final score:",y),typeof window.submitScore=="function"&&window.submitScore(y),S("error"),tt();const e=y>D;e&&(D=y,localStorage.setItem("helixJump_bestScore",D.toString()),console.log("[gameOver] New best score:",D)),Oe.textContent=y.toString(),e?ge.classList.remove("hidden"):ge.classList.add("hidden"),ce.classList.add("hidden"),Z.classList.add("hidden"),re.classList.remove("hidden")}function K(){console.log("[startGame] Starting game"),g="PLAYING",Je(),Le.classList.add("hidden"),re.classList.add("hidden"),W.classList.add("hidden"),ce.classList.remove("hidden"),Z.classList.remove("hidden"),S("light")}function Ie(){g==="PLAYING"&&(console.log("[pauseGame] Game paused"),g="PAUSED",W.classList.remove("hidden"),S("light"))}function Se(){g==="PAUSED"&&(console.log("[resumeGame] Game resumed"),g="PLAYING",W.classList.add("hidden"),S("light"))}function le(){console.log("[showStartScreen] Showing start screen"),g="START",Te.textContent=D.toString(),Le.classList.remove("hidden"),re.classList.add("hidden"),W.classList.add("hidden"),ce.classList.add("hidden"),Z.classList.add("hidden")}function nt(){window.addEventListener("keydown",e=>{v.add(e.key),e.key==="Escape"&&(g==="PLAYING"?Ie():g==="PAUSED"&&Se()),e.key===" "&&g==="START"&&K()}),window.addEventListener("keyup",e=>{v.delete(e.key)}),G.addEventListener("touchstart",e=>{if(e.preventDefault(),g!=="PLAYING")return;const t=e.touches[0];B=!0,F=t.clientX,V=0}),G.addEventListener("touchmove",e=>{if(e.preventDefault(),!B||g!=="PLAYING")return;const t=e.touches[0],o=t.clientX-F;E+=o*i.ROTATION_SPEED,V=o*i.ROTATION_SPEED*.5,F=t.clientX}),G.addEventListener("touchend",e=>{e.preventDefault(),B=!1}),G.addEventListener("mousedown",e=>{g==="PLAYING"&&(B=!0,F=e.clientX,V=0)}),G.addEventListener("mousemove",e=>{if(!B||g!=="PLAYING")return;const t=e.clientX-F;E+=t*i.ROTATION_SPEED,V=t*i.ROTATION_SPEED*.5,F=e.clientX}),G.addEventListener("mouseup",()=>{B=!1}),G.addEventListener("mouseleave",()=>{B=!1}),document.getElementById("startButton").addEventListener("click",()=>{S("light"),K()}),Ne.addEventListener("click",()=>{S("light"),ue.classList.remove("hidden")}),document.getElementById("settingsClose").addEventListener("click",()=>{S("light"),ue.classList.add("hidden")}),Z.addEventListener("click",Ie),document.getElementById("resumeButton").addEventListener("click",()=>{S("light"),Se()}),document.getElementById("pauseRestartButton").addEventListener("click",()=>{S("light"),W.classList.add("hidden"),K()}),document.getElementById("pauseMenuButton").addEventListener("click",()=>{S("light"),le()}),document.getElementById("restartButton").addEventListener("click",()=>{S("light"),K()}),document.getElementById("backToStartButton").addEventListener("click",()=>{S("light"),le()}),ot()}function ot(){const e=document.getElementById("musicToggle"),t=document.getElementById("fxToggle"),o=document.getElementById("hapticToggle");e.classList.toggle("active",d.music),t.classList.toggle("active",d.fx),o.classList.toggle("active",d.haptics),e.addEventListener("click",()=>{d.music=!d.music,e.classList.toggle("active",d.music),localStorage.setItem("helixJump_music",d.music.toString()),S("light")}),t.addEventListener("click",()=>{d.fx=!d.fx,t.classList.toggle("active",d.fx),localStorage.setItem("helixJump_fx",d.fx.toString()),S("light")}),o.addEventListener("click",()=>{d.haptics=!d.haptics,o.classList.toggle("active",d.haptics),localStorage.setItem("helixJump_haptics",d.haptics.toString()),d.haptics&&S("light")})}function Ee(){R=window.innerWidth,m=window.innerHeight,G.width=R,G.height=m,N=Math.min(R,m*.6)*i.TOWER_RADIUS,console.log("[resizeCanvas] Canvas resized to:",R,"x",m)}let Ae=0;function Me(e){const t=e-Ae;if(Ae=e,n.save(),Ze(),Ye(),g==="PLAYING")if(Qe(),je(),Xe(),pe(t),me(t),j>0){j-=t;const a=j/150;U=x(1,1.3,a),z=x(1,.7,a)}else{const a=Math.abs(C)/i.BALL_MAX_VY;U=x(1,.85,a),z=x(1,1.15,a)}else(g==="PAUSED"||g==="GAME_OVER")&&(pe(t),me(t));Fe();const o=A.filter(a=>{const{visible:s}=Pe(a.y,T);return s});o.sort((a,s)=>s.y-a.y);for(const a of o)Ve(a,T);g==="PLAYING"&&C>i.BALL_MAX_VY*.5&&Ue(),g!=="START"&&ze(),qe(),we(),n.restore(),requestAnimationFrame(Me)}function at(){console.log("[init] Initializing Helix Jump"),Ee(),window.addEventListener("resize",Ee),nt(),Te.textContent=D.toString(),_e(),requestAnimationFrame(Me),le(),console.log("[init] Game initialized. Best score:",D)}at();</script>
</head>
<body>
    <div id="game-container">
        <canvas id="gameCanvas"></canvas>

        <!-- Score Display (visible during gameplay) -->
        <div class="score-display hidden" id="scoreDisplay">
            <div class="current-score" id="currentScore">0</div>
            <div class="combo-display" id="comboDisplay">COMBO x2</div>
        </div>

        <!-- Settings Button -->
        <button class="top-btn settings-btn" id="settingsBtn">
            <svg viewBox="0 0 24 24">
                <path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>
            </svg>
        </button>

        <!-- Pause Button (visible during gameplay) -->
        <button class="top-btn pause-btn hidden" id="pauseBtn">
            <svg viewBox="0 0 24 24">
                <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>
            </svg>
        </button>

        <!-- Start Screen -->
        <div id="startScreen" class="overlay">
            <div class="content">
                <h1 class="game-title">Helix</h1>
                <p class="subtitle">Jump</p>
                <div class="ball-preview"></div>
                <div class="best-score-container">
                    <div class="best-label">Best</div>
                    <div class="best-value" id="startBestScore">0</div>
                </div>
                <button class="btn start-btn" id="startButton">Play</button>
            </div>
            <div class="tap-instruction">
                <svg viewBox="0 0 24 24"><path d="M10 9h4V6h3l-5-5-5 5h3v3zm-1 1H6V7l-5 5 5 5v-3h3v-4zm14 2l-5-5v3h-3v4h3v3l5-5zm-9 3h-4v3H7l5 5 5-5h-3v-3z"/></svg>
                <span>Swipe to rotate</span>
            </div>
        </div>

        <!-- Game Over Screen -->
        <div id="gameOverScreen" class="overlay game-over-overlay hidden">
            <div class="content">
                <h2 class="game-over-title">Game Over</h2>
                <div class="final-score-container">
                    <div class="final-score-label">Score</div>
                    <div class="final-score" id="finalScore">0</div>
                    <div class="new-best hidden" id="newBestBadge">New Best!</div>
                </div>
                <div class="game-over-buttons">
                    <button class="btn" id="restartButton">Play Again</button>
                    <button class="btn btn-secondary" id="backToStartButton">Menu</button>
                </div>
            </div>
        </div>

        <!-- Pause Menu -->
        <div id="pauseScreen" class="overlay pause-menu hidden">
            <div class="content">
                <h2 class="pause-title">Paused</h2>
                <div class="pause-buttons">
                    <button class="btn" id="resumeButton">Resume</button>
                    <button class="btn btn-secondary" id="pauseRestartButton">Restart</button>
                    <button class="btn btn-secondary" id="pauseMenuButton">Menu</button>
                </div>
            </div>
        </div>

        <!-- Settings Modal -->
        <div id="settingsModal" class="settings-modal hidden">
            <h3 class="settings-title">Settings</h3>
            <div class="settings-row">
                <span class="settings-label">Music</span>
                <div class="toggle active" id="musicToggle"></div>
            </div>
            <div class="settings-row">
                <span class="settings-label">Sound FX</span>
                <div class="toggle active" id="fxToggle"></div>
            </div>
            <div class="settings-row">
                <span class="settings-label">Haptics</span>
                <div class="toggle active" id="hapticToggle"></div>
            </div>
            <button class="btn settings-close" id="settingsClose">Done</button>
        </div>
    </div>

</body>
</html>
