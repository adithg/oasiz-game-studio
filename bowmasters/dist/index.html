<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="mobile-web-app-capable" content="yes">
  <title>Bowmasters</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Bangers&family=Nunito:wght@700;900&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden;
      touch-action: none;
      background: #1a0a2e;
      font-family: 'Nunito', sans-serif;
    }
    
    #game-container {
      position: relative;
      width: 100%;
      height: 100%;
      overflow: hidden;
    }
    
    canvas {
      display: block;
      position: absolute;
      top: 0;
      left: 0;
    }
    
    /* Start Screen */
    #start-screen {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: linear-gradient(180deg, #2d1b4e 0%, #1a0a2e 50%, #0d0518 100%);
      z-index: 100;
      pointer-events: auto;
    }
    
    #start-screen.hidden {
      display: none;
    }
    
    .title-container {
      position: relative;
      margin-bottom: 60px;
    }
    
    .game-title {
      font-family: 'Bangers', cursive;
      font-size: clamp(48px, 12vw, 100px);
      color: #ff6b35;
      text-shadow: 
        4px 4px 0 #1a0a2e,
        -2px -2px 0 #ffcc00,
        6px 6px 0 rgba(0,0,0,0.3);
      letter-spacing: 4px;
      animation: titlePulse 2s ease-in-out infinite;
    }
    
    @keyframes titlePulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.02); }
    }
    
    .subtitle {
      font-family: 'Nunito', sans-serif;
      font-size: clamp(14px, 3vw, 20px);
      color: #a88beb;
      text-align: center;
      margin-top: 10px;
      letter-spacing: 2px;
    }
    
    .characters-preview {
      display: flex;
      gap: 80px;
      margin-bottom: 50px;
      align-items: center;
    }
    
    .preview-character {
      width: 80px;
      height: 100px;
      border-radius: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      animation: characterBob 1.5s ease-in-out infinite;
    }
    
    .preview-character:nth-child(2) {
      animation-delay: -0.75s;
    }
    
    .preview-character.player1 {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      box-shadow: 0 8px 25px rgba(79, 172, 254, 0.4);
    }
    
    .preview-character.player2 {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      box-shadow: 0 8px 25px rgba(245, 87, 108, 0.4);
    }
    
    @keyframes characterBob {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    
    .vs-text {
      font-family: 'Bangers', cursive;
      font-size: 36px;
      color: #ffcc00;
      text-shadow: 2px 2px 0 #1a0a2e;
    }
    
    .start-btn {
      padding: 18px 60px;
      font-family: 'Bangers', cursive;
      font-size: clamp(24px, 5vw, 32px);
      color: #1a0a2e;
      background: linear-gradient(135deg, #ffcc00 0%, #ff6b35 100%);
      border: none;
      border-radius: 50px;
      cursor: pointer;
      box-shadow: 
        0 6px 0 #cc5200,
        0 12px 30px rgba(255, 107, 53, 0.4);
      transition: all 0.15s ease;
      letter-spacing: 2px;
    }
    
    .start-btn:hover {
      transform: translateY(-2px);
      box-shadow: 
        0 8px 0 #cc5200,
        0 16px 35px rgba(255, 107, 53, 0.5);
    }
    
    .start-btn:active {
      transform: translateY(4px);
      box-shadow: 
        0 2px 0 #cc5200,
        0 4px 15px rgba(255, 107, 53, 0.3);
    }
    
    /* HUD */
    #hud {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      padding: 45px 20px 10px 20px;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      pointer-events: none;
      z-index: 10;
    }
    
    @media (pointer: coarse) {
      #hud {
        padding-top: 120px;
      }
    }
    
    .player-hud {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }
    
    .player-hud.right {
      align-items: center;
    }
    
    .player-name {
      font-family: 'Bangers', cursive;
      font-size: clamp(16px, 4vw, 24px);
      color: #fff;
      text-shadow: 2px 2px 0 rgba(0,0,0,0.5);
      letter-spacing: 1px;
    }
    
    .health-bar-container {
      width: clamp(80px, 20vw, 150px);
      height: 20px;
      background: rgba(0,0,0,0.5);
      border-radius: 10px;
      border: 3px solid rgba(255,255,255,0.3);
      overflow: hidden;
      position: relative;
    }
    
    .health-bar {
      height: 100%;
      transition: width 0.3s ease;
      border-radius: 7px;
    }
    
    .health-bar.player1 {
      background: linear-gradient(90deg, #4facfe, #00f2fe);
    }
    
    .health-bar.player2 {
      background: linear-gradient(90deg, #f5576c, #f093fb);
    }
    
    .health-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 11px;
      font-weight: 900;
      color: #fff;
      text-shadow: 1px 1px 0 rgba(0,0,0,0.5);
    }
    
    /* Turn Indicator */
    #turn-indicator {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-family: 'Bangers', cursive;
      font-size: clamp(24px, 6vw, 40px);
      color: #ffcc00;
      text-shadow: 3px 3px 0 #1a0a2e;
      pointer-events: none;
      z-index: 20;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    #turn-indicator.visible {
      opacity: 1;
      animation: turnBounce 0.5s ease-out;
    }
    
    @keyframes turnBounce {
      0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
      50% { transform: translate(-50%, -50%) scale(1.1); }
      100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
    }
    
    /* Aim Indicator */
    #aim-info {
      position: absolute;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      font-family: 'Nunito', sans-serif;
      font-size: clamp(12px, 3vw, 16px);
      color: rgba(255,255,255,0.7);
      text-align: center;
      pointer-events: none;
      z-index: 10;
    }
    
    /* Game Over Screen */
    #game-over-screen {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: rgba(13, 5, 24, 0.95);
      z-index: 100;
      pointer-events: auto;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.5s ease, visibility 0.5s ease;
    }
    
    #game-over-screen.visible {
      opacity: 1;
      visibility: visible;
    }
    
    .winner-text {
      font-family: 'Bangers', cursive;
      font-size: clamp(36px, 10vw, 72px);
      color: #ffcc00;
      text-shadow: 4px 4px 0 #1a0a2e;
      margin-bottom: 20px;
      text-align: center;
    }
    
    .winner-label {
      font-family: 'Nunito', sans-serif;
      font-size: clamp(18px, 4vw, 28px);
      color: #a88beb;
      margin-bottom: 50px;
    }
    
    .restart-btn {
      padding: 16px 50px;
      font-family: 'Bangers', cursive;
      font-size: clamp(20px, 4vw, 28px);
      color: #1a0a2e;
      background: linear-gradient(135deg, #00f2fe 0%, #4facfe 100%);
      border: none;
      border-radius: 50px;
      cursor: pointer;
      box-shadow: 
        0 5px 0 #0088cc,
        0 10px 25px rgba(79, 172, 254, 0.4);
      transition: all 0.15s ease;
      letter-spacing: 2px;
    }
    
    .restart-btn:hover {
      transform: translateY(-2px);
    }
    
    .restart-btn:active {
      transform: translateY(3px);
      box-shadow: 
        0 2px 0 #0088cc,
        0 4px 10px rgba(79, 172, 254, 0.3);
    }
    
    /* Settings Button */
    #settings-btn {
      position: absolute;
      top: 45px;
      right: 20px;
      width: 44px;
      height: 44px;
      background: rgba(255,255,255,0.15);
      border: 2px solid rgba(255,255,255,0.3);
      border-radius: 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 50;
      transition: background 0.2s ease;
    }
    
    @media (pointer: coarse) {
      #settings-btn {
        top: 120px;
      }
    }
    
    #settings-btn:hover {
      background: rgba(255,255,255,0.25);
    }
    
    #settings-btn svg {
      width: 24px;
      height: 24px;
      fill: #fff;
    }
    
    /* Settings Panel */
    #settings-panel {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.9);
      background: linear-gradient(180deg, #2d1b4e 0%, #1a0a2e 100%);
      border: 3px solid rgba(168, 139, 235, 0.5);
      border-radius: 20px;
      padding: 30px;
      z-index: 200;
      opacity: 0;
      visibility: hidden;
      transition: all 0.2s ease;
      min-width: 280px;
    }
    
    #settings-panel.visible {
      opacity: 1;
      visibility: visible;
      transform: translate(-50%, -50%) scale(1);
    }
    
    .settings-title {
      font-family: 'Bangers', cursive;
      font-size: 28px;
      color: #ffcc00;
      text-align: center;
      margin-bottom: 25px;
    }
    
    .setting-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 18px;
    }
    
    .setting-label {
      font-size: 16px;
      color: #fff;
      font-weight: 700;
    }
    
    .toggle-btn {
      width: 56px;
      height: 30px;
      background: rgba(255,255,255,0.2);
      border: none;
      border-radius: 15px;
      cursor: pointer;
      position: relative;
      transition: background 0.2s ease;
    }
    
    .toggle-btn.active {
      background: #4facfe;
    }
    
    .toggle-btn::after {
      content: '';
      position: absolute;
      top: 3px;
      left: 3px;
      width: 24px;
      height: 24px;
      background: #fff;
      border-radius: 50%;
      transition: transform 0.2s ease;
    }
    
    .toggle-btn.active::after {
      transform: translateX(26px);
    }
    
    .close-settings-btn {
      margin-top: 20px;
      width: 100%;
      padding: 12px;
      font-family: 'Bangers', cursive;
      font-size: 20px;
      color: #1a0a2e;
      background: #ffcc00;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: transform 0.1s ease;
    }
    
    .close-settings-btn:active {
      transform: scale(0.97);
    }
    
    /* Settings Overlay */
    #settings-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.6);
      z-index: 150;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.2s ease, visibility 0.2s ease;
    }
    
    #settings-overlay.visible {
      opacity: 1;
      visibility: visible;
    }
    
    /* Power Meter */
    #power-meter {
      position: absolute;
      left: 20px;
      top: 50%;
      transform: translateY(-50%);
      width: 20px;
      height: 150px;
      background: rgba(0,0,0,0.4);
      border: 3px solid rgba(255,255,255,0.3);
      border-radius: 10px;
      overflow: hidden;
      pointer-events: none;
      z-index: 10;
      opacity: 0;
      transition: opacity 0.2s ease;
    }
    
    #power-meter.visible {
      opacity: 1;
    }
    
    .power-fill {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      background: linear-gradient(0deg, #00ff88 0%, #ffcc00 50%, #ff4444 100%);
      transition: height 0.05s ease;
      border-radius: 7px;
    }
    
    /* Damage Popup */
    .damage-popup {
      position: absolute;
      font-family: 'Bangers', cursive;
      font-size: 36px;
      color: #ff4444;
      text-shadow: 2px 2px 0 #000;
      pointer-events: none;
      animation: damageFloat 1s ease-out forwards;
      z-index: 30;
    }
    
    @keyframes damageFloat {
      0% { 
        opacity: 1; 
        transform: translateY(0) scale(1.2); 
      }
      100% { 
        opacity: 0; 
        transform: translateY(-60px) scale(0.8); 
      }
    }
    
    /* Instructions */
    .instructions {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      font-size: clamp(12px, 3vw, 14px);
      color: rgba(255,255,255,0.5);
      text-align: center;
      pointer-events: none;
    }
  </style>
  <script type="module" crossorigin>(function(){const I=document.createElement("link").relList;if(I&&I.supports&&I.supports("modulepreload"))return;for(const f of document.querySelectorAll('link[rel="modulepreload"]'))E(f);new MutationObserver(f=>{for(const e of f)if(e.type==="childList")for(const l of e.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&E(l)}).observe(document,{childList:!0,subtree:!0});function P(f){const e={};return f.integrity&&(e.integrity=f.integrity),f.referrerPolicy&&(e.referrerPolicy=f.referrerPolicy),f.crossOrigin==="use-credentials"?e.credentials="include":f.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function E(f){if(f.ep)return;f.ep=!0;const e=P(f);fetch(f.href,e)}})();var ue=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function xe(b){return b&&b.__esModule&&Object.prototype.hasOwnProperty.call(b,"default")?b.default:b}var te={exports:{}};var ye=te.exports,he;function Se(){return he||(he=1,(function(b,I){(function(E,f){b.exports=f()})(ye,function(){return(function(P){var E={};function f(e){if(E[e])return E[e].exports;var l=E[e]={i:e,l:!1,exports:{}};return P[e].call(l.exports,l,l.exports,f),l.l=!0,l.exports}return f.m=P,f.c=E,f.d=function(e,l,r){f.o(e,l)||Object.defineProperty(e,l,{enumerable:!0,get:r})},f.r=function(e){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},f.t=function(e,l){if(l&1&&(e=f(e)),l&8||l&4&&typeof e=="object"&&e&&e.__esModule)return e;var r=Object.create(null);if(f.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),l&2&&typeof e!="string")for(var a in e)f.d(r,a,function(g){return e[g]}.bind(null,a));return r},f.n=function(e){var l=e&&e.__esModule?function(){return e.default}:function(){return e};return f.d(l,"a",l),l},f.o=function(e,l){return Object.prototype.hasOwnProperty.call(e,l)},f.p="",f(f.s=20)})([(function(P,E){var f={};P.exports=f,(function(){f._baseDelta=1e3/60,f._nextId=0,f._seed=0,f._nowStartTime=+new Date,f._warnedOnce={},f._decomp=null,f.extend=function(l,r){var a,g;typeof r=="boolean"?(a=2,g=r):(a=1,g=!0);for(var i=a;i<arguments.length;i++){var u=arguments[i];if(u)for(var o in u)g&&u[o]&&u[o].constructor===Object&&(!l[o]||l[o].constructor===Object)?(l[o]=l[o]||{},f.extend(l[o],g,u[o])):l[o]=u[o]}return l},f.clone=function(l,r){return f.extend({},r,l)},f.keys=function(l){if(Object.keys)return Object.keys(l);var r=[];for(var a in l)r.push(a);return r},f.values=function(l){var r=[];if(Object.keys){for(var a=Object.keys(l),g=0;g<a.length;g++)r.push(l[a[g]]);return r}for(var i in l)r.push(l[i]);return r},f.get=function(l,r,a,g){r=r.split(".").slice(a,g);for(var i=0;i<r.length;i+=1)l=l[r[i]];return l},f.set=function(l,r,a,g,i){var u=r.split(".").slice(g,i);return f.get(l,r,0,-1)[u[u.length-1]]=a,a},f.shuffle=function(l){for(var r=l.length-1;r>0;r--){var a=Math.floor(f.random()*(r+1)),g=l[r];l[r]=l[a],l[a]=g}return l},f.choose=function(l){return l[Math.floor(f.random()*l.length)]},f.isElement=function(l){return typeof HTMLElement<"u"?l instanceof HTMLElement:!!(l&&l.nodeType&&l.nodeName)},f.isArray=function(l){return Object.prototype.toString.call(l)==="[object Array]"},f.isFunction=function(l){return typeof l=="function"},f.isPlainObject=function(l){return typeof l=="object"&&l.constructor===Object},f.isString=function(l){return toString.call(l)==="[object String]"},f.clamp=function(l,r,a){return l<r?r:l>a?a:l},f.sign=function(l){return l<0?-1:1},f.now=function(){if(typeof window<"u"&&window.performance){if(window.performance.now)return window.performance.now();if(window.performance.webkitNow)return window.performance.webkitNow()}return Date.now?Date.now():new Date-f._nowStartTime},f.random=function(l,r){return l=typeof l<"u"?l:0,r=typeof r<"u"?r:1,l+e()*(r-l)};var e=function(){return f._seed=(f._seed*9301+49297)%233280,f._seed/233280};f.colorToNumber=function(l){return l=l.replace("#",""),l.length==3&&(l=l.charAt(0)+l.charAt(0)+l.charAt(1)+l.charAt(1)+l.charAt(2)+l.charAt(2)),parseInt(l,16)},f.logLevel=1,f.log=function(){console&&f.logLevel>0&&f.logLevel<=3&&console.log.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},f.info=function(){console&&f.logLevel>0&&f.logLevel<=2&&console.info.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},f.warn=function(){console&&f.logLevel>0&&f.logLevel<=3&&console.warn.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},f.warnOnce=function(){var l=Array.prototype.slice.call(arguments).join(" ");f._warnedOnce[l]||(f.warn(l),f._warnedOnce[l]=!0)},f.deprecated=function(l,r,a){l[r]=f.chain(function(){f.warnOnce("ðŸ”… deprecated ðŸ”…",a)},l[r])},f.nextId=function(){return f._nextId++},f.indexOf=function(l,r){if(l.indexOf)return l.indexOf(r);for(var a=0;a<l.length;a++)if(l[a]===r)return a;return-1},f.map=function(l,r){if(l.map)return l.map(r);for(var a=[],g=0;g<l.length;g+=1)a.push(r(l[g]));return a},f.topologicalSort=function(l){var r=[],a=[],g=[];for(var i in l)!a[i]&&!g[i]&&f._topologicalSort(i,a,g,l,r);return r},f._topologicalSort=function(l,r,a,g,i){var u=g[l]||[];a[l]=!0;for(var o=0;o<u.length;o+=1){var t=u[o];a[t]||r[t]||f._topologicalSort(t,r,a,g,i)}a[l]=!1,r[l]=!0,i.push(l)},f.chain=function(){for(var l=[],r=0;r<arguments.length;r+=1){var a=arguments[r];a._chained?l.push.apply(l,a._chained):l.push(a)}var g=function(){for(var i,u=new Array(arguments.length),o=0,t=arguments.length;o<t;o++)u[o]=arguments[o];for(o=0;o<l.length;o+=1){var s=l[o].apply(i,u);typeof s<"u"&&(i=s)}return i};return g._chained=l,g},f.chainPathBefore=function(l,r,a){return f.set(l,r,f.chain(a,f.get(l,r)))},f.chainPathAfter=function(l,r,a){return f.set(l,r,f.chain(f.get(l,r),a))},f.setDecomp=function(l){f._decomp=l},f.getDecomp=function(){var l=f._decomp;try{!l&&typeof window<"u"&&(l=window.decomp),!l&&typeof ue<"u"&&(l=ue.decomp)}catch{l=null}return l}})()}),(function(P,E){var f={};P.exports=f,(function(){f.create=function(e){var l={min:{x:0,y:0},max:{x:0,y:0}};return e&&f.update(l,e),l},f.update=function(e,l,r){e.min.x=1/0,e.max.x=-1/0,e.min.y=1/0,e.max.y=-1/0;for(var a=0;a<l.length;a++){var g=l[a];g.x>e.max.x&&(e.max.x=g.x),g.x<e.min.x&&(e.min.x=g.x),g.y>e.max.y&&(e.max.y=g.y),g.y<e.min.y&&(e.min.y=g.y)}r&&(r.x>0?e.max.x+=r.x:e.min.x+=r.x,r.y>0?e.max.y+=r.y:e.min.y+=r.y)},f.contains=function(e,l){return l.x>=e.min.x&&l.x<=e.max.x&&l.y>=e.min.y&&l.y<=e.max.y},f.overlaps=function(e,l){return e.min.x<=l.max.x&&e.max.x>=l.min.x&&e.max.y>=l.min.y&&e.min.y<=l.max.y},f.translate=function(e,l){e.min.x+=l.x,e.max.x+=l.x,e.min.y+=l.y,e.max.y+=l.y},f.shift=function(e,l){var r=e.max.x-e.min.x,a=e.max.y-e.min.y;e.min.x=l.x,e.max.x=l.x+r,e.min.y=l.y,e.max.y=l.y+a}})()}),(function(P,E){var f={};P.exports=f,(function(){f.create=function(e,l){return{x:e||0,y:l||0}},f.clone=function(e){return{x:e.x,y:e.y}},f.magnitude=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)},f.magnitudeSquared=function(e){return e.x*e.x+e.y*e.y},f.rotate=function(e,l,r){var a=Math.cos(l),g=Math.sin(l);r||(r={});var i=e.x*a-e.y*g;return r.y=e.x*g+e.y*a,r.x=i,r},f.rotateAbout=function(e,l,r,a){var g=Math.cos(l),i=Math.sin(l);a||(a={});var u=r.x+((e.x-r.x)*g-(e.y-r.y)*i);return a.y=r.y+((e.x-r.x)*i+(e.y-r.y)*g),a.x=u,a},f.normalise=function(e){var l=f.magnitude(e);return l===0?{x:0,y:0}:{x:e.x/l,y:e.y/l}},f.dot=function(e,l){return e.x*l.x+e.y*l.y},f.cross=function(e,l){return e.x*l.y-e.y*l.x},f.cross3=function(e,l,r){return(l.x-e.x)*(r.y-e.y)-(l.y-e.y)*(r.x-e.x)},f.add=function(e,l,r){return r||(r={}),r.x=e.x+l.x,r.y=e.y+l.y,r},f.sub=function(e,l,r){return r||(r={}),r.x=e.x-l.x,r.y=e.y-l.y,r},f.mult=function(e,l){return{x:e.x*l,y:e.y*l}},f.div=function(e,l){return{x:e.x/l,y:e.y/l}},f.perp=function(e,l){return l=l===!0?-1:1,{x:l*-e.y,y:l*e.x}},f.neg=function(e){return{x:-e.x,y:-e.y}},f.angle=function(e,l){return Math.atan2(l.y-e.y,l.x-e.x)},f._temp=[f.create(),f.create(),f.create(),f.create(),f.create(),f.create()]})()}),(function(P,E,f){var e={};P.exports=e;var l=f(2),r=f(0);(function(){e.create=function(a,g){for(var i=[],u=0;u<a.length;u++){var o=a[u],t={x:o.x,y:o.y,index:u,body:g,isInternal:!1};i.push(t)}return i},e.fromPath=function(a,g){var i=/L?\s*([-\d.e]+)[\s,]*([-\d.e]+)*/ig,u=[];return a.replace(i,function(o,t,s){u.push({x:parseFloat(t),y:parseFloat(s)})}),e.create(u,g)},e.centre=function(a){for(var g=e.area(a,!0),i={x:0,y:0},u,o,t,s=0;s<a.length;s++)t=(s+1)%a.length,u=l.cross(a[s],a[t]),o=l.mult(l.add(a[s],a[t]),u),i=l.add(i,o);return l.div(i,6*g)},e.mean=function(a){for(var g={x:0,y:0},i=0;i<a.length;i++)g.x+=a[i].x,g.y+=a[i].y;return l.div(g,a.length)},e.area=function(a,g){for(var i=0,u=a.length-1,o=0;o<a.length;o++)i+=(a[u].x-a[o].x)*(a[u].y+a[o].y),u=o;return g?i/2:Math.abs(i)/2},e.inertia=function(a,g){for(var i=0,u=0,o=a,t,s,n=0;n<o.length;n++)s=(n+1)%o.length,t=Math.abs(l.cross(o[s],o[n])),i+=t*(l.dot(o[s],o[s])+l.dot(o[s],o[n])+l.dot(o[n],o[n])),u+=t;return g/6*(i/u)},e.translate=function(a,g,i){i=typeof i<"u"?i:1;var u=a.length,o=g.x*i,t=g.y*i,s;for(s=0;s<u;s++)a[s].x+=o,a[s].y+=t;return a},e.rotate=function(a,g,i){if(g!==0){var u=Math.cos(g),o=Math.sin(g),t=i.x,s=i.y,n=a.length,c,p,y,w;for(w=0;w<n;w++)c=a[w],p=c.x-t,y=c.y-s,c.x=t+(p*u-y*o),c.y=s+(p*o+y*u);return a}},e.contains=function(a,g){for(var i=g.x,u=g.y,o=a.length,t=a[o-1],s,n=0;n<o;n++){if(s=a[n],(i-t.x)*(s.y-t.y)+(u-t.y)*(t.x-s.x)>0)return!1;t=s}return!0},e.scale=function(a,g,i,u){if(g===1&&i===1)return a;u=u||e.centre(a);for(var o,t,s=0;s<a.length;s++)o=a[s],t=l.sub(o,u),a[s].x=u.x+t.x*g,a[s].y=u.y+t.y*i;return a},e.chamfer=function(a,g,i,u,o){typeof g=="number"?g=[g]:g=g||[8],i=typeof i<"u"?i:-1,u=u||2,o=o||14;for(var t=[],s=0;s<a.length;s++){var n=a[s-1>=0?s-1:a.length-1],c=a[s],p=a[(s+1)%a.length],y=g[s<g.length?s:g.length-1];if(y===0){t.push(c);continue}var w=l.normalise({x:c.y-n.y,y:n.x-c.x}),T=l.normalise({x:p.y-c.y,y:c.x-p.x}),h=Math.sqrt(2*Math.pow(y,2)),d=l.mult(r.clone(w),y),m=l.normalise(l.mult(l.add(w,T),.5)),v=l.sub(c,l.mult(m,h)),S=i;i===-1&&(S=Math.pow(y,.32)*1.75),S=r.clamp(S,u,o),S%2===1&&(S+=1);for(var x=Math.acos(l.dot(w,T)),A=x/S,C=0;C<S;C++)t.push(l.add(l.rotate(d,A*C),v))}return t},e.clockwiseSort=function(a){var g=e.mean(a);return a.sort(function(i,u){return l.angle(g,i)-l.angle(g,u)}),a},e.isConvex=function(a){var g=0,i=a.length,u,o,t,s;if(i<3)return null;for(u=0;u<i;u++)if(o=(u+1)%i,t=(u+2)%i,s=(a[o].x-a[u].x)*(a[t].y-a[o].y),s-=(a[o].y-a[u].y)*(a[t].x-a[o].x),s<0?g|=1:s>0&&(g|=2),g===3)return!1;return g!==0?!0:null},e.hull=function(a){var g=[],i=[],u,o;for(a=a.slice(0),a.sort(function(t,s){var n=t.x-s.x;return n!==0?n:t.y-s.y}),o=0;o<a.length;o+=1){for(u=a[o];i.length>=2&&l.cross3(i[i.length-2],i[i.length-1],u)<=0;)i.pop();i.push(u)}for(o=a.length-1;o>=0;o-=1){for(u=a[o];g.length>=2&&l.cross3(g[g.length-2],g[g.length-1],u)<=0;)g.pop();g.push(u)}return g.pop(),i.pop(),g.concat(i)}})()}),(function(P,E,f){var e={};P.exports=e;var l=f(3),r=f(2),a=f(7),g=f(0),i=f(1),u=f(11);(function(){e._timeCorrection=!0,e._inertiaScale=4,e._nextCollidingGroupId=1,e._nextNonCollidingGroupId=-1,e._nextCategory=1,e._baseDelta=1e3/60,e.create=function(t){var s={id:g.nextId(),type:"body",label:"Body",parts:[],plugin:{},angle:0,vertices:l.fromPath("L 0 0 L 40 0 L 40 40 L 0 40"),position:{x:0,y:0},force:{x:0,y:0},torque:0,positionImpulse:{x:0,y:0},constraintImpulse:{x:0,y:0,angle:0},totalContacts:0,speed:0,angularSpeed:0,velocity:{x:0,y:0},angularVelocity:0,isSensor:!1,isStatic:!1,isSleeping:!1,motion:0,sleepThreshold:60,density:.001,restitution:0,friction:.1,frictionStatic:.5,frictionAir:.01,collisionFilter:{category:1,mask:4294967295,group:0},slop:.05,timeScale:1,render:{visible:!0,opacity:1,strokeStyle:null,fillStyle:null,lineWidth:null,sprite:{xScale:1,yScale:1,xOffset:0,yOffset:0}},events:null,bounds:null,chamfer:null,circleRadius:0,positionPrev:null,anglePrev:0,parent:null,axes:null,area:0,mass:0,inertia:0,deltaTime:16.666666666666668,_original:null},n=g.extend(s,t);return o(n,t),n},e.nextGroup=function(t){return t?e._nextNonCollidingGroupId--:e._nextCollidingGroupId++},e.nextCategory=function(){return e._nextCategory=e._nextCategory<<1,e._nextCategory};var o=function(t,s){s=s||{},e.set(t,{bounds:t.bounds||i.create(t.vertices),positionPrev:t.positionPrev||r.clone(t.position),anglePrev:t.anglePrev||t.angle,vertices:t.vertices,parts:t.parts||[t],isStatic:t.isStatic,isSleeping:t.isSleeping,parent:t.parent||t}),l.rotate(t.vertices,t.angle,t.position),u.rotate(t.axes,t.angle),i.update(t.bounds,t.vertices,t.velocity),e.set(t,{axes:s.axes||t.axes,area:s.area||t.area,mass:s.mass||t.mass,inertia:s.inertia||t.inertia});var n=t.isStatic?"#14151f":g.choose(["#f19648","#f5d259","#f55a3c","#063e7b","#ececd1"]),c=t.isStatic?"#555":"#ccc",p=t.isStatic&&t.render.fillStyle===null?1:0;t.render.fillStyle=t.render.fillStyle||n,t.render.strokeStyle=t.render.strokeStyle||c,t.render.lineWidth=t.render.lineWidth||p,t.render.sprite.xOffset+=-(t.bounds.min.x-t.position.x)/(t.bounds.max.x-t.bounds.min.x),t.render.sprite.yOffset+=-(t.bounds.min.y-t.position.y)/(t.bounds.max.y-t.bounds.min.y)};e.set=function(t,s,n){var c;typeof s=="string"&&(c=s,s={},s[c]=n);for(c in s)if(Object.prototype.hasOwnProperty.call(s,c))switch(n=s[c],c){case"isStatic":e.setStatic(t,n);break;case"isSleeping":a.set(t,n);break;case"mass":e.setMass(t,n);break;case"density":e.setDensity(t,n);break;case"inertia":e.setInertia(t,n);break;case"vertices":e.setVertices(t,n);break;case"position":e.setPosition(t,n);break;case"angle":e.setAngle(t,n);break;case"velocity":e.setVelocity(t,n);break;case"angularVelocity":e.setAngularVelocity(t,n);break;case"speed":e.setSpeed(t,n);break;case"angularSpeed":e.setAngularSpeed(t,n);break;case"parts":e.setParts(t,n);break;case"centre":e.setCentre(t,n);break;default:t[c]=n}},e.setStatic=function(t,s){for(var n=0;n<t.parts.length;n++){var c=t.parts[n];s?(c.isStatic||(c._original={restitution:c.restitution,friction:c.friction,mass:c.mass,inertia:c.inertia,density:c.density,inverseMass:c.inverseMass,inverseInertia:c.inverseInertia}),c.restitution=0,c.friction=1,c.mass=c.inertia=c.density=1/0,c.inverseMass=c.inverseInertia=0,c.positionPrev.x=c.position.x,c.positionPrev.y=c.position.y,c.anglePrev=c.angle,c.angularVelocity=0,c.speed=0,c.angularSpeed=0,c.motion=0):c._original&&(c.restitution=c._original.restitution,c.friction=c._original.friction,c.mass=c._original.mass,c.inertia=c._original.inertia,c.density=c._original.density,c.inverseMass=c._original.inverseMass,c.inverseInertia=c._original.inverseInertia,c._original=null),c.isStatic=s}},e.setMass=function(t,s){var n=t.inertia/(t.mass/6);t.inertia=n*(s/6),t.inverseInertia=1/t.inertia,t.mass=s,t.inverseMass=1/t.mass,t.density=t.mass/t.area},e.setDensity=function(t,s){e.setMass(t,s*t.area),t.density=s},e.setInertia=function(t,s){t.inertia=s,t.inverseInertia=1/t.inertia},e.setVertices=function(t,s){s[0].body===t?t.vertices=s:t.vertices=l.create(s,t),t.axes=u.fromVertices(t.vertices),t.area=l.area(t.vertices),e.setMass(t,t.density*t.area);var n=l.centre(t.vertices);l.translate(t.vertices,n,-1),e.setInertia(t,e._inertiaScale*l.inertia(t.vertices,t.mass)),l.translate(t.vertices,t.position),i.update(t.bounds,t.vertices,t.velocity)},e.setParts=function(t,s,n){var c;for(s=s.slice(0),t.parts.length=0,t.parts.push(t),t.parent=t,c=0;c<s.length;c++){var p=s[c];p!==t&&(p.parent=t,t.parts.push(p))}if(t.parts.length!==1){if(n=typeof n<"u"?n:!0,n){var y=[];for(c=0;c<s.length;c++)y=y.concat(s[c].vertices);l.clockwiseSort(y);var w=l.hull(y),T=l.centre(w);e.setVertices(t,w),l.translate(t.vertices,T)}var h=e._totalProperties(t);t.area=h.area,t.parent=t,t.position.x=h.centre.x,t.position.y=h.centre.y,t.positionPrev.x=h.centre.x,t.positionPrev.y=h.centre.y,e.setMass(t,h.mass),e.setInertia(t,h.inertia),e.setPosition(t,h.centre)}},e.setCentre=function(t,s,n){n?(t.positionPrev.x+=s.x,t.positionPrev.y+=s.y,t.position.x+=s.x,t.position.y+=s.y):(t.positionPrev.x=s.x-(t.position.x-t.positionPrev.x),t.positionPrev.y=s.y-(t.position.y-t.positionPrev.y),t.position.x=s.x,t.position.y=s.y)},e.setPosition=function(t,s,n){var c=r.sub(s,t.position);n?(t.positionPrev.x=t.position.x,t.positionPrev.y=t.position.y,t.velocity.x=c.x,t.velocity.y=c.y,t.speed=r.magnitude(c)):(t.positionPrev.x+=c.x,t.positionPrev.y+=c.y);for(var p=0;p<t.parts.length;p++){var y=t.parts[p];y.position.x+=c.x,y.position.y+=c.y,l.translate(y.vertices,c),i.update(y.bounds,y.vertices,t.velocity)}},e.setAngle=function(t,s,n){var c=s-t.angle;n?(t.anglePrev=t.angle,t.angularVelocity=c,t.angularSpeed=Math.abs(c)):t.anglePrev+=c;for(var p=0;p<t.parts.length;p++){var y=t.parts[p];y.angle+=c,l.rotate(y.vertices,c,t.position),u.rotate(y.axes,c),i.update(y.bounds,y.vertices,t.velocity),p>0&&r.rotateAbout(y.position,c,t.position,y.position)}},e.setVelocity=function(t,s){var n=t.deltaTime/e._baseDelta;t.positionPrev.x=t.position.x-s.x*n,t.positionPrev.y=t.position.y-s.y*n,t.velocity.x=(t.position.x-t.positionPrev.x)/n,t.velocity.y=(t.position.y-t.positionPrev.y)/n,t.speed=r.magnitude(t.velocity)},e.getVelocity=function(t){var s=e._baseDelta/t.deltaTime;return{x:(t.position.x-t.positionPrev.x)*s,y:(t.position.y-t.positionPrev.y)*s}},e.getSpeed=function(t){return r.magnitude(e.getVelocity(t))},e.setSpeed=function(t,s){e.setVelocity(t,r.mult(r.normalise(e.getVelocity(t)),s))},e.setAngularVelocity=function(t,s){var n=t.deltaTime/e._baseDelta;t.anglePrev=t.angle-s*n,t.angularVelocity=(t.angle-t.anglePrev)/n,t.angularSpeed=Math.abs(t.angularVelocity)},e.getAngularVelocity=function(t){return(t.angle-t.anglePrev)*e._baseDelta/t.deltaTime},e.getAngularSpeed=function(t){return Math.abs(e.getAngularVelocity(t))},e.setAngularSpeed=function(t,s){e.setAngularVelocity(t,g.sign(e.getAngularVelocity(t))*s)},e.translate=function(t,s,n){e.setPosition(t,r.add(t.position,s),n)},e.rotate=function(t,s,n,c){if(!n)e.setAngle(t,t.angle+s,c);else{var p=Math.cos(s),y=Math.sin(s),w=t.position.x-n.x,T=t.position.y-n.y;e.setPosition(t,{x:n.x+(w*p-T*y),y:n.y+(w*y+T*p)},c),e.setAngle(t,t.angle+s,c)}},e.scale=function(t,s,n,c){var p=0,y=0;c=c||t.position;for(var w=0;w<t.parts.length;w++){var T=t.parts[w];l.scale(T.vertices,s,n,c),T.axes=u.fromVertices(T.vertices),T.area=l.area(T.vertices),e.setMass(T,t.density*T.area),l.translate(T.vertices,{x:-T.position.x,y:-T.position.y}),e.setInertia(T,e._inertiaScale*l.inertia(T.vertices,T.mass)),l.translate(T.vertices,{x:T.position.x,y:T.position.y}),w>0&&(p+=T.area,y+=T.inertia),T.position.x=c.x+(T.position.x-c.x)*s,T.position.y=c.y+(T.position.y-c.y)*n,i.update(T.bounds,T.vertices,t.velocity)}t.parts.length>1&&(t.area=p,t.isStatic||(e.setMass(t,t.density*p),e.setInertia(t,y))),t.circleRadius&&(s===n?t.circleRadius*=s:t.circleRadius=null)},e.update=function(t,s){s=(typeof s<"u"?s:1e3/60)*t.timeScale;var n=s*s,c=e._timeCorrection?s/(t.deltaTime||s):1,p=1-t.frictionAir*(s/g._baseDelta),y=(t.position.x-t.positionPrev.x)*c,w=(t.position.y-t.positionPrev.y)*c;t.velocity.x=y*p+t.force.x/t.mass*n,t.velocity.y=w*p+t.force.y/t.mass*n,t.positionPrev.x=t.position.x,t.positionPrev.y=t.position.y,t.position.x+=t.velocity.x,t.position.y+=t.velocity.y,t.deltaTime=s,t.angularVelocity=(t.angle-t.anglePrev)*p*c+t.torque/t.inertia*n,t.anglePrev=t.angle,t.angle+=t.angularVelocity;for(var T=0;T<t.parts.length;T++){var h=t.parts[T];l.translate(h.vertices,t.velocity),T>0&&(h.position.x+=t.velocity.x,h.position.y+=t.velocity.y),t.angularVelocity!==0&&(l.rotate(h.vertices,t.angularVelocity,t.position),u.rotate(h.axes,t.angularVelocity),T>0&&r.rotateAbout(h.position,t.angularVelocity,t.position,h.position)),i.update(h.bounds,h.vertices,t.velocity)}},e.updateVelocities=function(t){var s=e._baseDelta/t.deltaTime,n=t.velocity;n.x=(t.position.x-t.positionPrev.x)*s,n.y=(t.position.y-t.positionPrev.y)*s,t.speed=Math.sqrt(n.x*n.x+n.y*n.y),t.angularVelocity=(t.angle-t.anglePrev)*s,t.angularSpeed=Math.abs(t.angularVelocity)},e.applyForce=function(t,s,n){var c={x:s.x-t.position.x,y:s.y-t.position.y};t.force.x+=n.x,t.force.y+=n.y,t.torque+=c.x*n.y-c.y*n.x},e._totalProperties=function(t){for(var s={mass:0,area:0,inertia:0,centre:{x:0,y:0}},n=t.parts.length===1?0:1;n<t.parts.length;n++){var c=t.parts[n],p=c.mass!==1/0?c.mass:1;s.mass+=p,s.area+=c.area,s.inertia+=c.inertia,s.centre=r.add(s.centre,r.mult(c.position,p))}return s.centre=r.div(s.centre,s.mass),s}})()}),(function(P,E,f){var e={};P.exports=e;var l=f(0);(function(){e.on=function(r,a,g){for(var i=a.split(" "),u,o=0;o<i.length;o++)u=i[o],r.events=r.events||{},r.events[u]=r.events[u]||[],r.events[u].push(g);return g},e.off=function(r,a,g){if(!a){r.events={};return}typeof a=="function"&&(g=a,a=l.keys(r.events).join(" "));for(var i=a.split(" "),u=0;u<i.length;u++){var o=r.events[i[u]],t=[];if(g&&o)for(var s=0;s<o.length;s++)o[s]!==g&&t.push(o[s]);r.events[i[u]]=t}},e.trigger=function(r,a,g){var i,u,o,t,s=r.events;if(s&&l.keys(s).length>0){g||(g={}),i=a.split(" ");for(var n=0;n<i.length;n++)if(u=i[n],o=s[u],o){t=l.clone(g,!1),t.name=u,t.source=r;for(var c=0;c<o.length;c++)o[c].apply(r,[t])}}}})()}),(function(P,E,f){var e={};P.exports=e;var l=f(5),r=f(0),a=f(1),g=f(4);(function(){e.create=function(i){return r.extend({id:r.nextId(),type:"composite",parent:null,isModified:!1,bodies:[],constraints:[],composites:[],label:"Composite",plugin:{},cache:{allBodies:null,allConstraints:null,allComposites:null}},i)},e.setModified=function(i,u,o,t){if(i.isModified=u,u&&i.cache&&(i.cache.allBodies=null,i.cache.allConstraints=null,i.cache.allComposites=null),o&&i.parent&&e.setModified(i.parent,u,o,t),t)for(var s=0;s<i.composites.length;s++){var n=i.composites[s];e.setModified(n,u,o,t)}},e.add=function(i,u){var o=[].concat(u);l.trigger(i,"beforeAdd",{object:u});for(var t=0;t<o.length;t++){var s=o[t];switch(s.type){case"body":if(s.parent!==s){r.warn("Composite.add: skipped adding a compound body part (you must add its parent instead)");break}e.addBody(i,s);break;case"constraint":e.addConstraint(i,s);break;case"composite":e.addComposite(i,s);break;case"mouseConstraint":e.addConstraint(i,s.constraint);break}}return l.trigger(i,"afterAdd",{object:u}),i},e.remove=function(i,u,o){var t=[].concat(u);l.trigger(i,"beforeRemove",{object:u});for(var s=0;s<t.length;s++){var n=t[s];switch(n.type){case"body":e.removeBody(i,n,o);break;case"constraint":e.removeConstraint(i,n,o);break;case"composite":e.removeComposite(i,n,o);break;case"mouseConstraint":e.removeConstraint(i,n.constraint);break}}return l.trigger(i,"afterRemove",{object:u}),i},e.addComposite=function(i,u){return i.composites.push(u),u.parent=i,e.setModified(i,!0,!0,!1),i},e.removeComposite=function(i,u,o){var t=r.indexOf(i.composites,u);if(t!==-1){var s=e.allBodies(u);e.removeCompositeAt(i,t);for(var n=0;n<s.length;n++)s[n].sleepCounter=0}if(o)for(var n=0;n<i.composites.length;n++)e.removeComposite(i.composites[n],u,!0);return i},e.removeCompositeAt=function(i,u){return i.composites.splice(u,1),e.setModified(i,!0,!0,!1),i},e.addBody=function(i,u){return i.bodies.push(u),e.setModified(i,!0,!0,!1),i},e.removeBody=function(i,u,o){var t=r.indexOf(i.bodies,u);if(t!==-1&&(e.removeBodyAt(i,t),u.sleepCounter=0),o)for(var s=0;s<i.composites.length;s++)e.removeBody(i.composites[s],u,!0);return i},e.removeBodyAt=function(i,u){return i.bodies.splice(u,1),e.setModified(i,!0,!0,!1),i},e.addConstraint=function(i,u){return i.constraints.push(u),e.setModified(i,!0,!0,!1),i},e.removeConstraint=function(i,u,o){var t=r.indexOf(i.constraints,u);if(t!==-1&&e.removeConstraintAt(i,t),o)for(var s=0;s<i.composites.length;s++)e.removeConstraint(i.composites[s],u,!0);return i},e.removeConstraintAt=function(i,u){return i.constraints.splice(u,1),e.setModified(i,!0,!0,!1),i},e.clear=function(i,u,o){if(o)for(var t=0;t<i.composites.length;t++)e.clear(i.composites[t],u,!0);return u?i.bodies=i.bodies.filter(function(s){return s.isStatic}):i.bodies.length=0,i.constraints.length=0,i.composites.length=0,e.setModified(i,!0,!0,!1),i},e.allBodies=function(i){if(i.cache&&i.cache.allBodies)return i.cache.allBodies;for(var u=[].concat(i.bodies),o=0;o<i.composites.length;o++)u=u.concat(e.allBodies(i.composites[o]));return i.cache&&(i.cache.allBodies=u),u},e.allConstraints=function(i){if(i.cache&&i.cache.allConstraints)return i.cache.allConstraints;for(var u=[].concat(i.constraints),o=0;o<i.composites.length;o++)u=u.concat(e.allConstraints(i.composites[o]));return i.cache&&(i.cache.allConstraints=u),u},e.allComposites=function(i){if(i.cache&&i.cache.allComposites)return i.cache.allComposites;for(var u=[].concat(i.composites),o=0;o<i.composites.length;o++)u=u.concat(e.allComposites(i.composites[o]));return i.cache&&(i.cache.allComposites=u),u},e.get=function(i,u,o){var t,s;switch(o){case"body":t=e.allBodies(i);break;case"constraint":t=e.allConstraints(i);break;case"composite":t=e.allComposites(i).concat(i);break}return t?(s=t.filter(function(n){return n.id.toString()===u.toString()}),s.length===0?null:s[0]):null},e.move=function(i,u,o){return e.remove(i,u),e.add(o,u),i},e.rebase=function(i){for(var u=e.allBodies(i).concat(e.allConstraints(i)).concat(e.allComposites(i)),o=0;o<u.length;o++)u[o].id=r.nextId();return i},e.translate=function(i,u,o){for(var t=o?e.allBodies(i):i.bodies,s=0;s<t.length;s++)g.translate(t[s],u);return i},e.rotate=function(i,u,o,t){for(var s=Math.cos(u),n=Math.sin(u),c=t?e.allBodies(i):i.bodies,p=0;p<c.length;p++){var y=c[p],w=y.position.x-o.x,T=y.position.y-o.y;g.setPosition(y,{x:o.x+(w*s-T*n),y:o.y+(w*n+T*s)}),g.rotate(y,u)}return i},e.scale=function(i,u,o,t,s){for(var n=s?e.allBodies(i):i.bodies,c=0;c<n.length;c++){var p=n[c],y=p.position.x-t.x,w=p.position.y-t.y;g.setPosition(p,{x:t.x+y*u,y:t.y+w*o}),g.scale(p,u,o)}return i},e.bounds=function(i){for(var u=e.allBodies(i),o=[],t=0;t<u.length;t+=1){var s=u[t];o.push(s.bounds.min,s.bounds.max)}return a.create(o)}})()}),(function(P,E,f){var e={};P.exports=e;var l=f(4),r=f(5),a=f(0);(function(){e._motionWakeThreshold=.18,e._motionSleepThreshold=.08,e._minBias=.9,e.update=function(g,i){for(var u=i/a._baseDelta,o=e._motionSleepThreshold,t=0;t<g.length;t++){var s=g[t],n=l.getSpeed(s),c=l.getAngularSpeed(s),p=n*n+c*c;if(s.force.x!==0||s.force.y!==0){e.set(s,!1);continue}var y=Math.min(s.motion,p),w=Math.max(s.motion,p);s.motion=e._minBias*y+(1-e._minBias)*w,s.sleepThreshold>0&&s.motion<o?(s.sleepCounter+=1,s.sleepCounter>=s.sleepThreshold/u&&e.set(s,!0)):s.sleepCounter>0&&(s.sleepCounter-=1)}},e.afterCollisions=function(g){for(var i=e._motionSleepThreshold,u=0;u<g.length;u++){var o=g[u];if(o.isActive){var t=o.collision,s=t.bodyA.parent,n=t.bodyB.parent;if(!(s.isSleeping&&n.isSleeping||s.isStatic||n.isStatic)&&(s.isSleeping||n.isSleeping)){var c=s.isSleeping&&!s.isStatic?s:n,p=c===s?n:s;!c.isStatic&&p.motion>i&&e.set(c,!1)}}}},e.set=function(g,i){var u=g.isSleeping;i?(g.isSleeping=!0,g.sleepCounter=g.sleepThreshold,g.positionImpulse.x=0,g.positionImpulse.y=0,g.positionPrev.x=g.position.x,g.positionPrev.y=g.position.y,g.anglePrev=g.angle,g.speed=0,g.angularSpeed=0,g.motion=0,u||r.trigger(g,"sleepStart")):(g.isSleeping=!1,g.sleepCounter=0,u&&r.trigger(g,"sleepEnd"))}})()}),(function(P,E,f){var e={};P.exports=e;var l=f(3),r=f(9);(function(){var a=[],g={overlap:0,axis:null},i={overlap:0,axis:null};e.create=function(u,o){return{pair:null,collided:!1,bodyA:u,bodyB:o,parentA:u.parent,parentB:o.parent,depth:0,normal:{x:0,y:0},tangent:{x:0,y:0},penetration:{x:0,y:0},supports:[null,null],supportCount:0}},e.collides=function(u,o,t){if(e._overlapAxes(g,u.vertices,o.vertices,u.axes),g.overlap<=0||(e._overlapAxes(i,o.vertices,u.vertices,o.axes),i.overlap<=0))return null;var s=t&&t.table[r.id(u,o)],n;s?n=s.collision:(n=e.create(u,o),n.collided=!0,n.bodyA=u.id<o.id?u:o,n.bodyB=u.id<o.id?o:u,n.parentA=n.bodyA.parent,n.parentB=n.bodyB.parent),u=n.bodyA,o=n.bodyB;var c;g.overlap<i.overlap?c=g:c=i;var p=n.normal,y=n.tangent,w=n.penetration,T=n.supports,h=c.overlap,d=c.axis,m=d.x,v=d.y,S=o.position.x-u.position.x,x=o.position.y-u.position.y;m*S+v*x>=0&&(m=-m,v=-v),p.x=m,p.y=v,y.x=-v,y.y=m,w.x=m*h,w.y=v*h,n.depth=h;var A=e._findSupports(u,o,p,1),C=0;if(l.contains(u.vertices,A[0])&&(T[C++]=A[0]),l.contains(u.vertices,A[1])&&(T[C++]=A[1]),C<2){var M=e._findSupports(o,u,p,-1);l.contains(o.vertices,M[0])&&(T[C++]=M[0]),C<2&&l.contains(o.vertices,M[1])&&(T[C++]=M[1])}return C===0&&(T[C++]=A[0]),n.supportCount=C,n},e._overlapAxes=function(u,o,t,s){var n=o.length,c=t.length,p=o[0].x,y=o[0].y,w=t[0].x,T=t[0].y,h=s.length,d=Number.MAX_VALUE,m=0,v,S,x,A,C,M;for(C=0;C<h;C++){var B=s[C],L=B.x,O=B.y,R=p*L+y*O,G=w*L+T*O,k=R,U=G;for(M=1;M<n;M+=1)A=o[M].x*L+o[M].y*O,A>k?k=A:A<R&&(R=A);for(M=1;M<c;M+=1)A=t[M].x*L+t[M].y*O,A>U?U=A:A<G&&(G=A);if(S=k-G,x=U-R,v=S<x?S:x,v<d&&(d=v,m=C,v<=0))break}u.axis=s[m],u.overlap=d},e._findSupports=function(u,o,t,s){var n=o.vertices,c=n.length,p=u.position.x,y=u.position.y,w=t.x*s,T=t.y*s,h=n[0],d=h,m=w*(p-d.x)+T*(y-d.y),v,S,x;for(x=1;x<c;x+=1)d=n[x],S=w*(p-d.x)+T*(y-d.y),S<m&&(m=S,h=d);return v=n[(c+h.index-1)%c],m=w*(p-v.x)+T*(y-v.y),d=n[(h.index+1)%c],w*(p-d.x)+T*(y-d.y)<m?(a[0]=h,a[1]=d,a):(a[0]=h,a[1]=v,a)}})()}),(function(P,E,f){var e={};P.exports=e;var l=f(16);(function(){e.create=function(r,a){var g=r.bodyA,i=r.bodyB,u={id:e.id(g,i),bodyA:g,bodyB:i,collision:r,contacts:[l.create(),l.create()],contactCount:0,separation:0,isActive:!0,isSensor:g.isSensor||i.isSensor,timeCreated:a,timeUpdated:a,inverseMass:0,friction:0,frictionStatic:0,restitution:0,slop:0};return e.update(u,r,a),u},e.update=function(r,a,g){var i=a.supports,u=a.supportCount,o=r.contacts,t=a.parentA,s=a.parentB;r.isActive=!0,r.timeUpdated=g,r.collision=a,r.separation=a.depth,r.inverseMass=t.inverseMass+s.inverseMass,r.friction=t.friction<s.friction?t.friction:s.friction,r.frictionStatic=t.frictionStatic>s.frictionStatic?t.frictionStatic:s.frictionStatic,r.restitution=t.restitution>s.restitution?t.restitution:s.restitution,r.slop=t.slop>s.slop?t.slop:s.slop,r.contactCount=u,a.pair=r;var n=i[0],c=o[0],p=i[1],y=o[1];(y.vertex===n||c.vertex===p)&&(o[1]=c,o[0]=c=y,y=o[1]),c.vertex=n,y.vertex=p},e.setActive=function(r,a,g){a?(r.isActive=!0,r.timeUpdated=g):(r.isActive=!1,r.contactCount=0)},e.id=function(r,a){return r.id<a.id?r.id.toString(36)+":"+a.id.toString(36):a.id.toString(36)+":"+r.id.toString(36)}})()}),(function(P,E,f){var e={};P.exports=e;var l=f(3),r=f(2),a=f(7),g=f(1),i=f(11),u=f(0);(function(){e._warming=.4,e._torqueDampen=1,e._minLength=1e-6,e.create=function(o){var t=o;t.bodyA&&!t.pointA&&(t.pointA={x:0,y:0}),t.bodyB&&!t.pointB&&(t.pointB={x:0,y:0});var s=t.bodyA?r.add(t.bodyA.position,t.pointA):t.pointA,n=t.bodyB?r.add(t.bodyB.position,t.pointB):t.pointB,c=r.magnitude(r.sub(s,n));t.length=typeof t.length<"u"?t.length:c,t.id=t.id||u.nextId(),t.label=t.label||"Constraint",t.type="constraint",t.stiffness=t.stiffness||(t.length>0?1:.7),t.damping=t.damping||0,t.angularStiffness=t.angularStiffness||0,t.angleA=t.bodyA?t.bodyA.angle:t.angleA,t.angleB=t.bodyB?t.bodyB.angle:t.angleB,t.plugin={};var p={visible:!0,lineWidth:2,strokeStyle:"#ffffff",type:"line",anchors:!0};return t.length===0&&t.stiffness>.1?(p.type="pin",p.anchors=!1):t.stiffness<.9&&(p.type="spring"),t.render=u.extend(p,t.render),t},e.preSolveAll=function(o){for(var t=0;t<o.length;t+=1){var s=o[t],n=s.constraintImpulse;s.isStatic||n.x===0&&n.y===0&&n.angle===0||(s.position.x+=n.x,s.position.y+=n.y,s.angle+=n.angle)}},e.solveAll=function(o,t){for(var s=u.clamp(t/u._baseDelta,0,1),n=0;n<o.length;n+=1){var c=o[n],p=!c.bodyA||c.bodyA&&c.bodyA.isStatic,y=!c.bodyB||c.bodyB&&c.bodyB.isStatic;(p||y)&&e.solve(o[n],s)}for(n=0;n<o.length;n+=1)c=o[n],p=!c.bodyA||c.bodyA&&c.bodyA.isStatic,y=!c.bodyB||c.bodyB&&c.bodyB.isStatic,!p&&!y&&e.solve(o[n],s)},e.solve=function(o,t){var s=o.bodyA,n=o.bodyB,c=o.pointA,p=o.pointB;if(!(!s&&!n)){s&&!s.isStatic&&(r.rotate(c,s.angle-o.angleA,c),o.angleA=s.angle),n&&!n.isStatic&&(r.rotate(p,n.angle-o.angleB,p),o.angleB=n.angle);var y=c,w=p;if(s&&(y=r.add(s.position,c)),n&&(w=r.add(n.position,p)),!(!y||!w)){var T=r.sub(y,w),h=r.magnitude(T);h<e._minLength&&(h=e._minLength);var d=(h-o.length)/h,m=o.stiffness>=1||o.length===0,v=m?o.stiffness*t:o.stiffness*t*t,S=o.damping*t,x=r.mult(T,d*v),A=(s?s.inverseMass:0)+(n?n.inverseMass:0),C=(s?s.inverseInertia:0)+(n?n.inverseInertia:0),M=A+C,B,L,O,R,G;if(S>0){var k=r.create();O=r.div(T,h),G=r.sub(n&&r.sub(n.position,n.positionPrev)||k,s&&r.sub(s.position,s.positionPrev)||k),R=r.dot(O,G)}s&&!s.isStatic&&(L=s.inverseMass/A,s.constraintImpulse.x-=x.x*L,s.constraintImpulse.y-=x.y*L,s.position.x-=x.x*L,s.position.y-=x.y*L,S>0&&(s.positionPrev.x-=S*O.x*R*L,s.positionPrev.y-=S*O.y*R*L),B=r.cross(c,x)/M*e._torqueDampen*s.inverseInertia*(1-o.angularStiffness),s.constraintImpulse.angle-=B,s.angle-=B),n&&!n.isStatic&&(L=n.inverseMass/A,n.constraintImpulse.x+=x.x*L,n.constraintImpulse.y+=x.y*L,n.position.x+=x.x*L,n.position.y+=x.y*L,S>0&&(n.positionPrev.x+=S*O.x*R*L,n.positionPrev.y+=S*O.y*R*L),B=r.cross(p,x)/M*e._torqueDampen*n.inverseInertia*(1-o.angularStiffness),n.constraintImpulse.angle+=B,n.angle+=B)}}},e.postSolveAll=function(o){for(var t=0;t<o.length;t++){var s=o[t],n=s.constraintImpulse;if(!(s.isStatic||n.x===0&&n.y===0&&n.angle===0)){a.set(s,!1);for(var c=0;c<s.parts.length;c++){var p=s.parts[c];l.translate(p.vertices,n),c>0&&(p.position.x+=n.x,p.position.y+=n.y),n.angle!==0&&(l.rotate(p.vertices,n.angle,s.position),i.rotate(p.axes,n.angle),c>0&&r.rotateAbout(p.position,n.angle,s.position,p.position)),g.update(p.bounds,p.vertices,s.velocity)}n.angle*=e._warming,n.x*=e._warming,n.y*=e._warming}}},e.pointAWorld=function(o){return{x:(o.bodyA?o.bodyA.position.x:0)+(o.pointA?o.pointA.x:0),y:(o.bodyA?o.bodyA.position.y:0)+(o.pointA?o.pointA.y:0)}},e.pointBWorld=function(o){return{x:(o.bodyB?o.bodyB.position.x:0)+(o.pointB?o.pointB.x:0),y:(o.bodyB?o.bodyB.position.y:0)+(o.pointB?o.pointB.y:0)}},e.currentLength=function(o){var t=(o.bodyA?o.bodyA.position.x:0)+(o.pointA?o.pointA.x:0),s=(o.bodyA?o.bodyA.position.y:0)+(o.pointA?o.pointA.y:0),n=(o.bodyB?o.bodyB.position.x:0)+(o.pointB?o.pointB.x:0),c=(o.bodyB?o.bodyB.position.y:0)+(o.pointB?o.pointB.y:0),p=t-n,y=s-c;return Math.sqrt(p*p+y*y)}})()}),(function(P,E,f){var e={};P.exports=e;var l=f(2),r=f(0);(function(){e.fromVertices=function(a){for(var g={},i=0;i<a.length;i++){var u=(i+1)%a.length,o=l.normalise({x:a[u].y-a[i].y,y:a[i].x-a[u].x}),t=o.y===0?1/0:o.x/o.y;t=t.toFixed(3).toString(),g[t]=o}return r.values(g)},e.rotate=function(a,g){if(g!==0)for(var i=Math.cos(g),u=Math.sin(g),o=0;o<a.length;o++){var t=a[o],s;s=t.x*i-t.y*u,t.y=t.x*u+t.y*i,t.x=s}}})()}),(function(P,E,f){var e={};P.exports=e;var l=f(3),r=f(0),a=f(4),g=f(1),i=f(2);(function(){e.rectangle=function(u,o,t,s,n){n=n||{};var c={label:"Rectangle Body",position:{x:u,y:o},vertices:l.fromPath("L 0 0 L "+t+" 0 L "+t+" "+s+" L 0 "+s)};if(n.chamfer){var p=n.chamfer;c.vertices=l.chamfer(c.vertices,p.radius,p.quality,p.qualityMin,p.qualityMax),delete n.chamfer}return a.create(r.extend({},c,n))},e.trapezoid=function(u,o,t,s,n,c){c=c||{},n>=1&&r.warn("Bodies.trapezoid: slope parameter must be < 1."),n*=.5;var p=(1-n*2)*t,y=t*n,w=y+p,T=w+y,h;n<.5?h="L 0 0 L "+y+" "+-s+" L "+w+" "+-s+" L "+T+" 0":h="L 0 0 L "+w+" "+-s+" L "+T+" 0";var d={label:"Trapezoid Body",position:{x:u,y:o},vertices:l.fromPath(h)};if(c.chamfer){var m=c.chamfer;d.vertices=l.chamfer(d.vertices,m.radius,m.quality,m.qualityMin,m.qualityMax),delete c.chamfer}return a.create(r.extend({},d,c))},e.circle=function(u,o,t,s,n){s=s||{};var c={label:"Circle Body",circleRadius:t};n=n||25;var p=Math.ceil(Math.max(10,Math.min(n,t)));return p%2===1&&(p+=1),e.polygon(u,o,p,t,r.extend({},c,s))},e.polygon=function(u,o,t,s,n){if(n=n||{},t<3)return e.circle(u,o,s,n);for(var c=2*Math.PI/t,p="",y=c*.5,w=0;w<t;w+=1){var T=y+w*c,h=Math.cos(T)*s,d=Math.sin(T)*s;p+="L "+h.toFixed(3)+" "+d.toFixed(3)+" "}var m={label:"Polygon Body",position:{x:u,y:o},vertices:l.fromPath(p)};if(n.chamfer){var v=n.chamfer;m.vertices=l.chamfer(m.vertices,v.radius,v.quality,v.qualityMin,v.qualityMax),delete n.chamfer}return a.create(r.extend({},m,n))},e.fromVertices=function(u,o,t,s,n,c,p,y){var w=r.getDecomp(),T,h,d,m,v,S,x,A,C,M,B;for(T=!!(w&&w.quickDecomp),s=s||{},d=[],n=typeof n<"u"?n:!1,c=typeof c<"u"?c:.01,p=typeof p<"u"?p:10,y=typeof y<"u"?y:.01,r.isArray(t[0])||(t=[t]),M=0;M<t.length;M+=1)if(S=t[M],m=l.isConvex(S),v=!m,v&&!T&&r.warnOnce("Bodies.fromVertices: Install the 'poly-decomp' library and use Common.setDecomp or provide 'decomp' as a global to decompose concave vertices."),m||!T)m?S=l.clockwiseSort(S):S=l.hull(S),d.push({position:{x:u,y:o},vertices:S});else{var L=S.map(function(F){return[F.x,F.y]});w.makeCCW(L),c!==!1&&w.removeCollinearPoints(L,c),y!==!1&&w.removeDuplicatePoints&&w.removeDuplicatePoints(L,y);var O=w.quickDecomp(L);for(x=0;x<O.length;x++){var R=O[x],G=R.map(function(F){return{x:F[0],y:F[1]}});p>0&&l.area(G)<p||d.push({position:l.centre(G),vertices:G})}}for(x=0;x<d.length;x++)d[x]=a.create(r.extend(d[x],s));if(n){var k=5;for(x=0;x<d.length;x++){var U=d[x];for(A=x+1;A<d.length;A++){var V=d[A];if(g.overlaps(U.bounds,V.bounds)){var N=U.vertices,Y=V.vertices;for(C=0;C<U.vertices.length;C++)for(B=0;B<V.vertices.length;B++){var Q=i.magnitudeSquared(i.sub(N[(C+1)%N.length],Y[B])),$=i.magnitudeSquared(i.sub(N[C],Y[(B+1)%Y.length]));Q<k&&$<k&&(N[C].isInternal=!0,Y[B].isInternal=!0)}}}}}return d.length>1?(h=a.create(r.extend({parts:d.slice(0)},s)),a.setPosition(h,{x:u,y:o}),h):d[0]}})()}),(function(P,E,f){var e={};P.exports=e;var l=f(0),r=f(8);(function(){e.create=function(a){var g={bodies:[],collisions:[],pairs:null};return l.extend(g,a)},e.setBodies=function(a,g){a.bodies=g.slice(0)},e.clear=function(a){a.bodies=[],a.collisions=[]},e.collisions=function(a){var g=a.pairs,i=a.bodies,u=i.length,o=e.canCollide,t=r.collides,s=a.collisions,n=0,c,p;for(i.sort(e._compareBoundsX),c=0;c<u;c++){var y=i[c],w=y.bounds,T=y.bounds.max.x,h=y.bounds.max.y,d=y.bounds.min.y,m=y.isStatic||y.isSleeping,v=y.parts.length,S=v===1;for(p=c+1;p<u;p++){var x=i[p],A=x.bounds;if(A.min.x>T)break;if(!(h<A.min.y||d>A.max.y)&&!(m&&(x.isStatic||x.isSleeping))&&o(y.collisionFilter,x.collisionFilter)){var C=x.parts.length;if(S&&C===1){var M=t(y,x,g);M&&(s[n++]=M)}else for(var B=v>1?1:0,L=C>1?1:0,O=B;O<v;O++)for(var R=y.parts[O],w=R.bounds,G=L;G<C;G++){var k=x.parts[G],A=k.bounds;if(!(w.min.x>A.max.x||w.max.x<A.min.x||w.max.y<A.min.y||w.min.y>A.max.y)){var M=t(R,k,g);M&&(s[n++]=M)}}}}}return s.length!==n&&(s.length=n),s},e.canCollide=function(a,g){return a.group===g.group&&a.group!==0?a.group>0:(a.mask&g.category)!==0&&(g.mask&a.category)!==0},e._compareBoundsX=function(a,g){return a.bounds.min.x-g.bounds.min.x}})()}),(function(P,E,f){var e={};P.exports=e;var l=f(0);(function(){e.create=function(r){var a={};return r||l.log("Mouse.create: element was undefined, defaulting to document.body","warn"),a.element=r||document.body,a.absolute={x:0,y:0},a.position={x:0,y:0},a.mousedownPosition={x:0,y:0},a.mouseupPosition={x:0,y:0},a.offset={x:0,y:0},a.scale={x:1,y:1},a.wheelDelta=0,a.button=-1,a.pixelRatio=parseInt(a.element.getAttribute("data-pixel-ratio"),10)||1,a.sourceEvents={mousemove:null,mousedown:null,mouseup:null,mousewheel:null},a.mousemove=function(g){var i=e._getRelativeMousePosition(g,a.element,a.pixelRatio),u=g.changedTouches;u&&(a.button=0,g.preventDefault()),a.absolute.x=i.x,a.absolute.y=i.y,a.position.x=a.absolute.x*a.scale.x+a.offset.x,a.position.y=a.absolute.y*a.scale.y+a.offset.y,a.sourceEvents.mousemove=g},a.mousedown=function(g){var i=e._getRelativeMousePosition(g,a.element,a.pixelRatio),u=g.changedTouches;u?(a.button=0,g.preventDefault()):a.button=g.button,a.absolute.x=i.x,a.absolute.y=i.y,a.position.x=a.absolute.x*a.scale.x+a.offset.x,a.position.y=a.absolute.y*a.scale.y+a.offset.y,a.mousedownPosition.x=a.position.x,a.mousedownPosition.y=a.position.y,a.sourceEvents.mousedown=g},a.mouseup=function(g){var i=e._getRelativeMousePosition(g,a.element,a.pixelRatio),u=g.changedTouches;u&&g.preventDefault(),a.button=-1,a.absolute.x=i.x,a.absolute.y=i.y,a.position.x=a.absolute.x*a.scale.x+a.offset.x,a.position.y=a.absolute.y*a.scale.y+a.offset.y,a.mouseupPosition.x=a.position.x,a.mouseupPosition.y=a.position.y,a.sourceEvents.mouseup=g},a.mousewheel=function(g){a.wheelDelta=Math.max(-1,Math.min(1,g.wheelDelta||-g.detail)),g.preventDefault(),a.sourceEvents.mousewheel=g},e.setElement(a,a.element),a},e.setElement=function(r,a){r.element=a,a.addEventListener("mousemove",r.mousemove,{passive:!0}),a.addEventListener("mousedown",r.mousedown,{passive:!0}),a.addEventListener("mouseup",r.mouseup,{passive:!0}),a.addEventListener("wheel",r.mousewheel,{passive:!1}),a.addEventListener("touchmove",r.mousemove,{passive:!1}),a.addEventListener("touchstart",r.mousedown,{passive:!1}),a.addEventListener("touchend",r.mouseup,{passive:!1})},e.clearSourceEvents=function(r){r.sourceEvents.mousemove=null,r.sourceEvents.mousedown=null,r.sourceEvents.mouseup=null,r.sourceEvents.mousewheel=null,r.wheelDelta=0},e.setOffset=function(r,a){r.offset.x=a.x,r.offset.y=a.y,r.position.x=r.absolute.x*r.scale.x+r.offset.x,r.position.y=r.absolute.y*r.scale.y+r.offset.y},e.setScale=function(r,a){r.scale.x=a.x,r.scale.y=a.y,r.position.x=r.absolute.x*r.scale.x+r.offset.x,r.position.y=r.absolute.y*r.scale.y+r.offset.y},e._getRelativeMousePosition=function(r,a,g){var i=a.getBoundingClientRect(),u=document.documentElement||document.body.parentNode||document.body,o=window.pageXOffset!==void 0?window.pageXOffset:u.scrollLeft,t=window.pageYOffset!==void 0?window.pageYOffset:u.scrollTop,s=r.changedTouches,n,c;return s?(n=s[0].pageX-i.left-o,c=s[0].pageY-i.top-t):(n=r.pageX-i.left-o,c=r.pageY-i.top-t),{x:n/(a.clientWidth/(a.width||a.clientWidth)*g),y:c/(a.clientHeight/(a.height||a.clientHeight)*g)}}})()}),(function(P,E,f){var e={};P.exports=e;var l=f(0);(function(){e._registry={},e.register=function(r){if(e.isPlugin(r)||l.warn("Plugin.register:",e.toString(r),"does not implement all required fields."),r.name in e._registry){var a=e._registry[r.name],g=e.versionParse(r.version).number,i=e.versionParse(a.version).number;g>i?(l.warn("Plugin.register:",e.toString(a),"was upgraded to",e.toString(r)),e._registry[r.name]=r):g<i?l.warn("Plugin.register:",e.toString(a),"can not be downgraded to",e.toString(r)):r!==a&&l.warn("Plugin.register:",e.toString(r),"is already registered to different plugin object")}else e._registry[r.name]=r;return r},e.resolve=function(r){return e._registry[e.dependencyParse(r).name]},e.toString=function(r){return typeof r=="string"?r:(r.name||"anonymous")+"@"+(r.version||r.range||"0.0.0")},e.isPlugin=function(r){return r&&r.name&&r.version&&r.install},e.isUsed=function(r,a){return r.used.indexOf(a)>-1},e.isFor=function(r,a){var g=r.for&&e.dependencyParse(r.for);return!r.for||a.name===g.name&&e.versionSatisfies(a.version,g.range)},e.use=function(r,a){if(r.uses=(r.uses||[]).concat(a||[]),r.uses.length===0){l.warn("Plugin.use:",e.toString(r),"does not specify any dependencies to install.");return}for(var g=e.dependencies(r),i=l.topologicalSort(g),u=[],o=0;o<i.length;o+=1)if(i[o]!==r.name){var t=e.resolve(i[o]);if(!t){u.push("âŒ "+i[o]);continue}e.isUsed(r,t.name)||(e.isFor(t,r)||(l.warn("Plugin.use:",e.toString(t),"is for",t.for,"but installed on",e.toString(r)+"."),t._warned=!0),t.install?t.install(r):(l.warn("Plugin.use:",e.toString(t),"does not specify an install function."),t._warned=!0),t._warned?(u.push("ðŸ”¶ "+e.toString(t)),delete t._warned):u.push("âœ… "+e.toString(t)),r.used.push(t.name))}u.length>0&&l.info(u.join("  "))},e.dependencies=function(r,a){var g=e.dependencyParse(r),i=g.name;if(a=a||{},!(i in a)){r=e.resolve(r)||r,a[i]=l.map(r.uses||[],function(o){e.isPlugin(o)&&e.register(o);var t=e.dependencyParse(o),s=e.resolve(o);return s&&!e.versionSatisfies(s.version,t.range)?(l.warn("Plugin.dependencies:",e.toString(s),"does not satisfy",e.toString(t),"used by",e.toString(g)+"."),s._warned=!0,r._warned=!0):s||(l.warn("Plugin.dependencies:",e.toString(o),"used by",e.toString(g),"could not be resolved."),r._warned=!0),t.name});for(var u=0;u<a[i].length;u+=1)e.dependencies(a[i][u],a);return a}},e.dependencyParse=function(r){if(l.isString(r)){var a=/^[\w-]+(@(\*|[\^~]?\d+\.\d+\.\d+(-[0-9A-Za-z-+]+)?))?$/;return a.test(r)||l.warn("Plugin.dependencyParse:",r,"is not a valid dependency string."),{name:r.split("@")[0],range:r.split("@")[1]||"*"}}return{name:r.name,range:r.range||r.version}},e.versionParse=function(r){var a=/^(\*)|(\^|~|>=|>)?\s*((\d+)\.(\d+)\.(\d+))(-[0-9A-Za-z-+]+)?$/;a.test(r)||l.warn("Plugin.versionParse:",r,"is not a valid version or range.");var g=a.exec(r),i=Number(g[4]),u=Number(g[5]),o=Number(g[6]);return{isRange:!!(g[1]||g[2]),version:g[3],range:r,operator:g[1]||g[2]||"",major:i,minor:u,patch:o,parts:[i,u,o],prerelease:g[7],number:i*1e8+u*1e4+o}},e.versionSatisfies=function(r,a){a=a||"*";var g=e.versionParse(a),i=e.versionParse(r);if(g.isRange){if(g.operator==="*"||r==="*")return!0;if(g.operator===">")return i.number>g.number;if(g.operator===">=")return i.number>=g.number;if(g.operator==="~")return i.major===g.major&&i.minor===g.minor&&i.patch>=g.patch;if(g.operator==="^")return g.major>0?i.major===g.major&&i.number>=g.number:g.minor>0?i.minor===g.minor&&i.patch>=g.patch:i.patch===g.patch}return r===a||r==="*"}})()}),(function(P,E){var f={};P.exports=f,(function(){f.create=function(e){return{vertex:e,normalImpulse:0,tangentImpulse:0}}})()}),(function(P,E,f){var e={};P.exports=e;var l=f(7),r=f(18),a=f(13),g=f(19),i=f(5),u=f(6),o=f(10),t=f(0),s=f(4);(function(){e._deltaMax=1e3/60,e.create=function(n){n=n||{};var c={positionIterations:6,velocityIterations:4,constraintIterations:2,enableSleeping:!1,events:[],plugin:{},gravity:{x:0,y:1,scale:.001},timing:{timestamp:0,timeScale:1,lastDelta:0,lastElapsed:0,lastUpdatesPerFrame:0}},p=t.extend(c,n);return p.world=n.world||u.create({label:"World"}),p.pairs=n.pairs||g.create(),p.detector=n.detector||a.create(),p.detector.pairs=p.pairs,p.grid={buckets:[]},p.world.gravity=p.gravity,p.broadphase=p.grid,p.metrics={},p},e.update=function(n,c){var p=t.now(),y=n.world,w=n.detector,T=n.pairs,h=n.timing,d=h.timestamp,m;c>e._deltaMax&&t.warnOnce("Matter.Engine.update: delta argument is recommended to be less than or equal to",e._deltaMax.toFixed(3),"ms."),c=typeof c<"u"?c:t._baseDelta,c*=h.timeScale,h.timestamp+=c,h.lastDelta=c;var v={timestamp:h.timestamp,delta:c};i.trigger(n,"beforeUpdate",v);var S=u.allBodies(y),x=u.allConstraints(y);for(y.isModified&&(a.setBodies(w,S),u.setModified(y,!1,!1,!0)),n.enableSleeping&&l.update(S,c),e._bodiesApplyGravity(S,n.gravity),c>0&&e._bodiesUpdate(S,c),i.trigger(n,"beforeSolve",v),o.preSolveAll(S),m=0;m<n.constraintIterations;m++)o.solveAll(x,c);o.postSolveAll(S);var A=a.collisions(w);g.update(T,A,d),n.enableSleeping&&l.afterCollisions(T.list),T.collisionStart.length>0&&i.trigger(n,"collisionStart",{pairs:T.collisionStart,timestamp:h.timestamp,delta:c});var C=t.clamp(20/n.positionIterations,0,1);for(r.preSolvePosition(T.list),m=0;m<n.positionIterations;m++)r.solvePosition(T.list,c,C);for(r.postSolvePosition(S),o.preSolveAll(S),m=0;m<n.constraintIterations;m++)o.solveAll(x,c);for(o.postSolveAll(S),r.preSolveVelocity(T.list),m=0;m<n.velocityIterations;m++)r.solveVelocity(T.list,c);return e._bodiesUpdateVelocities(S),T.collisionActive.length>0&&i.trigger(n,"collisionActive",{pairs:T.collisionActive,timestamp:h.timestamp,delta:c}),T.collisionEnd.length>0&&i.trigger(n,"collisionEnd",{pairs:T.collisionEnd,timestamp:h.timestamp,delta:c}),e._bodiesClearForces(S),i.trigger(n,"afterUpdate",v),n.timing.lastElapsed=t.now()-p,n},e.merge=function(n,c){if(t.extend(n,c),c.world){n.world=c.world,e.clear(n);for(var p=u.allBodies(n.world),y=0;y<p.length;y++){var w=p[y];l.set(w,!1),w.id=t.nextId()}}},e.clear=function(n){g.clear(n.pairs),a.clear(n.detector)},e._bodiesClearForces=function(n){for(var c=n.length,p=0;p<c;p++){var y=n[p];y.force.x=0,y.force.y=0,y.torque=0}},e._bodiesApplyGravity=function(n,c){var p=typeof c.scale<"u"?c.scale:.001,y=n.length;if(!(c.x===0&&c.y===0||p===0))for(var w=0;w<y;w++){var T=n[w];T.isStatic||T.isSleeping||(T.force.y+=T.mass*c.y*p,T.force.x+=T.mass*c.x*p)}},e._bodiesUpdate=function(n,c){for(var p=n.length,y=0;y<p;y++){var w=n[y];w.isStatic||w.isSleeping||s.update(w,c)}},e._bodiesUpdateVelocities=function(n){for(var c=n.length,p=0;p<c;p++)s.updateVelocities(n[p])}})()}),(function(P,E,f){var e={};P.exports=e;var l=f(3),r=f(0),a=f(1);(function(){e._restingThresh=2,e._restingThreshTangent=Math.sqrt(6),e._positionDampen=.9,e._positionWarming=.8,e._frictionNormalMultiplier=5,e._frictionMaxStatic=Number.MAX_VALUE,e.preSolvePosition=function(g){var i,u,o,t=g.length;for(i=0;i<t;i++)u=g[i],u.isActive&&(o=u.contactCount,u.collision.parentA.totalContacts+=o,u.collision.parentB.totalContacts+=o)},e.solvePosition=function(g,i,u){var o,t,s,n,c,p,y,w,T=e._positionDampen*(u||1),h=r.clamp(i/r._baseDelta,0,1),d=g.length;for(o=0;o<d;o++)t=g[o],!(!t.isActive||t.isSensor)&&(s=t.collision,n=s.parentA,c=s.parentB,p=s.normal,t.separation=s.depth+p.x*(c.positionImpulse.x-n.positionImpulse.x)+p.y*(c.positionImpulse.y-n.positionImpulse.y));for(o=0;o<d;o++)t=g[o],!(!t.isActive||t.isSensor)&&(s=t.collision,n=s.parentA,c=s.parentB,p=s.normal,w=t.separation-t.slop*h,(n.isStatic||c.isStatic)&&(w*=2),n.isStatic||n.isSleeping||(y=T/n.totalContacts,n.positionImpulse.x+=p.x*w*y,n.positionImpulse.y+=p.y*w*y),c.isStatic||c.isSleeping||(y=T/c.totalContacts,c.positionImpulse.x-=p.x*w*y,c.positionImpulse.y-=p.y*w*y))},e.postSolvePosition=function(g){for(var i=e._positionWarming,u=g.length,o=l.translate,t=a.update,s=0;s<u;s++){var n=g[s],c=n.positionImpulse,p=c.x,y=c.y,w=n.velocity;if(n.totalContacts=0,p!==0||y!==0){for(var T=0;T<n.parts.length;T++){var h=n.parts[T];o(h.vertices,c),t(h.bounds,h.vertices,w),h.position.x+=p,h.position.y+=y}n.positionPrev.x+=p,n.positionPrev.y+=y,p*w.x+y*w.y<0?(c.x=0,c.y=0):(c.x*=i,c.y*=i)}}},e.preSolveVelocity=function(g){var i=g.length,u,o;for(u=0;u<i;u++){var t=g[u];if(!(!t.isActive||t.isSensor)){var s=t.contacts,n=t.contactCount,c=t.collision,p=c.parentA,y=c.parentB,w=c.normal,T=c.tangent;for(o=0;o<n;o++){var h=s[o],d=h.vertex,m=h.normalImpulse,v=h.tangentImpulse;if(m!==0||v!==0){var S=w.x*m+T.x*v,x=w.y*m+T.y*v;p.isStatic||p.isSleeping||(p.positionPrev.x+=S*p.inverseMass,p.positionPrev.y+=x*p.inverseMass,p.anglePrev+=p.inverseInertia*((d.x-p.position.x)*x-(d.y-p.position.y)*S)),y.isStatic||y.isSleeping||(y.positionPrev.x-=S*y.inverseMass,y.positionPrev.y-=x*y.inverseMass,y.anglePrev-=y.inverseInertia*((d.x-y.position.x)*x-(d.y-y.position.y)*S))}}}}},e.solveVelocity=function(g,i){var u=i/r._baseDelta,o=u*u,t=o*u,s=-e._restingThresh*u,n=e._restingThreshTangent,c=e._frictionNormalMultiplier*u,p=e._frictionMaxStatic,y=g.length,w,T,h,d;for(h=0;h<y;h++){var m=g[h];if(!(!m.isActive||m.isSensor)){var v=m.collision,S=v.parentA,x=v.parentB,A=v.normal.x,C=v.normal.y,M=v.tangent.x,B=v.tangent.y,L=m.inverseMass,O=m.friction*m.frictionStatic*c,R=m.contacts,G=m.contactCount,k=1/G,U=S.position.x-S.positionPrev.x,V=S.position.y-S.positionPrev.y,N=S.angle-S.anglePrev,Y=x.position.x-x.positionPrev.x,Q=x.position.y-x.positionPrev.y,$=x.angle-x.anglePrev;for(d=0;d<G;d++){var F=R[d],z=F.vertex,W=z.x-S.position.x,Z=z.y-S.position.y,X=z.x-x.position.x,J=z.y-x.position.y,j=U-Z*N,ge=V+W*N,ve=Y-J*$,de=Q+X*$,se=j-ve,ae=ge-de,ie=A*se+C*ae,K=M*se+B*ae,re=m.separation+ie,ne=Math.min(re,1);ne=re<0?0:ne;var oe=ne*O;K<-oe||K>oe?(T=K>0?K:-K,w=m.friction*(K>0?1:-1)*t,w<-T?w=-T:w>T&&(w=T)):(w=K,T=p);var le=W*C-Z*A,ce=X*C-J*A,fe=k/(L+S.inverseInertia*le*le+x.inverseInertia*ce*ce),q=(1+m.restitution)*ie*fe;if(w*=fe,ie<s)F.normalImpulse=0;else{var pe=F.normalImpulse;F.normalImpulse+=q,F.normalImpulse>0&&(F.normalImpulse=0),q=F.normalImpulse-pe}if(K<-n||K>n)F.tangentImpulse=0;else{var me=F.tangentImpulse;F.tangentImpulse+=w,F.tangentImpulse<-T&&(F.tangentImpulse=-T),F.tangentImpulse>T&&(F.tangentImpulse=T),w=F.tangentImpulse-me}var _=A*q+M*w,ee=C*q+B*w;S.isStatic||S.isSleeping||(S.positionPrev.x+=_*S.inverseMass,S.positionPrev.y+=ee*S.inverseMass,S.anglePrev+=(W*ee-Z*_)*S.inverseInertia),x.isStatic||x.isSleeping||(x.positionPrev.x-=_*x.inverseMass,x.positionPrev.y-=ee*x.inverseMass,x.anglePrev-=(X*ee-J*_)*x.inverseInertia)}}}}})()}),(function(P,E,f){var e={};P.exports=e;var l=f(9),r=f(0);(function(){e.create=function(a){return r.extend({table:{},list:[],collisionStart:[],collisionActive:[],collisionEnd:[]},a)},e.update=function(a,g,i){var u=l.update,o=l.create,t=l.setActive,s=a.table,n=a.list,c=n.length,p=c,y=a.collisionStart,w=a.collisionEnd,T=a.collisionActive,h=g.length,d=0,m=0,v=0,S,x,A;for(A=0;A<h;A++)S=g[A],x=S.pair,x?(x.isActive&&(T[v++]=x),u(x,S,i)):(x=o(S,i),s[x.id]=x,y[d++]=x,n[p++]=x);for(p=0,c=n.length,A=0;A<c;A++)x=n[A],x.timeUpdated>=i?n[p++]=x:(t(x,!1,i),x.collision.bodyA.sleepCounter>0&&x.collision.bodyB.sleepCounter>0?n[p++]=x:(w[m++]=x,delete s[x.id]));n.length!==p&&(n.length=p),y.length!==d&&(y.length=d),w.length!==m&&(w.length=m),T.length!==v&&(T.length=v)},e.clear=function(a){return a.table={},a.list.length=0,a.collisionStart.length=0,a.collisionActive.length=0,a.collisionEnd.length=0,a}})()}),(function(P,E,f){var e=P.exports=f(21);e.Axes=f(11),e.Bodies=f(12),e.Body=f(4),e.Bounds=f(1),e.Collision=f(8),e.Common=f(0),e.Composite=f(6),e.Composites=f(22),e.Constraint=f(10),e.Contact=f(16),e.Detector=f(13),e.Engine=f(17),e.Events=f(5),e.Grid=f(23),e.Mouse=f(14),e.MouseConstraint=f(24),e.Pair=f(9),e.Pairs=f(19),e.Plugin=f(15),e.Query=f(25),e.Render=f(26),e.Resolver=f(18),e.Runner=f(27),e.SAT=f(28),e.Sleeping=f(7),e.Svg=f(29),e.Vector=f(2),e.Vertices=f(3),e.World=f(30),e.Engine.run=e.Runner.run,e.Common.deprecated(e.Engine,"run","Engine.run âž¤ use Matter.Runner.run(engine) instead")}),(function(P,E,f){var e={};P.exports=e;var l=f(15),r=f(0);(function(){e.name="matter-js",e.version="0.20.0",e.uses=[],e.used=[],e.use=function(){l.use(e,Array.prototype.slice.call(arguments))},e.before=function(a,g){return a=a.replace(/^Matter./,""),r.chainPathBefore(e,a,g)},e.after=function(a,g){return a=a.replace(/^Matter./,""),r.chainPathAfter(e,a,g)}})()}),(function(P,E,f){var e={};P.exports=e;var l=f(6),r=f(10),a=f(0),g=f(4),i=f(12),u=a.deprecated;(function(){e.stack=function(o,t,s,n,c,p,y){for(var w=l.create({label:"Stack"}),T=o,h=t,d,m=0,v=0;v<n;v++){for(var S=0,x=0;x<s;x++){var A=y(T,h,x,v,d,m);if(A){var C=A.bounds.max.y-A.bounds.min.y,M=A.bounds.max.x-A.bounds.min.x;C>S&&(S=C),g.translate(A,{x:M*.5,y:C*.5}),T=A.bounds.max.x+c,l.addBody(w,A),d=A,m+=1}else T+=c}h+=S+p,T=o}return w},e.chain=function(o,t,s,n,c,p){for(var y=o.bodies,w=1;w<y.length;w++){var T=y[w-1],h=y[w],d=T.bounds.max.y-T.bounds.min.y,m=T.bounds.max.x-T.bounds.min.x,v=h.bounds.max.y-h.bounds.min.y,S=h.bounds.max.x-h.bounds.min.x,x={bodyA:T,pointA:{x:m*t,y:d*s},bodyB:h,pointB:{x:S*n,y:v*c}},A=a.extend(x,p);l.addConstraint(o,r.create(A))}return o.label+=" Chain",o},e.mesh=function(o,t,s,n,c){var p=o.bodies,y,w,T,h,d;for(y=0;y<s;y++){for(w=1;w<t;w++)T=p[w-1+y*t],h=p[w+y*t],l.addConstraint(o,r.create(a.extend({bodyA:T,bodyB:h},c)));if(y>0)for(w=0;w<t;w++)T=p[w+(y-1)*t],h=p[w+y*t],l.addConstraint(o,r.create(a.extend({bodyA:T,bodyB:h},c))),n&&w>0&&(d=p[w-1+(y-1)*t],l.addConstraint(o,r.create(a.extend({bodyA:d,bodyB:h},c)))),n&&w<t-1&&(d=p[w+1+(y-1)*t],l.addConstraint(o,r.create(a.extend({bodyA:d,bodyB:h},c))))}return o.label+=" Mesh",o},e.pyramid=function(o,t,s,n,c,p,y){return e.stack(o,t,s,n,c,p,function(w,T,h,d,m,v){var S=Math.min(n,Math.ceil(s/2)),x=m?m.bounds.max.x-m.bounds.min.x:0;if(!(d>S)){d=S-d;var A=d,C=s-1-d;if(!(h<A||h>C)){v===1&&g.translate(m,{x:(h+(s%2===1?1:-1))*x,y:0});var M=m?h*x:0;return y(o+M+h*c,T,h,d,m,v)}}})},e.newtonsCradle=function(o,t,s,n,c){for(var p=l.create({label:"Newtons Cradle"}),y=0;y<s;y++){var w=1.9,T=i.circle(o+y*(n*w),t+c,n,{inertia:1/0,restitution:1,friction:0,frictionAir:1e-4,slop:1}),h=r.create({pointA:{x:o+y*(n*w),y:t},bodyB:T});l.addBody(p,T),l.addConstraint(p,h)}return p},u(e,"newtonsCradle","Composites.newtonsCradle âž¤ moved to newtonsCradle example"),e.car=function(o,t,s,n,c){var p=g.nextGroup(!0),y=20,w=-s*.5+y,T=s*.5-y,h=0,d=l.create({label:"Car"}),m=i.rectangle(o,t,s,n,{collisionFilter:{group:p},chamfer:{radius:n*.5},density:2e-4}),v=i.circle(o+w,t+h,c,{collisionFilter:{group:p},friction:.8}),S=i.circle(o+T,t+h,c,{collisionFilter:{group:p},friction:.8}),x=r.create({bodyB:m,pointB:{x:w,y:h},bodyA:v,stiffness:1,length:0}),A=r.create({bodyB:m,pointB:{x:T,y:h},bodyA:S,stiffness:1,length:0});return l.addBody(d,m),l.addBody(d,v),l.addBody(d,S),l.addConstraint(d,x),l.addConstraint(d,A),d},u(e,"car","Composites.car âž¤ moved to car example"),e.softBody=function(o,t,s,n,c,p,y,w,T,h){T=a.extend({inertia:1/0},T),h=a.extend({stiffness:.2,render:{type:"line",anchors:!1}},h);var d=e.stack(o,t,s,n,c,p,function(m,v){return i.circle(m,v,w,T)});return e.mesh(d,s,n,y,h),d.label="Soft Body",d},u(e,"softBody","Composites.softBody âž¤ moved to softBody and cloth examples")})()}),(function(P,E,f){var e={};P.exports=e;var l=f(9),r=f(0),a=r.deprecated;(function(){e.create=function(g){var i={buckets:{},pairs:{},pairsList:[],bucketWidth:48,bucketHeight:48};return r.extend(i,g)},e.update=function(g,i,u,o){var t,s,n,c=u.world,p=g.buckets,y,w,T=!1;for(t=0;t<i.length;t++){var h=i[t];if(!(h.isSleeping&&!o)&&!(c.bounds&&(h.bounds.max.x<c.bounds.min.x||h.bounds.min.x>c.bounds.max.x||h.bounds.max.y<c.bounds.min.y||h.bounds.min.y>c.bounds.max.y))){var d=e._getRegion(g,h);if(!h.region||d.id!==h.region.id||o){(!h.region||o)&&(h.region=d);var m=e._regionUnion(d,h.region);for(s=m.startCol;s<=m.endCol;s++)for(n=m.startRow;n<=m.endRow;n++){w=e._getBucketId(s,n),y=p[w];var v=s>=d.startCol&&s<=d.endCol&&n>=d.startRow&&n<=d.endRow,S=s>=h.region.startCol&&s<=h.region.endCol&&n>=h.region.startRow&&n<=h.region.endRow;!v&&S&&S&&y&&e._bucketRemoveBody(g,y,h),(h.region===d||v&&!S||o)&&(y||(y=e._createBucket(p,w)),e._bucketAddBody(g,y,h))}h.region=d,T=!0}}}T&&(g.pairsList=e._createActivePairsList(g))},a(e,"update","Grid.update âž¤ replaced by Matter.Detector"),e.clear=function(g){g.buckets={},g.pairs={},g.pairsList=[]},a(e,"clear","Grid.clear âž¤ replaced by Matter.Detector"),e._regionUnion=function(g,i){var u=Math.min(g.startCol,i.startCol),o=Math.max(g.endCol,i.endCol),t=Math.min(g.startRow,i.startRow),s=Math.max(g.endRow,i.endRow);return e._createRegion(u,o,t,s)},e._getRegion=function(g,i){var u=i.bounds,o=Math.floor(u.min.x/g.bucketWidth),t=Math.floor(u.max.x/g.bucketWidth),s=Math.floor(u.min.y/g.bucketHeight),n=Math.floor(u.max.y/g.bucketHeight);return e._createRegion(o,t,s,n)},e._createRegion=function(g,i,u,o){return{id:g+","+i+","+u+","+o,startCol:g,endCol:i,startRow:u,endRow:o}},e._getBucketId=function(g,i){return"C"+g+"R"+i},e._createBucket=function(g,i){var u=g[i]=[];return u},e._bucketAddBody=function(g,i,u){var o=g.pairs,t=l.id,s=i.length,n;for(n=0;n<s;n++){var c=i[n];if(!(u.id===c.id||u.isStatic&&c.isStatic)){var p=t(u,c),y=o[p];y?y[2]+=1:o[p]=[u,c,1]}}i.push(u)},e._bucketRemoveBody=function(g,i,u){var o=g.pairs,t=l.id,s;i.splice(r.indexOf(i,u),1);var n=i.length;for(s=0;s<n;s++){var c=o[t(u,i[s])];c&&(c[2]-=1)}},e._createActivePairsList=function(g){var i,u=g.pairs,o=r.keys(u),t=o.length,s=[],n;for(n=0;n<t;n++)i=u[o[n]],i[2]>0?s.push(i):delete u[o[n]];return s}})()}),(function(P,E,f){var e={};P.exports=e;var l=f(3),r=f(7),a=f(14),g=f(5),i=f(13),u=f(10),o=f(6),t=f(0),s=f(1);(function(){e.create=function(n,c){var p=(n?n.mouse:null)||(c?c.mouse:null);p||(n&&n.render&&n.render.canvas?p=a.create(n.render.canvas):c&&c.element?p=a.create(c.element):(p=a.create(),t.warn("MouseConstraint.create: options.mouse was undefined, options.element was undefined, may not function as expected")));var y=u.create({label:"Mouse Constraint",pointA:p.position,pointB:{x:0,y:0},length:.01,stiffness:.1,angularStiffness:1,render:{strokeStyle:"#90EE90",lineWidth:3}}),w={type:"mouseConstraint",mouse:p,element:null,body:null,constraint:y,collisionFilter:{category:1,mask:4294967295,group:0}},T=t.extend(w,c);return g.on(n,"beforeUpdate",function(){var h=o.allBodies(n.world);e.update(T,h),e._triggerEvents(T)}),T},e.update=function(n,c){var p=n.mouse,y=n.constraint,w=n.body;if(p.button===0){if(y.bodyB)r.set(y.bodyB,!1),y.pointA=p.position;else for(var T=0;T<c.length;T++)if(w=c[T],s.contains(w.bounds,p.position)&&i.canCollide(w.collisionFilter,n.collisionFilter))for(var h=w.parts.length>1?1:0;h<w.parts.length;h++){var d=w.parts[h];if(l.contains(d.vertices,p.position)){y.pointA=p.position,y.bodyB=n.body=w,y.pointB={x:p.position.x-w.position.x,y:p.position.y-w.position.y},y.angleB=w.angle,r.set(w,!1),g.trigger(n,"startdrag",{mouse:p,body:w});break}}}else y.bodyB=n.body=null,y.pointB=null,w&&g.trigger(n,"enddrag",{mouse:p,body:w})},e._triggerEvents=function(n){var c=n.mouse,p=c.sourceEvents;p.mousemove&&g.trigger(n,"mousemove",{mouse:c}),p.mousedown&&g.trigger(n,"mousedown",{mouse:c}),p.mouseup&&g.trigger(n,"mouseup",{mouse:c}),a.clearSourceEvents(c)}})()}),(function(P,E,f){var e={};P.exports=e;var l=f(2),r=f(8),a=f(1),g=f(12),i=f(3);(function(){e.collides=function(u,o){for(var t=[],s=o.length,n=u.bounds,c=r.collides,p=a.overlaps,y=0;y<s;y++){var w=o[y],T=w.parts.length,h=T===1?0:1;if(p(w.bounds,n))for(var d=h;d<T;d++){var m=w.parts[d];if(p(m.bounds,n)){var v=c(m,u);if(v){t.push(v);break}}}}return t},e.ray=function(u,o,t,s){s=s||1e-100;for(var n=l.angle(o,t),c=l.magnitude(l.sub(o,t)),p=(t.x+o.x)*.5,y=(t.y+o.y)*.5,w=g.rectangle(p,y,c,s,{angle:n}),T=e.collides(w,u),h=0;h<T.length;h+=1){var d=T[h];d.body=d.bodyB=d.bodyA}return T},e.region=function(u,o,t){for(var s=[],n=0;n<u.length;n++){var c=u[n],p=a.overlaps(c.bounds,o);(p&&!t||!p&&t)&&s.push(c)}return s},e.point=function(u,o){for(var t=[],s=0;s<u.length;s++){var n=u[s];if(a.contains(n.bounds,o))for(var c=n.parts.length===1?0:1;c<n.parts.length;c++){var p=n.parts[c];if(a.contains(p.bounds,o)&&i.contains(p.vertices,o)){t.push(n);break}}}return t}})()}),(function(P,E,f){var e={};P.exports=e;var l=f(4),r=f(0),a=f(6),g=f(1),i=f(5),u=f(2),o=f(14);(function(){var t,s;typeof window<"u"&&(t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(h){window.setTimeout(function(){h(r.now())},1e3/60)},s=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),e._goodFps=30,e._goodDelta=1e3/60,e.create=function(h){var d={engine:null,element:null,canvas:null,mouse:null,frameRequestId:null,timing:{historySize:60,delta:0,deltaHistory:[],lastTime:0,lastTimestamp:0,lastElapsed:0,timestampElapsed:0,timestampElapsedHistory:[],engineDeltaHistory:[],engineElapsedHistory:[],engineUpdatesHistory:[],elapsedHistory:[]},options:{width:800,height:600,pixelRatio:1,background:"#14151f",wireframeBackground:"#14151f",wireframeStrokeStyle:"#bbb",hasBounds:!!h.bounds,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showStats:!1,showPerformance:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1}},m=r.extend(d,h);return m.canvas&&(m.canvas.width=m.options.width||m.canvas.width,m.canvas.height=m.options.height||m.canvas.height),m.mouse=h.mouse,m.engine=h.engine,m.canvas=m.canvas||p(m.options.width,m.options.height),m.context=m.canvas.getContext("2d"),m.textures={},m.bounds=m.bounds||{min:{x:0,y:0},max:{x:m.canvas.width,y:m.canvas.height}},m.controller=e,m.options.showBroadphase=!1,m.options.pixelRatio!==1&&e.setPixelRatio(m,m.options.pixelRatio),r.isElement(m.element)&&m.element.appendChild(m.canvas),m},e.run=function(h){(function d(m){h.frameRequestId=t(d),n(h,m),e.world(h,m),h.context.setTransform(h.options.pixelRatio,0,0,h.options.pixelRatio,0,0),(h.options.showStats||h.options.showDebug)&&e.stats(h,h.context,m),(h.options.showPerformance||h.options.showDebug)&&e.performance(h,h.context,m),h.context.setTransform(1,0,0,1,0,0)})()},e.stop=function(h){s(h.frameRequestId)},e.setPixelRatio=function(h,d){var m=h.options,v=h.canvas;d==="auto"&&(d=y(v)),m.pixelRatio=d,v.setAttribute("data-pixel-ratio",d),v.width=m.width*d,v.height=m.height*d,v.style.width=m.width+"px",v.style.height=m.height+"px"},e.setSize=function(h,d,m){h.options.width=d,h.options.height=m,h.bounds.max.x=h.bounds.min.x+d,h.bounds.max.y=h.bounds.min.y+m,h.options.pixelRatio!==1?e.setPixelRatio(h,h.options.pixelRatio):(h.canvas.width=d,h.canvas.height=m)},e.lookAt=function(h,d,m,v){v=typeof v<"u"?v:!0,d=r.isArray(d)?d:[d],m=m||{x:0,y:0};for(var S={min:{x:1/0,y:1/0},max:{x:-1/0,y:-1/0}},x=0;x<d.length;x+=1){var A=d[x],C=A.bounds?A.bounds.min:A.min||A.position||A,M=A.bounds?A.bounds.max:A.max||A.position||A;C&&M&&(C.x<S.min.x&&(S.min.x=C.x),M.x>S.max.x&&(S.max.x=M.x),C.y<S.min.y&&(S.min.y=C.y),M.y>S.max.y&&(S.max.y=M.y))}var B=S.max.x-S.min.x+2*m.x,L=S.max.y-S.min.y+2*m.y,O=h.canvas.height,R=h.canvas.width,G=R/O,k=B/L,U=1,V=1;k>G?V=k/G:U=G/k,h.options.hasBounds=!0,h.bounds.min.x=S.min.x,h.bounds.max.x=S.min.x+B*U,h.bounds.min.y=S.min.y,h.bounds.max.y=S.min.y+L*V,v&&(h.bounds.min.x+=B*.5-B*U*.5,h.bounds.max.x+=B*.5-B*U*.5,h.bounds.min.y+=L*.5-L*V*.5,h.bounds.max.y+=L*.5-L*V*.5),h.bounds.min.x-=m.x,h.bounds.max.x-=m.x,h.bounds.min.y-=m.y,h.bounds.max.y-=m.y,h.mouse&&(o.setScale(h.mouse,{x:(h.bounds.max.x-h.bounds.min.x)/h.canvas.width,y:(h.bounds.max.y-h.bounds.min.y)/h.canvas.height}),o.setOffset(h.mouse,h.bounds.min))},e.startViewTransform=function(h){var d=h.bounds.max.x-h.bounds.min.x,m=h.bounds.max.y-h.bounds.min.y,v=d/h.options.width,S=m/h.options.height;h.context.setTransform(h.options.pixelRatio/v,0,0,h.options.pixelRatio/S,0,0),h.context.translate(-h.bounds.min.x,-h.bounds.min.y)},e.endViewTransform=function(h){h.context.setTransform(h.options.pixelRatio,0,0,h.options.pixelRatio,0,0)},e.world=function(h,d){var m=r.now(),v=h.engine,S=v.world,x=h.canvas,A=h.context,C=h.options,M=h.timing,B=a.allBodies(S),L=a.allConstraints(S),O=C.wireframes?C.wireframeBackground:C.background,R=[],G=[],k,U={timestamp:v.timing.timestamp};if(i.trigger(h,"beforeRender",U),h.currentBackground!==O&&T(h,O),A.globalCompositeOperation="source-in",A.fillStyle="transparent",A.fillRect(0,0,x.width,x.height),A.globalCompositeOperation="source-over",C.hasBounds){for(k=0;k<B.length;k++){var V=B[k];g.overlaps(V.bounds,h.bounds)&&R.push(V)}for(k=0;k<L.length;k++){var N=L[k],Y=N.bodyA,Q=N.bodyB,$=N.pointA,F=N.pointB;Y&&($=u.add(Y.position,N.pointA)),Q&&(F=u.add(Q.position,N.pointB)),!(!$||!F)&&(g.contains(h.bounds,$)||g.contains(h.bounds,F))&&G.push(N)}e.startViewTransform(h),h.mouse&&(o.setScale(h.mouse,{x:(h.bounds.max.x-h.bounds.min.x)/h.options.width,y:(h.bounds.max.y-h.bounds.min.y)/h.options.height}),o.setOffset(h.mouse,h.bounds.min))}else G=L,R=B,h.options.pixelRatio!==1&&h.context.setTransform(h.options.pixelRatio,0,0,h.options.pixelRatio,0,0);!C.wireframes||v.enableSleeping&&C.showSleeping?e.bodies(h,R,A):(C.showConvexHulls&&e.bodyConvexHulls(h,R,A),e.bodyWireframes(h,R,A)),C.showBounds&&e.bodyBounds(h,R,A),(C.showAxes||C.showAngleIndicator)&&e.bodyAxes(h,R,A),C.showPositions&&e.bodyPositions(h,R,A),C.showVelocity&&e.bodyVelocity(h,R,A),C.showIds&&e.bodyIds(h,R,A),C.showSeparations&&e.separations(h,v.pairs.list,A),C.showCollisions&&e.collisions(h,v.pairs.list,A),C.showVertexNumbers&&e.vertexNumbers(h,R,A),C.showMousePosition&&e.mousePosition(h,h.mouse,A),e.constraints(G,A),C.hasBounds&&e.endViewTransform(h),i.trigger(h,"afterRender",U),M.lastElapsed=r.now()-m},e.stats=function(h,d,m){for(var v=h.engine,S=v.world,x=a.allBodies(S),A=0,C=55,M=44,B=0,L=0,O=0;O<x.length;O+=1)A+=x[O].parts.length;var R={Part:A,Body:x.length,Cons:a.allConstraints(S).length,Comp:a.allComposites(S).length,Pair:v.pairs.list.length};d.fillStyle="#0e0f19",d.fillRect(B,L,C*5.5,M),d.font="12px Arial",d.textBaseline="top",d.textAlign="right";for(var G in R){var k=R[G];d.fillStyle="#aaa",d.fillText(G,B+C,L+8),d.fillStyle="#eee",d.fillText(k,B+C,L+26),B+=C}},e.performance=function(h,d){var m=h.engine,v=h.timing,S=v.deltaHistory,x=v.elapsedHistory,A=v.timestampElapsedHistory,C=v.engineDeltaHistory,M=v.engineUpdatesHistory,B=v.engineElapsedHistory,L=m.timing.lastUpdatesPerFrame,O=m.timing.lastDelta,R=c(S),G=c(x),k=c(C),U=c(M),V=c(B),N=c(A),Y=N/R||0,Q=Math.round(R/O),$=1e3/R||0,F=4,z=12,W=60,Z=34,X=10,J=69;d.fillStyle="#0e0f19",d.fillRect(0,50,z*5+W*6+22,Z),e.status(d,X,J,W,F,S.length,Math.round($)+" fps",$/e._goodFps,function(j){return S[j]/R-1}),e.status(d,X+z+W,J,W,F,C.length,O.toFixed(2)+" dt",e._goodDelta/O,function(j){return C[j]/k-1}),e.status(d,X+(z+W)*2,J,W,F,M.length,L+" upf",Math.pow(r.clamp(U/Q||1,0,1),4),function(j){return M[j]/U-1}),e.status(d,X+(z+W)*3,J,W,F,B.length,V.toFixed(2)+" ut",1-L*V/e._goodFps,function(j){return B[j]/V-1}),e.status(d,X+(z+W)*4,J,W,F,x.length,G.toFixed(2)+" rt",1-G/e._goodFps,function(j){return x[j]/G-1}),e.status(d,X+(z+W)*5,J,W,F,A.length,Y.toFixed(2)+" x",Y*Y*Y,function(j){return(A[j]/S[j]/Y||0)-1})},e.status=function(h,d,m,v,S,x,A,C,M){h.strokeStyle="#888",h.fillStyle="#444",h.lineWidth=1,h.fillRect(d,m+7,v,1),h.beginPath(),h.moveTo(d,m+7-S*r.clamp(.4*M(0),-2,2));for(var B=0;B<v;B+=1)h.lineTo(d+B,m+7-(B<x?S*r.clamp(.4*M(B),-2,2):0));h.stroke(),h.fillStyle="hsl("+r.clamp(25+95*C,0,120)+",100%,60%)",h.fillRect(d,m-7,4,4),h.font="12px Arial",h.textBaseline="middle",h.textAlign="right",h.fillStyle="#eee",h.fillText(A,d+v,m-5)},e.constraints=function(h,d){for(var m=d,v=0;v<h.length;v++){var S=h[v];if(!(!S.render.visible||!S.pointA||!S.pointB)){var x=S.bodyA,A=S.bodyB,C,M;if(x?C=u.add(x.position,S.pointA):C=S.pointA,S.render.type==="pin")m.beginPath(),m.arc(C.x,C.y,3,0,2*Math.PI),m.closePath();else{if(A?M=u.add(A.position,S.pointB):M=S.pointB,m.beginPath(),m.moveTo(C.x,C.y),S.render.type==="spring")for(var B=u.sub(M,C),L=u.perp(u.normalise(B)),O=Math.ceil(r.clamp(S.length/5,12,20)),R,G=1;G<O;G+=1)R=G%2===0?1:-1,m.lineTo(C.x+B.x*(G/O)+L.x*R*4,C.y+B.y*(G/O)+L.y*R*4);m.lineTo(M.x,M.y)}S.render.lineWidth&&(m.lineWidth=S.render.lineWidth,m.strokeStyle=S.render.strokeStyle,m.stroke()),S.render.anchors&&(m.fillStyle=S.render.strokeStyle,m.beginPath(),m.arc(C.x,C.y,3,0,2*Math.PI),m.arc(M.x,M.y,3,0,2*Math.PI),m.closePath(),m.fill())}}},e.bodies=function(h,d,m){var v=m;h.engine;var S=h.options,x=S.showInternalEdges||!S.wireframes,A,C,M,B;for(M=0;M<d.length;M++)if(A=d[M],!!A.render.visible){for(B=A.parts.length>1?1:0;B<A.parts.length;B++)if(C=A.parts[B],!!C.render.visible){if(S.showSleeping&&A.isSleeping?v.globalAlpha=.5*C.render.opacity:C.render.opacity!==1&&(v.globalAlpha=C.render.opacity),C.render.sprite&&C.render.sprite.texture&&!S.wireframes){var L=C.render.sprite,O=w(h,L.texture);v.translate(C.position.x,C.position.y),v.rotate(C.angle),v.drawImage(O,O.width*-L.xOffset*L.xScale,O.height*-L.yOffset*L.yScale,O.width*L.xScale,O.height*L.yScale),v.rotate(-C.angle),v.translate(-C.position.x,-C.position.y)}else{if(C.circleRadius)v.beginPath(),v.arc(C.position.x,C.position.y,C.circleRadius,0,2*Math.PI);else{v.beginPath(),v.moveTo(C.vertices[0].x,C.vertices[0].y);for(var R=1;R<C.vertices.length;R++)!C.vertices[R-1].isInternal||x?v.lineTo(C.vertices[R].x,C.vertices[R].y):v.moveTo(C.vertices[R].x,C.vertices[R].y),C.vertices[R].isInternal&&!x&&v.moveTo(C.vertices[(R+1)%C.vertices.length].x,C.vertices[(R+1)%C.vertices.length].y);v.lineTo(C.vertices[0].x,C.vertices[0].y),v.closePath()}S.wireframes?(v.lineWidth=1,v.strokeStyle=h.options.wireframeStrokeStyle,v.stroke()):(v.fillStyle=C.render.fillStyle,C.render.lineWidth&&(v.lineWidth=C.render.lineWidth,v.strokeStyle=C.render.strokeStyle,v.stroke()),v.fill())}v.globalAlpha=1}}},e.bodyWireframes=function(h,d,m){var v=m,S=h.options.showInternalEdges,x,A,C,M,B;for(v.beginPath(),C=0;C<d.length;C++)if(x=d[C],!!x.render.visible)for(B=x.parts.length>1?1:0;B<x.parts.length;B++){for(A=x.parts[B],v.moveTo(A.vertices[0].x,A.vertices[0].y),M=1;M<A.vertices.length;M++)!A.vertices[M-1].isInternal||S?v.lineTo(A.vertices[M].x,A.vertices[M].y):v.moveTo(A.vertices[M].x,A.vertices[M].y),A.vertices[M].isInternal&&!S&&v.moveTo(A.vertices[(M+1)%A.vertices.length].x,A.vertices[(M+1)%A.vertices.length].y);v.lineTo(A.vertices[0].x,A.vertices[0].y)}v.lineWidth=1,v.strokeStyle=h.options.wireframeStrokeStyle,v.stroke()},e.bodyConvexHulls=function(h,d,m){var v=m,S,x,A;for(v.beginPath(),x=0;x<d.length;x++)if(S=d[x],!(!S.render.visible||S.parts.length===1)){for(v.moveTo(S.vertices[0].x,S.vertices[0].y),A=1;A<S.vertices.length;A++)v.lineTo(S.vertices[A].x,S.vertices[A].y);v.lineTo(S.vertices[0].x,S.vertices[0].y)}v.lineWidth=1,v.strokeStyle="rgba(255,255,255,0.2)",v.stroke()},e.vertexNumbers=function(h,d,m){var v=m,S,x,A;for(S=0;S<d.length;S++){var C=d[S].parts;for(A=C.length>1?1:0;A<C.length;A++){var M=C[A];for(x=0;x<M.vertices.length;x++)v.fillStyle="rgba(255,255,255,0.2)",v.fillText(S+"_"+x,M.position.x+(M.vertices[x].x-M.position.x)*.8,M.position.y+(M.vertices[x].y-M.position.y)*.8)}}},e.mousePosition=function(h,d,m){var v=m;v.fillStyle="rgba(255,255,255,0.8)",v.fillText(d.position.x+"  "+d.position.y,d.position.x+5,d.position.y-5)},e.bodyBounds=function(h,d,m){var v=m;h.engine;var S=h.options;v.beginPath();for(var x=0;x<d.length;x++){var A=d[x];if(A.render.visible)for(var C=d[x].parts,M=C.length>1?1:0;M<C.length;M++){var B=C[M];v.rect(B.bounds.min.x,B.bounds.min.y,B.bounds.max.x-B.bounds.min.x,B.bounds.max.y-B.bounds.min.y)}}S.wireframes?v.strokeStyle="rgba(255,255,255,0.08)":v.strokeStyle="rgba(0,0,0,0.1)",v.lineWidth=1,v.stroke()},e.bodyAxes=function(h,d,m){var v=m;h.engine;var S=h.options,x,A,C,M;for(v.beginPath(),A=0;A<d.length;A++){var B=d[A],L=B.parts;if(B.render.visible)if(S.showAxes)for(C=L.length>1?1:0;C<L.length;C++)for(x=L[C],M=0;M<x.axes.length;M++){var O=x.axes[M];v.moveTo(x.position.x,x.position.y),v.lineTo(x.position.x+O.x*20,x.position.y+O.y*20)}else for(C=L.length>1?1:0;C<L.length;C++)for(x=L[C],M=0;M<x.axes.length;M++)v.moveTo(x.position.x,x.position.y),v.lineTo((x.vertices[0].x+x.vertices[x.vertices.length-1].x)/2,(x.vertices[0].y+x.vertices[x.vertices.length-1].y)/2)}S.wireframes?(v.strokeStyle="indianred",v.lineWidth=1):(v.strokeStyle="rgba(255, 255, 255, 0.4)",v.globalCompositeOperation="overlay",v.lineWidth=2),v.stroke(),v.globalCompositeOperation="source-over"},e.bodyPositions=function(h,d,m){var v=m;h.engine;var S=h.options,x,A,C,M;for(v.beginPath(),C=0;C<d.length;C++)if(x=d[C],!!x.render.visible)for(M=0;M<x.parts.length;M++)A=x.parts[M],v.arc(A.position.x,A.position.y,3,0,2*Math.PI,!1),v.closePath();for(S.wireframes?v.fillStyle="indianred":v.fillStyle="rgba(0,0,0,0.5)",v.fill(),v.beginPath(),C=0;C<d.length;C++)x=d[C],x.render.visible&&(v.arc(x.positionPrev.x,x.positionPrev.y,2,0,2*Math.PI,!1),v.closePath());v.fillStyle="rgba(255,165,0,0.8)",v.fill()},e.bodyVelocity=function(h,d,m){var v=m;v.beginPath();for(var S=0;S<d.length;S++){var x=d[S];if(x.render.visible){var A=l.getVelocity(x);v.moveTo(x.position.x,x.position.y),v.lineTo(x.position.x+A.x,x.position.y+A.y)}}v.lineWidth=3,v.strokeStyle="cornflowerblue",v.stroke()},e.bodyIds=function(h,d,m){var v=m,S,x;for(S=0;S<d.length;S++)if(d[S].render.visible){var A=d[S].parts;for(x=A.length>1?1:0;x<A.length;x++){var C=A[x];v.font="12px Arial",v.fillStyle="rgba(255,255,255,0.5)",v.fillText(C.id,C.position.x+10,C.position.y-10)}}},e.collisions=function(h,d,m){var v=m,S=h.options,x,A,C,M;for(v.beginPath(),C=0;C<d.length;C++)if(x=d[C],!!x.isActive)for(A=x.collision,M=0;M<x.contactCount;M++){var B=x.contacts[M],L=B.vertex;v.rect(L.x-1.5,L.y-1.5,3.5,3.5)}for(S.wireframes?v.fillStyle="rgba(255,255,255,0.7)":v.fillStyle="orange",v.fill(),v.beginPath(),C=0;C<d.length;C++)if(x=d[C],!!x.isActive&&(A=x.collision,x.contactCount>0)){var O=x.contacts[0].vertex.x,R=x.contacts[0].vertex.y;x.contactCount===2&&(O=(x.contacts[0].vertex.x+x.contacts[1].vertex.x)/2,R=(x.contacts[0].vertex.y+x.contacts[1].vertex.y)/2),A.bodyB===A.supports[0].body||A.bodyA.isStatic===!0?v.moveTo(O-A.normal.x*8,R-A.normal.y*8):v.moveTo(O+A.normal.x*8,R+A.normal.y*8),v.lineTo(O,R)}S.wireframes?v.strokeStyle="rgba(255,165,0,0.7)":v.strokeStyle="orange",v.lineWidth=1,v.stroke()},e.separations=function(h,d,m){var v=m,S=h.options,x,A,C,M,B;for(v.beginPath(),B=0;B<d.length;B++)if(x=d[B],!!x.isActive){A=x.collision,C=A.bodyA,M=A.bodyB;var L=1;!M.isStatic&&!C.isStatic&&(L=.5),M.isStatic&&(L=0),v.moveTo(M.position.x,M.position.y),v.lineTo(M.position.x-A.penetration.x*L,M.position.y-A.penetration.y*L),L=1,!M.isStatic&&!C.isStatic&&(L=.5),C.isStatic&&(L=0),v.moveTo(C.position.x,C.position.y),v.lineTo(C.position.x+A.penetration.x*L,C.position.y+A.penetration.y*L)}S.wireframes?v.strokeStyle="rgba(255,165,0,0.5)":v.strokeStyle="orange",v.stroke()},e.inspector=function(h,d){h.engine;var m=h.selected,v=h.render,S=v.options,x;if(S.hasBounds){var A=v.bounds.max.x-v.bounds.min.x,C=v.bounds.max.y-v.bounds.min.y,M=A/v.options.width,B=C/v.options.height;d.scale(1/M,1/B),d.translate(-v.bounds.min.x,-v.bounds.min.y)}for(var L=0;L<m.length;L++){var O=m[L].data;switch(d.translate(.5,.5),d.lineWidth=1,d.strokeStyle="rgba(255,165,0,0.9)",d.setLineDash([1,2]),O.type){case"body":x=O.bounds,d.beginPath(),d.rect(Math.floor(x.min.x-3),Math.floor(x.min.y-3),Math.floor(x.max.x-x.min.x+6),Math.floor(x.max.y-x.min.y+6)),d.closePath(),d.stroke();break;case"constraint":var R=O.pointA;O.bodyA&&(R=O.pointB),d.beginPath(),d.arc(R.x,R.y,10,0,2*Math.PI),d.closePath(),d.stroke();break}d.setLineDash([]),d.translate(-.5,-.5)}h.selectStart!==null&&(d.translate(.5,.5),d.lineWidth=1,d.strokeStyle="rgba(255,165,0,0.6)",d.fillStyle="rgba(255,165,0,0.1)",x=h.selectBounds,d.beginPath(),d.rect(Math.floor(x.min.x),Math.floor(x.min.y),Math.floor(x.max.x-x.min.x),Math.floor(x.max.y-x.min.y)),d.closePath(),d.stroke(),d.fill(),d.translate(-.5,-.5)),S.hasBounds&&d.setTransform(1,0,0,1,0,0)};var n=function(h,d){var m=h.engine,v=h.timing,S=v.historySize,x=m.timing.timestamp;v.delta=d-v.lastTime||e._goodDelta,v.lastTime=d,v.timestampElapsed=x-v.lastTimestamp||0,v.lastTimestamp=x,v.deltaHistory.unshift(v.delta),v.deltaHistory.length=Math.min(v.deltaHistory.length,S),v.engineDeltaHistory.unshift(m.timing.lastDelta),v.engineDeltaHistory.length=Math.min(v.engineDeltaHistory.length,S),v.timestampElapsedHistory.unshift(v.timestampElapsed),v.timestampElapsedHistory.length=Math.min(v.timestampElapsedHistory.length,S),v.engineUpdatesHistory.unshift(m.timing.lastUpdatesPerFrame),v.engineUpdatesHistory.length=Math.min(v.engineUpdatesHistory.length,S),v.engineElapsedHistory.unshift(m.timing.lastElapsed),v.engineElapsedHistory.length=Math.min(v.engineElapsedHistory.length,S),v.elapsedHistory.unshift(v.lastElapsed),v.elapsedHistory.length=Math.min(v.elapsedHistory.length,S)},c=function(h){for(var d=0,m=0;m<h.length;m+=1)d+=h[m];return d/h.length||0},p=function(h,d){var m=document.createElement("canvas");return m.width=h,m.height=d,m.oncontextmenu=function(){return!1},m.onselectstart=function(){return!1},m},y=function(h){var d=h.getContext("2d"),m=window.devicePixelRatio||1,v=d.webkitBackingStorePixelRatio||d.mozBackingStorePixelRatio||d.msBackingStorePixelRatio||d.oBackingStorePixelRatio||d.backingStorePixelRatio||1;return m/v},w=function(h,d){var m=h.textures[d];return m||(m=h.textures[d]=new Image,m.src=d,m)},T=function(h,d){var m=d;/(jpg|gif|png)$/.test(d)&&(m="url("+d+")"),h.canvas.style.background=m,h.canvas.style.backgroundSize="contain",h.currentBackground=d}})()}),(function(P,E,f){var e={};P.exports=e;var l=f(5),r=f(17),a=f(0);(function(){e._maxFrameDelta=1e3/15,e._frameDeltaFallback=1e3/60,e._timeBufferMargin=1.5,e._elapsedNextEstimate=1,e._smoothingLowerBound=.1,e._smoothingUpperBound=.9,e.create=function(i){var u={delta:16.666666666666668,frameDelta:null,frameDeltaSmoothing:!0,frameDeltaSnapping:!0,frameDeltaHistory:[],frameDeltaHistorySize:100,frameRequestId:null,timeBuffer:0,timeLastTick:null,maxUpdates:null,maxFrameTime:33.333333333333336,lastUpdatesDeferred:0,enabled:!0},o=a.extend(u,i);return o.fps=0,o},e.run=function(i,u){return i.timeBuffer=e._frameDeltaFallback,(function o(t){i.frameRequestId=e._onNextFrame(i,o),t&&i.enabled&&e.tick(i,u,t)})(),i},e.tick=function(i,u,o){var t=a.now(),s=i.delta,n=0,c=o-i.timeLastTick;if((!c||!i.timeLastTick||c>Math.max(e._maxFrameDelta,i.maxFrameTime))&&(c=i.frameDelta||e._frameDeltaFallback),i.frameDeltaSmoothing){i.frameDeltaHistory.push(c),i.frameDeltaHistory=i.frameDeltaHistory.slice(-i.frameDeltaHistorySize);var p=i.frameDeltaHistory.slice(0).sort(),y=i.frameDeltaHistory.slice(p.length*e._smoothingLowerBound,p.length*e._smoothingUpperBound),w=g(y);c=w||c}i.frameDeltaSnapping&&(c=1e3/Math.round(1e3/c)),i.frameDelta=c,i.timeLastTick=o,i.timeBuffer+=i.frameDelta,i.timeBuffer=a.clamp(i.timeBuffer,0,i.frameDelta+s*e._timeBufferMargin),i.lastUpdatesDeferred=0;var T=i.maxUpdates||Math.ceil(i.maxFrameTime/s),h={timestamp:u.timing.timestamp};l.trigger(i,"beforeTick",h),l.trigger(i,"tick",h);for(var d=a.now();s>0&&i.timeBuffer>=s*e._timeBufferMargin;){l.trigger(i,"beforeUpdate",h),r.update(u,s),l.trigger(i,"afterUpdate",h),i.timeBuffer-=s,n+=1;var m=a.now()-t,v=a.now()-d,S=m+e._elapsedNextEstimate*v/n;if(n>=T||S>i.maxFrameTime){i.lastUpdatesDeferred=Math.round(Math.max(0,i.timeBuffer/s-e._timeBufferMargin));break}}u.timing.lastUpdatesPerFrame=n,l.trigger(i,"afterTick",h),i.frameDeltaHistory.length>=100&&(i.lastUpdatesDeferred&&Math.round(i.frameDelta/s)>T?a.warnOnce("Matter.Runner: runner reached runner.maxUpdates, see docs."):i.lastUpdatesDeferred&&a.warnOnce("Matter.Runner: runner reached runner.maxFrameTime, see docs."),typeof i.isFixed<"u"&&a.warnOnce("Matter.Runner: runner.isFixed is now redundant, see docs."),(i.deltaMin||i.deltaMax)&&a.warnOnce("Matter.Runner: runner.deltaMin and runner.deltaMax were removed, see docs."),i.fps!==0&&a.warnOnce("Matter.Runner: runner.fps was replaced by runner.delta, see docs."))},e.stop=function(i){e._cancelNextFrame(i)},e._onNextFrame=function(i,u){if(typeof window<"u"&&window.requestAnimationFrame)i.frameRequestId=window.requestAnimationFrame(u);else throw new Error("Matter.Runner: missing required global window.requestAnimationFrame.");return i.frameRequestId},e._cancelNextFrame=function(i){if(typeof window<"u"&&window.cancelAnimationFrame)window.cancelAnimationFrame(i.frameRequestId);else throw new Error("Matter.Runner: missing required global window.cancelAnimationFrame.")};var g=function(i){for(var u=0,o=i.length,t=0;t<o;t+=1)u+=i[t];return u/o||0}})()}),(function(P,E,f){var e={};P.exports=e;var l=f(8),r=f(0),a=r.deprecated;(function(){e.collides=function(g,i){return l.collides(g,i)},a(e,"collides","SAT.collides âž¤ replaced by Collision.collides")})()}),(function(P,E,f){var e={};P.exports=e,f(1);var l=f(0);(function(){e.pathToVertices=function(r,a){typeof window<"u"&&!("SVGPathSeg"in window)&&l.warn("Svg.pathToVertices: SVGPathSeg not defined, a polyfill is required.");var g,i,u,o,t,s,n,c,p,y,w=[],T,h,d=0,m=0,v=0;a=a||15;var S=function(A,C,M){var B=M%2===1&&M>1;if(!p||A!=p.x||C!=p.y){p&&B?(T=p.x,h=p.y):(T=0,h=0);var L={x:T+A,y:h+C};(B||!p)&&(p=L),w.push(L),m=T+A,v=h+C}},x=function(A){var C=A.pathSegTypeAsLetter.toUpperCase();if(C!=="Z"){switch(C){case"M":case"L":case"T":case"C":case"S":case"Q":m=A.x,v=A.y;break;case"H":m=A.x;break;case"V":v=A.y;break}S(m,v,A.pathSegType)}};for(e._svgPathToAbsolute(r),u=r.getTotalLength(),s=[],g=0;g<r.pathSegList.numberOfItems;g+=1)s.push(r.pathSegList.getItem(g));for(n=s.concat();d<u;){if(y=r.getPathSegAtLength(d),t=s[y],t!=c){for(;n.length&&n[0]!=t;)x(n.shift());c=t}switch(t.pathSegTypeAsLetter.toUpperCase()){case"C":case"T":case"S":case"Q":case"A":o=r.getPointAtLength(d),S(o.x,o.y,0);break}d+=a}for(g=0,i=n.length;g<i;++g)x(n[g]);return w},e._svgPathToAbsolute=function(r){for(var a,g,i,u,o,t,s=r.pathSegList,n=0,c=0,p=s.numberOfItems,y=0;y<p;++y){var w=s.getItem(y),T=w.pathSegTypeAsLetter;if(/[MLHVCSQTA]/.test(T))"x"in w&&(n=w.x),"y"in w&&(c=w.y);else switch("x1"in w&&(i=n+w.x1),"x2"in w&&(o=n+w.x2),"y1"in w&&(u=c+w.y1),"y2"in w&&(t=c+w.y2),"x"in w&&(n+=w.x),"y"in w&&(c+=w.y),T){case"m":s.replaceItem(r.createSVGPathSegMovetoAbs(n,c),y);break;case"l":s.replaceItem(r.createSVGPathSegLinetoAbs(n,c),y);break;case"h":s.replaceItem(r.createSVGPathSegLinetoHorizontalAbs(n),y);break;case"v":s.replaceItem(r.createSVGPathSegLinetoVerticalAbs(c),y);break;case"c":s.replaceItem(r.createSVGPathSegCurvetoCubicAbs(n,c,i,u,o,t),y);break;case"s":s.replaceItem(r.createSVGPathSegCurvetoCubicSmoothAbs(n,c,o,t),y);break;case"q":s.replaceItem(r.createSVGPathSegCurvetoQuadraticAbs(n,c,i,u),y);break;case"t":s.replaceItem(r.createSVGPathSegCurvetoQuadraticSmoothAbs(n,c),y);break;case"a":s.replaceItem(r.createSVGPathSegArcAbs(n,c,w.r1,w.r2,w.angle,w.largeArcFlag,w.sweepFlag),y);break;case"z":case"Z":n=a,c=g;break}(T=="M"||T=="m")&&(a=n,g=c)}}})()}),(function(P,E,f){var e={};P.exports=e;var l=f(6);f(0),(function(){e.create=l.create,e.add=l.add,e.remove=l.remove,e.clear=l.clear,e.addComposite=l.addComposite,e.addBody=l.addBody,e.addConstraint=l.addConstraint})()})])})})(te)),te.exports}var Pe=Se();const H=xe(Pe),D={MAX_HEALTH:100,BODY_WIDTH:40,BODY_HEIGHT:60,HEAD_RADIUS:22,ARM_LENGTH:35,ARM_WIDTH:12,LEG_LENGTH:40,LEG_WIDTH:14,PROJECTILE_RADIUS:12,PROJECTILE_DENSITY:.004,MAX_PULL_DISTANCE:150,MAX_LAUNCH_SPEED:35,SLINGSHOT_STIFFNESS:.05,SLINGSHOT_DAMPING:.01,HEAD_DAMAGE_MULTIPLIER:2,BODY_DAMAGE_MULTIPLIER:1,ARM_DAMAGE_MULTIPLIER:.5,LEG_DAMAGE_MULTIPLIER:.6,BASE_DAMAGE:15,SPEED_DAMAGE_MULTIPLIER:1.2,GRAVITY:1.2,GROUND_FRICTION:.8,BODY_FRICTION:.4,RESTITUTION:.3,TURN_DELAY:1500,PROJECTILE_TIMEOUT:5e3,HIT_PARTICLE_COUNT:12,PARTICLE_LIFE:600,PLAYER1_COLOR:"#4facfe",PLAYER1_DARK:"#00b4d8",PLAYER2_COLOR:"#f5576c",PLAYER2_DARK:"#e63946",GROUND_COLOR:"#2d1b4e",SKY_GRADIENT_TOP:"#1a0a2e",SKY_GRADIENT_BOTTOM:"#2d1b4e",PROJECTILE_COLOR:"#ffcc00"};class we{engine;world;runner;canvas;ctx;width=0;height=0;isMobile;gameState="START";currentTurn=1;players=[null,null];ground=null;walls=[];projectile=null;projectileAnchor=null;elastic=null;projectileTimeout=null;isAiming=!1;aimStart=null;aimEnd=null;pullDistance=0;particles=[];screenShake={intensity:0,duration:0,time:0};audioContext=null;settings={music:!0,fx:!0,haptics:!0};startScreen;hud;turnIndicator;powerMeter;powerFill;aimInfo;gameOverScreen;settingsBtn;settingsPanel;settingsOverlay;constructor(){console.log("[BowmastersGame] Initializing game"),this.isMobile=window.matchMedia("(pointer: coarse)").matches,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),document.getElementById("game-container").appendChild(this.canvas),this.startScreen=document.getElementById("start-screen"),this.hud=document.getElementById("hud"),this.turnIndicator=document.getElementById("turn-indicator"),this.powerMeter=document.getElementById("power-meter"),this.powerFill=document.getElementById("power-fill"),this.aimInfo=document.getElementById("aim-info"),this.gameOverScreen=document.getElementById("game-over-screen"),this.settingsBtn=document.getElementById("settings-btn"),this.settingsPanel=document.getElementById("settings-panel"),this.settingsOverlay=document.getElementById("settings-overlay"),this.engine=H.Engine.create({gravity:{x:0,y:D.GRAVITY}}),this.world=this.engine.world,this.runner=H.Runner.create(),this.loadSettings(),this.setupCanvas(),this.setupEventListeners(),this.setupCollisionHandling(),this.render(),console.log("[BowmastersGame] Initialization complete")}setupCanvas(){console.log("[BowmastersGame] Setting up canvas"),this.resizeCanvas(),window.addEventListener("resize",()=>this.resizeCanvas())}resizeCanvas(){this.width=window.innerWidth,this.height=window.innerHeight,this.canvas.width=this.width,this.canvas.height=this.height,this.gameState!=="START"&&(this.createWorldBounds(),this.repositionPlayers())}setupEventListeners(){console.log("[BowmastersGame] Setting up event listeners"),document.getElementById("start-btn").addEventListener("click",()=>{this.triggerHaptic("light"),this.playSound("click"),this.startGame()}),document.getElementById("restart-btn").addEventListener("click",()=>{this.triggerHaptic("light"),this.playSound("click"),this.restartGame()}),this.settingsBtn.addEventListener("click",()=>{this.triggerHaptic("light"),this.openSettings()}),document.getElementById("close-settings").addEventListener("click",()=>{this.triggerHaptic("light"),this.closeSettings()}),this.settingsOverlay.addEventListener("click",()=>{this.closeSettings()}),document.getElementById("toggle-music").addEventListener("click",I=>{this.settings.music=!this.settings.music,I.target.classList.toggle("active",this.settings.music),this.saveSettings(),this.triggerHaptic("light")}),document.getElementById("toggle-fx").addEventListener("click",I=>{this.settings.fx=!this.settings.fx,I.target.classList.toggle("active",this.settings.fx),this.saveSettings(),this.triggerHaptic("light")}),document.getElementById("toggle-haptics").addEventListener("click",I=>{this.settings.haptics=!this.settings.haptics,I.target.classList.toggle("active",this.settings.haptics),this.saveSettings(),this.triggerHaptic("light")}),this.canvas.addEventListener("mousedown",I=>this.handleInputStart(I.clientX,I.clientY)),this.canvas.addEventListener("mousemove",I=>this.handleInputMove(I.clientX,I.clientY)),this.canvas.addEventListener("mouseup",()=>this.handleInputEnd()),this.canvas.addEventListener("mouseleave",()=>this.handleInputEnd()),this.canvas.addEventListener("touchstart",I=>{I.preventDefault();const P=I.touches[0];this.handleInputStart(P.clientX,P.clientY)}),this.canvas.addEventListener("touchmove",I=>{I.preventDefault();const P=I.touches[0];this.handleInputMove(P.clientX,P.clientY)}),this.canvas.addEventListener("touchend",I=>{I.preventDefault(),this.handleInputEnd()})}setupCollisionHandling(){H.Events.on(this.engine,"collisionStart",I=>{for(const P of I.pairs)this.handleCollision(P)})}handleCollision(I){const{bodyA:P,bodyB:E}=I;if(!this.projectile)return;const f=P===this.projectile,e=E===this.projectile;if(!f&&!e)return;const l=f?E:P,r=this.getPlayerFromBody(l);if(r&&r.id!==this.currentTurn){const a=H.Body.getSpeed(this.projectile),g=this.calculateDamage(l,a,r);this.applyDamage(r,g,this.projectile.position),this.createHitEffect(this.projectile.position.x,this.projectile.position.y,r.color);const i=H.Vector.mult(H.Vector.normalise(this.projectile.velocity),a*.3);H.Body.applyForce(l,l.position,i),this.triggerHaptic("heavy"),this.playSound("hit"),this.shakeScreen(8,200),this.endProjectileFlight()}else(l===this.ground||this.walls.includes(l))&&(this.playSound("thud"),this.triggerHaptic("medium"),setTimeout(()=>{this.gameState==="PROJECTILE_FLYING"&&this.endProjectileFlight()},500))}getPlayerFromBody(I){for(const P of this.players){if(!P)continue;const E=P.bodies;if(I===E.torso||I===E.head||I===E.leftArm||I===E.rightArm||I===E.leftLeg||I===E.rightLeg)return P}return null}calculateDamage(I,P,E){let f=D.BODY_DAMAGE_MULTIPLIER;I===E.bodies.head?f=D.HEAD_DAMAGE_MULTIPLIER:I===E.bodies.leftArm||I===E.bodies.rightArm?f=D.ARM_DAMAGE_MULTIPLIER:(I===E.bodies.leftLeg||I===E.bodies.rightLeg)&&(f=D.LEG_DAMAGE_MULTIPLIER);const e=Math.min(P*D.SPEED_DAMAGE_MULTIPLIER,20),l=Math.round((D.BASE_DAMAGE+e)*f);return console.log("[BowmastersGame] Damage calculated:",l,"multiplier:",f,"speed:",P),l}applyDamage(I,P,E){I.health=Math.max(0,I.health-P),console.log("[BowmastersGame] Player",I.id,"took",P,"damage. Health:",I.health),this.updateHealthBar(I),this.showDamagePopup(P,E.x,E.y),I.health<=0&&this.triggerGameOver(this.currentTurn)}updateHealthBar(I){const P=I.health/I.maxHealth*100,E=document.getElementById(`p${I.id}-health`),f=document.getElementById(`p${I.id}-health-text`);E.style.width=P+"%",f.textContent=I.health.toString()}showDamagePopup(I,P,E){const f=document.createElement("div");f.className="damage-popup",f.textContent="-"+I,f.style.left=P+"px",f.style.top=E+"px",document.getElementById("game-container").appendChild(f),setTimeout(()=>f.remove(),1e3)}startGame(){console.log("[BowmastersGame] Starting game"),this.startScreen.classList.add("hidden"),this.hud.style.display="flex",this.settingsBtn.style.display="flex",this.initAudio(),this.createWorldBounds(),this.createPlayers(),H.Runner.run(this.runner,this.engine),this.currentTurn=1,this.gameState="PLAYING",setTimeout(()=>this.startTurn(),500)}restartGame(){console.log("[BowmastersGame] Restarting game"),this.gameOverScreen.classList.remove("visible"),H.Composite.clear(this.world,!1),this.players=[null,null],this.projectile=null,this.elastic=null,this.particles=[],this.createWorldBounds(),this.createPlayers(),this.resetHealthBars(),this.currentTurn=1,this.gameState="PLAYING",setTimeout(()=>this.startTurn(),500)}resetHealthBars(){for(let I=1;I<=2;I++){const P=document.getElementById(`p${I}-health`),E=document.getElementById(`p${I}-health-text`);P.style.width="100%",E.textContent=D.MAX_HEALTH.toString()}}createWorldBounds(){console.log("[BowmastersGame] Creating world bounds"),this.ground&&H.Composite.remove(this.world,this.ground);for(const l of this.walls)H.Composite.remove(this.world,l);const I=60,P=50;this.ground=H.Bodies.rectangle(this.width/2,this.height-I/2,this.width+100,I,{isStatic:!0,friction:D.GROUND_FRICTION,label:"ground",render:{fillStyle:D.GROUND_COLOR}});const E=H.Bodies.rectangle(-P/2,this.height/2,P,this.height*2,{isStatic:!0,label:"wall"}),f=H.Bodies.rectangle(this.width+P/2,this.height/2,P,this.height*2,{isStatic:!0,label:"wall"}),e=H.Bodies.rectangle(this.width/2,-P/2,this.width+100,P,{isStatic:!0,label:"wall"});this.walls=[E,f,e],H.Composite.add(this.world,[this.ground,...this.walls])}createPlayers(){console.log("[BowmastersGame] Creating players");const P=this.height-60-80,E=this.width*.15;this.players[0]=this.createPlayer(1,E,P,!0);const f=this.width*.85;this.players[1]=this.createPlayer(2,f,P,!1)}createPlayer(I,P,E,f){const e=I===1?D.PLAYER1_COLOR:D.PLAYER2_COLOR,l=I===1?D.PLAYER1_DARK:D.PLAYER2_DARK,r={friction:D.BODY_FRICTION,restitution:D.RESTITUTION,collisionFilter:{category:I===1?2:4,mask:9}},a=H.Bodies.rectangle(P,E,D.BODY_WIDTH,D.BODY_HEIGHT,{...r,label:"torso",render:{fillStyle:e}}),g=H.Bodies.circle(P,E-D.BODY_HEIGHT/2-D.HEAD_RADIUS,D.HEAD_RADIUS,{...r,label:"head",render:{fillStyle:e}}),i=H.Bodies.rectangle(P-D.BODY_WIDTH/2-D.ARM_LENGTH/2,E-D.BODY_HEIGHT/4,D.ARM_LENGTH,D.ARM_WIDTH,{...r,label:"leftArm",render:{fillStyle:l}}),u=H.Bodies.rectangle(P+D.BODY_WIDTH/2+D.ARM_LENGTH/2,E-D.BODY_HEIGHT/4,D.ARM_LENGTH,D.ARM_WIDTH,{...r,label:"rightArm",render:{fillStyle:l}}),o=H.Bodies.rectangle(P-D.BODY_WIDTH/4,E+D.BODY_HEIGHT/2+D.LEG_LENGTH/2,D.LEG_WIDTH,D.LEG_LENGTH,{...r,label:"leftLeg",render:{fillStyle:l}}),t=H.Bodies.rectangle(P+D.BODY_WIDTH/4,E+D.BODY_HEIGHT/2+D.LEG_LENGTH/2,D.LEG_WIDTH,D.LEG_LENGTH,{...r,label:"rightLeg",render:{fillStyle:l}}),s=[H.Constraint.create({bodyA:a,bodyB:g,pointA:{x:0,y:-60/2},pointB:{x:0,y:D.HEAD_RADIUS},stiffness:.9,length:0}),H.Constraint.create({bodyA:a,bodyB:i,pointA:{x:-40/2,y:-60/4},pointB:{x:D.ARM_LENGTH/2,y:0},stiffness:.8,length:0}),H.Constraint.create({bodyA:a,bodyB:u,pointA:{x:D.BODY_WIDTH/2,y:-60/4},pointB:{x:-35/2,y:0},stiffness:.8,length:0}),H.Constraint.create({bodyA:a,bodyB:o,pointA:{x:-40/4,y:D.BODY_HEIGHT/2},pointB:{x:0,y:-40/2},stiffness:.8,length:0}),H.Constraint.create({bodyA:a,bodyB:t,pointA:{x:D.BODY_WIDTH/4,y:D.BODY_HEIGHT/2},pointB:{x:0,y:-40/2},stiffness:.8,length:0})];H.Body.setStatic(a,!0),H.Body.setStatic(g,!0),H.Body.setStatic(i,!0),H.Body.setStatic(u,!0),H.Body.setStatic(o,!0),H.Body.setStatic(t,!0);const n=H.Composite.create();return H.Composite.add(n,[a,g,i,u,o,t,...s]),H.Composite.add(this.world,n),{id:I,x:P,y:E,health:D.MAX_HEALTH,maxHealth:D.MAX_HEALTH,facingRight:f,bodies:{torso:a,head:g,leftArm:i,rightArm:u,leftLeg:o,rightLeg:t},composite:n,color:e,darkColor:l}}repositionPlayers(){if(!this.players[0]||!this.players[1])return;const P=this.height-60-80;this.players[0].x=this.width*.15,this.players[0].y=P,this.players[1].x=this.width*.85,this.players[1].y=P}startTurn(){console.log("[BowmastersGame] Starting turn for player",this.currentTurn),this.gameState="AIMING",this.showTurnIndicator(),this.createProjectile()}showTurnIndicator(){const I=this.turnIndicator;I.textContent="PLAYER "+this.currentTurn+"'S TURN",I.classList.add("visible"),setTimeout(()=>{I.classList.remove("visible")},1500)}createProjectile(){const I=this.players[this.currentTurn-1],P=I.facingRight?50:-50,E=I.x+P,f=I.y-20;this.projectile=H.Bodies.circle(E,f,D.PROJECTILE_RADIUS,{density:D.PROJECTILE_DENSITY,friction:.3,restitution:.6,label:"projectile",collisionFilter:{category:8,mask:7},render:{fillStyle:D.PROJECTILE_COLOR}}),this.projectileAnchor={x:E,y:f},this.elastic=H.Constraint.create({pointA:this.projectileAnchor,bodyB:this.projectile,stiffness:D.SLINGSHOT_STIFFNESS,damping:D.SLINGSHOT_DAMPING,length:.01}),H.Composite.add(this.world,[this.projectile,this.elastic]),this.aimInfo.textContent=this.isMobile?"Drag back to aim, release to fire!":"Click and drag to aim, release to fire!"}handleInputStart(I,P){if(this.gameState!=="AIMING"||!this.projectile)return;Math.hypot(I-this.projectile.position.x,P-this.projectile.position.y)<80&&(this.isAiming=!0,this.aimStart={x:I,y:P},this.aimEnd={x:I,y:P},this.powerMeter.classList.add("visible"),this.triggerHaptic("light"))}handleInputMove(I,P){if(!this.isAiming||!this.projectile||!this.projectileAnchor)return;this.aimEnd={x:I,y:P};const E=this.projectileAnchor.x-I,f=this.projectileAnchor.y-P;this.pullDistance=Math.min(Math.hypot(E,f),D.MAX_PULL_DISTANCE);const e=Math.atan2(f,E),l=this.projectileAnchor.x-Math.cos(e)*this.pullDistance,r=this.projectileAnchor.y-Math.sin(e)*this.pullDistance;H.Body.setPosition(this.projectile,{x:l,y:r});const a=this.pullDistance/D.MAX_PULL_DISTANCE*100;this.powerFill.style.height=a+"%",this.pullDistance/D.MAX_PULL_DISTANCE*D.MAX_LAUNCH_SPEED,this.aimInfo.textContent="Power: "+Math.round(a)+"%"}handleInputEnd(){!this.isAiming||!this.projectile||!this.projectileAnchor||(this.isAiming=!1,this.powerMeter.classList.remove("visible"),this.pullDistance>20?this.launchProjectile():H.Body.setPosition(this.projectile,this.projectileAnchor),this.pullDistance=0,this.aimInfo.textContent="")}launchProjectile(){if(!this.projectile||!this.projectileAnchor||!this.elastic)return;console.log("[BowmastersGame] Launching projectile"),this.gameState="PROJECTILE_FLYING",H.Composite.remove(this.world,this.elastic),this.elastic=null,H.Body.getSpeed(this.projectile)>D.MAX_LAUNCH_SPEED&&H.Body.setSpeed(this.projectile,D.MAX_LAUNCH_SPEED),this.playSound("launch"),this.triggerHaptic("medium"),this.projectileTimeout=window.setTimeout(()=>{this.gameState==="PROJECTILE_FLYING"&&this.endProjectileFlight()},D.PROJECTILE_TIMEOUT)}endProjectileFlight(){console.log("[BowmastersGame] Ending projectile flight"),this.projectileTimeout&&(clearTimeout(this.projectileTimeout),this.projectileTimeout=null),this.projectile&&(H.Composite.remove(this.world,this.projectile),this.projectile=null),this.elastic&&(H.Composite.remove(this.world,this.elastic),this.elastic=null),this.gameState!=="GAME_OVER"&&(this.currentTurn=this.currentTurn===1?2:1,setTimeout(()=>{this.gameState!=="GAME_OVER"&&this.startTurn()},D.TURN_DELAY))}triggerGameOver(I){console.log("[BowmastersGame] Game over! Winner: Player",I),this.gameState="GAME_OVER";const E=this.players[I-1].health*10;this.submitScore(E),setTimeout(()=>{const f=document.getElementById("winner-text");f.textContent="PLAYER "+I,f.style.color=I===1?D.PLAYER1_COLOR:D.PLAYER2_COLOR,this.gameOverScreen.classList.add("visible"),this.triggerHaptic("success")},1e3)}createHitEffect(I,P,E){for(let f=0;f<D.HIT_PARTICLE_COUNT;f++){const e=Math.PI*2*f/D.HIT_PARTICLE_COUNT+Math.random()*.5,l=3+Math.random()*5;this.particles.push({x:I,y:P,vx:Math.cos(e)*l,vy:Math.sin(e)*l-2,life:D.PARTICLE_LIFE,maxLife:D.PARTICLE_LIFE,size:4+Math.random()*6,color:E})}}updateParticles(I){for(let P=this.particles.length-1;P>=0;P--){const E=this.particles[P];E.x+=E.vx,E.y+=E.vy,E.vy+=.3,E.life-=I,E.life<=0&&this.particles.splice(P,1)}}shakeScreen(I,P){this.screenShake={intensity:I,duration:P,time:0}}updateScreenShake(I){this.screenShake.duration>0&&(this.screenShake.time+=I,this.screenShake.time>=this.screenShake.duration&&(this.screenShake={intensity:0,duration:0,time:0}))}getScreenShakeOffset(){if(this.screenShake.duration<=0)return{x:0,y:0};const I=this.screenShake.time/this.screenShake.duration,P=this.screenShake.intensity*(1-I);return{x:(Math.random()-.5)*P*2,y:(Math.random()-.5)*P*2}}lastTime=0;render=(I=0)=>{const P=Math.min(I-this.lastTime,32);this.lastTime=I,this.updateParticles(P),this.updateScreenShake(P),this.ctx.save();const E=this.getScreenShakeOffset();this.ctx.translate(E.x,E.y);const f=this.ctx.createLinearGradient(0,0,0,this.height);f.addColorStop(0,D.SKY_GRADIENT_TOP),f.addColorStop(1,D.SKY_GRADIENT_BOTTOM),this.ctx.fillStyle=f,this.ctx.fillRect(-10,-10,this.width+20,this.height+20),this.drawBackground(),this.drawGround(),this.drawPlayers(),this.drawProjectile(),this.isAiming&&this.projectile&&this.drawTrajectoryPreview(),this.drawParticles(),this.ctx.restore(),requestAnimationFrame(this.render)};drawBackground(){this.ctx.fillStyle="rgba(168, 139, 235, 0.1)";for(let I=0;I<5;I++){const P=this.width*(I+1)/6,E=this.height*.2+Math.sin(I*1.5)*50,f=20+I*10;this.ctx.beginPath(),this.ctx.arc(P,E,f,0,Math.PI*2),this.ctx.fill()}}drawGround(){const I=this.height-60;this.ctx.fillStyle=D.GROUND_COLOR,this.ctx.fillRect(0,I,this.width,60),this.ctx.strokeStyle="#a88beb",this.ctx.lineWidth=3,this.ctx.beginPath(),this.ctx.moveTo(0,I),this.ctx.lineTo(this.width,I),this.ctx.stroke(),this.ctx.strokeStyle="rgba(168, 139, 235, 0.3)",this.ctx.lineWidth=1;for(let P=0;P<this.width;P+=30)this.ctx.beginPath(),this.ctx.moveTo(P,I+10),this.ctx.lineTo(P+15,I+50),this.ctx.stroke()}drawPlayers(){for(const I of this.players)I&&this.drawPlayer(I)}drawPlayer(I){const P=this.ctx,E=I.bodies;this.drawBodyPart(E.leftLeg,I.darkColor),this.drawBodyPart(E.rightLeg,I.darkColor),this.drawBodyPart(E.leftArm,I.darkColor),this.drawBodyPart(E.rightArm,I.darkColor),this.drawBodyPart(E.torso,I.color),P.save(),P.translate(E.head.position.x,E.head.position.y),P.rotate(E.head.angle),P.fillStyle=I.color,P.beginPath(),P.arc(0,0,D.HEAD_RADIUS,0,Math.PI*2),P.fill(),P.strokeStyle=I.darkColor,P.lineWidth=3,P.stroke(),P.fillStyle="#fff";const f=I.facingRight?5:-5;P.beginPath(),P.arc(f-6,-3,4,0,Math.PI*2),P.arc(f+6,-3,4,0,Math.PI*2),P.fill(),P.fillStyle="#1a0a2e",P.beginPath(),P.arc(f-5,-2,2,0,Math.PI*2),P.arc(f+7,-2,2,0,Math.PI*2),P.fill(),P.restore()}drawBodyPart(I,P){const E=this.ctx,f=I.vertices;E.save(),E.fillStyle=P,E.strokeStyle=P===D.PLAYER1_COLOR||P===D.PLAYER2_COLOR?D.PLAYER1_DARK:"#1a0a2e",E.lineWidth=2,E.beginPath(),E.moveTo(f[0].x,f[0].y);for(let e=1;e<f.length;e++)E.lineTo(f[e].x,f[e].y);E.closePath(),E.fill(),E.stroke(),E.restore()}drawProjectile(){if(!this.projectile)return;const I=this.ctx,P=this.projectile.position;this.isAiming&&this.projectileAnchor&&(I.strokeStyle="#8B4513",I.lineWidth=4,I.beginPath(),I.moveTo(this.projectileAnchor.x-10,this.projectileAnchor.y),I.lineTo(P.x,P.y),I.moveTo(this.projectileAnchor.x+10,this.projectileAnchor.y),I.lineTo(P.x,P.y),I.stroke()),I.save(),I.translate(P.x,P.y),I.rotate(this.projectile.angle);const E=I.createRadialGradient(0,0,0,0,0,D.PROJECTILE_RADIUS*2);E.addColorStop(0,"rgba(255, 204, 0, 0.4)"),E.addColorStop(1,"rgba(255, 204, 0, 0)"),I.fillStyle=E,I.beginPath(),I.arc(0,0,D.PROJECTILE_RADIUS*2,0,Math.PI*2),I.fill(),I.fillStyle=D.PROJECTILE_COLOR,I.beginPath(),I.arc(0,0,D.PROJECTILE_RADIUS,0,Math.PI*2),I.fill(),I.fillStyle="rgba(255, 255, 255, 0.5)",I.beginPath(),I.arc(-3,-3,D.PROJECTILE_RADIUS*.4,0,Math.PI*2),I.fill(),I.restore()}drawTrajectoryPreview(){if(!this.projectile||!this.projectileAnchor)return;const I=this.ctx,P=this.projectile.position,E=this.projectileAnchor.x-P.x,f=this.projectileAnchor.y-P.y,l=Math.hypot(E,f)/D.MAX_PULL_DISTANCE*D.MAX_LAUNCH_SPEED,r=Math.atan2(f,E),a=Math.cos(r)*l,g=Math.sin(r)*l;I.fillStyle="rgba(255, 255, 255, 0.3)";let i=P.x,u=P.y,o=a*2,t=g*2;for(let s=0;s<20;s++){i+=o,u+=t,t+=D.GRAVITY*1.5;const n=1-s/20;if(I.globalAlpha=n*.5,I.beginPath(),I.arc(i,u,3,0,Math.PI*2),I.fill(),u>this.height-60)break}I.globalAlpha=1}drawParticles(){for(const I of this.particles){const P=I.life/I.maxLife;this.ctx.globalAlpha=P,this.ctx.fillStyle=I.color,this.ctx.beginPath(),this.ctx.arc(I.x,I.y,I.size*P,0,Math.PI*2),this.ctx.fill()}this.ctx.globalAlpha=1}initAudio(){if(!this.audioContext)try{this.audioContext=new(window.AudioContext||window.webkitAudioContext),console.log("[BowmastersGame] Audio context initialized")}catch{console.log("[BowmastersGame] Audio context failed to initialize")}}playSound(I){if(!this.settings.fx||!this.audioContext)return;const P=this.audioContext,E=P.currentTime,f=P.createOscillator(),e=P.createGain();switch(f.connect(e),e.connect(P.destination),I){case"click":f.frequency.value=800,f.type="sine",e.gain.setValueAtTime(.1,E),e.gain.exponentialDecayTo?.(.01,E+.05)||e.gain.exponentialRampToValueAtTime(.01,E+.05),f.start(E),f.stop(E+.05);break;case"launch":f.frequency.setValueAtTime(200,E),f.frequency.exponentialRampToValueAtTime(600,E+.15),f.type="sawtooth",e.gain.setValueAtTime(.15,E),e.gain.exponentialRampToValueAtTime(.01,E+.2),f.start(E),f.stop(E+.2);break;case"hit":f.frequency.value=150,f.type="square",e.gain.setValueAtTime(.3,E),e.gain.exponentialRampToValueAtTime(.01,E+.15),f.start(E),f.stop(E+.15);const l=P.createOscillator(),r=P.createGain();l.connect(r),r.connect(P.destination),l.frequency.value=100,l.type="sawtooth",r.gain.setValueAtTime(.2,E),r.gain.exponentialRampToValueAtTime(.01,E+.1),l.start(E),l.stop(E+.1);break;case"thud":f.frequency.value=80,f.type="sine",e.gain.setValueAtTime(.2,E),e.gain.exponentialRampToValueAtTime(.01,E+.2),f.start(E),f.stop(E+.2);break}}triggerHaptic(I){this.settings.haptics&&typeof window.triggerHaptic=="function"&&window.triggerHaptic(I)}submitScore(I){console.log("[BowmastersGame] Submitting score:",I),typeof window.submitScore=="function"&&window.submitScore(I)}loadSettings(){try{const I=localStorage.getItem("bowmasters-settings");I&&(this.settings={...this.settings,...JSON.parse(I)})}catch{console.log("[BowmastersGame] Failed to load settings")}document.getElementById("toggle-music").classList.toggle("active",this.settings.music),document.getElementById("toggle-fx").classList.toggle("active",this.settings.fx),document.getElementById("toggle-haptics").classList.toggle("active",this.settings.haptics)}saveSettings(){try{localStorage.setItem("bowmasters-settings",JSON.stringify(this.settings))}catch{console.log("[BowmastersGame] Failed to save settings")}}openSettings(){this.settingsPanel.classList.add("visible"),this.settingsOverlay.classList.add("visible")}closeSettings(){this.settingsPanel.classList.remove("visible"),this.settingsOverlay.classList.remove("visible")}}document.addEventListener("DOMContentLoaded",()=>{new we});</script>
</head>
<body>
  <div id="game-container">
    <!-- Start Screen -->
    <div id="start-screen">
      <div class="title-container">
        <h1 class="game-title">BOWMASTERS</h1>
        <p class="subtitle">PHYSICS DUEL ARENA</p>
      </div>
      <div class="characters-preview">
        <div class="preview-character player1"></div>
        <span class="vs-text">VS</span>
        <div class="preview-character player2"></div>
      </div>
      <button class="start-btn" id="start-btn">BATTLE!</button>
    </div>
    
    <!-- HUD -->
    <div id="hud" style="display: none;">
      <div class="player-hud left">
        <span class="player-name" id="p1-name">PLAYER 1</span>
        <div class="health-bar-container">
          <div class="health-bar player1" id="p1-health" style="width: 100%;"></div>
          <span class="health-text" id="p1-health-text">100</span>
        </div>
      </div>
      <div class="player-hud right">
        <span class="player-name" id="p2-name">PLAYER 2</span>
        <div class="health-bar-container">
          <div class="health-bar player2" id="p2-health" style="width: 100%;"></div>
          <span class="health-text" id="p2-health-text">100</span>
        </div>
      </div>
    </div>
    
    <!-- Turn Indicator -->
    <div id="turn-indicator"></div>
    
    <!-- Power Meter -->
    <div id="power-meter">
      <div class="power-fill" id="power-fill"></div>
    </div>
    
    <!-- Aim Info -->
    <div id="aim-info"></div>
    
    <!-- Settings Button -->
    <button id="settings-btn" style="display: none;">
      <svg viewBox="0 0 24 24"><path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/></svg>
    </button>
    
    <!-- Settings Overlay -->
    <div id="settings-overlay"></div>
    
    <!-- Settings Panel -->
    <div id="settings-panel">
      <h2 class="settings-title">SETTINGS</h2>
      <div class="setting-row">
        <span class="setting-label">Music</span>
        <button class="toggle-btn active" id="toggle-music"></button>
      </div>
      <div class="setting-row">
        <span class="setting-label">Sound FX</span>
        <button class="toggle-btn active" id="toggle-fx"></button>
      </div>
      <div class="setting-row">
        <span class="setting-label">Haptics</span>
        <button class="toggle-btn active" id="toggle-haptics"></button>
      </div>
      <button class="close-settings-btn" id="close-settings">DONE</button>
    </div>
    
    <!-- Game Over Screen -->
    <div id="game-over-screen">
      <div class="winner-text" id="winner-text">PLAYER 1</div>
      <div class="winner-label">WINS!</div>
      <button class="restart-btn" id="restart-btn">PLAY AGAIN</button>
    </div>
  </div>
  
</body>
</html>
