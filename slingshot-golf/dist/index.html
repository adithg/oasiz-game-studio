<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="mobile-web-app-capable" content="yes">
  <title>Slingshot Golf</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Lilita+One&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden;
      touch-action: none;
      background: #87CEEB;
      font-family: 'Fredoka', sans-serif;
    }
    
    #game-container {
      position: relative;
      width: 100%;
      height: 100%;
      overflow: hidden;
      background: #87CEEB;
    }

    /* Constrain game viewport on desktop */
    @media (pointer: fine) {
      body {
        display: flex;
        align-items: center;
        justify-content: center;
        background: #5bb7e6;
      }

      #game-container {
        width: min(1100px, 95vw);
        height: min(680px, 92vh);
        border-radius: 22px;
        box-shadow: 0 18px 50px rgba(0, 0, 0, 0.25);
      }
    }
    
    canvas {
      display: block;
      position: absolute;
      top: 0;
      left: 0;
    }
    
    /* Start Screen */
    #start-screen {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: linear-gradient(180deg, #87CEEB 0%, #98D8C8 50%, #7CB342 100%);
      z-index: 100;
      pointer-events: auto;
    }
    
    #start-screen.hidden {
      display: none;
    }
    
    .title-container {
      position: relative;
      margin-bottom: 40px;
      text-align: center;
    }
    
    .game-title {
      font-family: 'Lilita One', cursive;
      font-size: clamp(42px, 10vw, 80px);
      color: #fff;
      text-shadow: 
        4px 4px 0 #2E7D32,
        6px 6px 0 rgba(0,0,0,0.2);
      letter-spacing: 2px;
      animation: titleBounce 2s ease-in-out infinite;
    }
    
    @keyframes titleBounce {
      0%, 100% { transform: translateY(0) rotate(-1deg); }
      50% { transform: translateY(-8px) rotate(1deg); }
    }
    
    .subtitle {
      font-family: 'Fredoka', sans-serif;
      font-size: clamp(14px, 3vw, 20px);
      color: #2E7D32;
      text-align: center;
      margin-top: 8px;
      font-weight: 600;
    }
    
    .golf-preview {
      display: flex;
      gap: 20px;
      margin-bottom: 40px;
      align-items: center;
    }
    
    .preview-ball {
      width: 50px;
      height: 50px;
      background: radial-gradient(circle at 30% 30%, #fff 0%, #f0f0f0 100%);
      border-radius: 50%;
      box-shadow: 
        inset -8px -8px 15px rgba(0,0,0,0.1),
        4px 4px 10px rgba(0,0,0,0.2);
      animation: ballBounce 1s ease-in-out infinite;
    }
    
    @keyframes ballBounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-20px); }
    }
    
    .preview-flag {
      width: 60px;
      height: 80px;
      position: relative;
    }
    
    .flag-pole {
      position: absolute;
      left: 50%;
      bottom: 0;
      width: 4px;
      height: 70px;
      background: linear-gradient(180deg, #8B4513 0%, #654321 100%);
      transform: translateX(-50%);
    }
    
    .flag-cloth {
      position: absolute;
      left: 50%;
      top: 0;
      width: 35px;
      height: 25px;
      background: linear-gradient(135deg, #FF5722 0%, #E64A19 100%);
      clip-path: polygon(0 0, 100% 50%, 0 100%);
      animation: flagWave 1.5s ease-in-out infinite;
      transform-origin: left center;
    }
    
    @keyframes flagWave {
      0%, 100% { transform: scaleX(1); }
      50% { transform: scaleX(0.9); }
    }
    
    .start-btn {
      padding: 18px 50px;
      font-family: 'Lilita One', cursive;
      font-size: clamp(22px, 5vw, 30px);
      color: #fff;
      background: linear-gradient(180deg, #4CAF50 0%, #388E3C 100%);
      border: none;
      border-radius: 50px;
      cursor: pointer;
      box-shadow: 
        0 6px 0 #1B5E20,
        0 10px 20px rgba(0,0,0,0.3);
      transition: all 0.15s ease;
      letter-spacing: 1px;
    }
    
    .start-btn:hover {
      transform: translateY(-2px);
      box-shadow: 
        0 8px 0 #1B5E20,
        0 14px 25px rgba(0,0,0,0.35);
    }
    
    .start-btn:active {
      transform: translateY(4px);
      box-shadow: 
        0 2px 0 #1B5E20,
        0 4px 10px rgba(0,0,0,0.2);
    }
    
    /* Level Select */
    .level-select {
      margin-top: 30px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      max-width: 320px;
    }
    
    .level-btn {
      width: 50px;
      height: 50px;
      font-family: 'Fredoka', sans-serif;
      font-size: 20px;
      font-weight: 700;
      color: #fff;
      background: linear-gradient(180deg, #42A5F5 0%, #1976D2 100%);
      border: none;
      border-radius: 12px;
      cursor: pointer;
      box-shadow: 0 4px 0 #0D47A1;
      transition: all 0.1s ease;
    }
    
    .level-btn:hover {
      transform: translateY(-2px);
    }
    
    .level-btn:active {
      transform: translateY(2px);
      box-shadow: 0 2px 0 #0D47A1;
    }
    
    .level-btn.locked {
      background: linear-gradient(180deg, #9E9E9E 0%, #757575 100%);
      box-shadow: 0 4px 0 #424242;
      cursor: not-allowed;
      opacity: 0.7;
    }
    
    .level-btn.completed {
      background: linear-gradient(180deg, #66BB6A 0%, #43A047 100%);
      box-shadow: 0 4px 0 #2E7D32;
    }
    
    /* HUD */
    #hud {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      padding: 45px 20px 10px 20px;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      pointer-events: none;
      z-index: 10;
    }
    
    @media (pointer: coarse) {
      #hud {
        padding-top: 120px;
      }
    }
    
    .hud-left, .hud-right {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    
    .hud-center {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
    }
    
    .hud-label {
      font-size: 12px;
      color: rgba(255,255,255,0.8);
      text-transform: uppercase;
      font-weight: 600;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
    }
    
    .hud-value {
      font-family: 'Lilita One', cursive;
      font-size: clamp(20px, 5vw, 28px);
      color: #fff;
      text-shadow: 2px 2px 0 rgba(0,0,0,0.3);
    }
    
    .stroke-display {
      display: flex;
      align-items: baseline;
      gap: 4px;
    }
    
    .stroke-current {
      font-family: 'Lilita One', cursive;
      font-size: clamp(28px, 7vw, 40px);
      color: #fff;
      text-shadow: 2px 2px 0 rgba(0,0,0,0.3);
    }
    
    .stroke-par {
      font-size: clamp(14px, 3vw, 18px);
      color: rgba(255,255,255,0.7);
      font-weight: 600;
    }
    
    /* Ball Counter */
    .ball-counter {
      display: flex;
      gap: 6px;
    }
    
    .ball-pip {
      width: 16px;
      height: 16px;
      background: radial-gradient(circle at 30% 30%, #fff 0%, #e0e0e0 100%);
      border-radius: 50%;
      box-shadow: 1px 1px 3px rgba(0,0,0,0.2);
      transition: opacity 0.3s ease;
    }
    
    .ball-pip.used {
      opacity: 0.3;
    }
    
    /* Power Meter */
    #power-meter {
      position: absolute;
      left: 20px;
      top: 50%;
      transform: translateY(-50%);
      width: 24px;
      height: 160px;
      background: rgba(0,0,0,0.3);
      border: 3px solid rgba(255,255,255,0.5);
      border-radius: 12px;
      overflow: hidden;
      pointer-events: none;
      z-index: 10;
      opacity: 0;
      transition: opacity 0.2s ease;
    }
    
    #power-meter.visible {
      opacity: 1;
    }
    
    .power-fill {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      background: linear-gradient(0deg, #4CAF50 0%, #FFEB3B 50%, #FF5722 100%);
      transition: height 0.05s ease;
      border-radius: 9px;
    }
    
    /* Aim Info */
    #aim-info {
      position: absolute;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      font-family: 'Fredoka', sans-serif;
      font-size: clamp(14px, 3vw, 18px);
      color: rgba(255,255,255,0.9);
      text-align: center;
      pointer-events: none;
      z-index: 10;
      background: rgba(0,0,0,0.3);
      padding: 8px 16px;
      border-radius: 20px;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
    }
    
    /* Level Complete Screen */
    #level-complete-screen {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: rgba(0, 100, 0, 0.9);
      z-index: 100;
      pointer-events: auto;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.4s ease, visibility 0.4s ease;
    }
    
    #level-complete-screen.visible {
      opacity: 1;
      visibility: visible;
    }
    
    .complete-title {
      font-family: 'Lilita One', cursive;
      font-size: clamp(36px, 10vw, 64px);
      color: #FFEB3B;
      text-shadow: 4px 4px 0 #1B5E20;
      margin-bottom: 20px;
      animation: celebrateBounce 0.5s ease-out;
    }
    
    @keyframes celebrateBounce {
      0% { transform: scale(0.5); opacity: 0; }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); opacity: 1; }
    }
    
    .score-summary {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
      margin-bottom: 30px;
    }
    
    .score-row {
      display: flex;
      gap: 20px;
      align-items: center;
    }
    
    .score-item {
      text-align: center;
    }
    
    .score-label {
      font-size: 14px;
      color: rgba(255,255,255,0.7);
      text-transform: uppercase;
      font-weight: 600;
    }
    
    .score-value {
      font-family: 'Lilita One', cursive;
      font-size: 36px;
      color: #fff;
    }
    
    .score-result {
      font-family: 'Lilita One', cursive;
      font-size: clamp(20px, 5vw, 28px);
      padding: 8px 20px;
      border-radius: 20px;
      margin-top: 10px;
    }
    
    .score-result.under {
      background: #4CAF50;
      color: #fff;
    }
    
    .score-result.even {
      background: #2196F3;
      color: #fff;
    }
    
    .score-result.over {
      background: #FF9800;
      color: #fff;
    }
    
    .next-btn, .retry-btn, .menu-btn {
      padding: 14px 40px;
      font-family: 'Lilita One', cursive;
      font-size: clamp(18px, 4vw, 24px);
      color: #fff;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      transition: all 0.15s ease;
      letter-spacing: 1px;
      margin: 8px;
    }
    
    .next-btn {
      background: linear-gradient(180deg, #4CAF50 0%, #388E3C 100%);
      box-shadow: 0 5px 0 #1B5E20;
    }
    
    .retry-btn {
      background: linear-gradient(180deg, #FF9800 0%, #F57C00 100%);
      box-shadow: 0 5px 0 #E65100;
    }
    
    .menu-btn {
      background: linear-gradient(180deg, #9E9E9E 0%, #757575 100%);
      box-shadow: 0 5px 0 #424242;
    }
    
    .next-btn:active, .retry-btn:active, .menu-btn:active {
      transform: translateY(3px);
    }
    
    /* Game Over Screen */
    #game-over-screen {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: rgba(139, 69, 19, 0.95);
      z-index: 100;
      pointer-events: auto;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.4s ease, visibility 0.4s ease;
    }
    
    #game-over-screen.visible {
      opacity: 1;
      visibility: visible;
    }
    
    .game-over-title {
      font-family: 'Lilita One', cursive;
      font-size: clamp(32px, 8vw, 56px);
      color: #FFEB3B;
      text-shadow: 4px 4px 0 #5D4037;
      margin-bottom: 20px;
    }
    
    .total-score {
      font-family: 'Lilita One', cursive;
      font-size: clamp(48px, 12vw, 72px);
      color: #fff;
      margin-bottom: 10px;
    }
    
    .total-label {
      font-size: 18px;
      color: rgba(255,255,255,0.7);
      margin-bottom: 40px;
    }
    
    /* Settings Button */
    #settings-btn {
      position: absolute;
      top: 45px;
      right: 20px;
      width: 44px;
      height: 44px;
      background: rgba(255,255,255,0.2);
      border: 2px solid rgba(255,255,255,0.4);
      border-radius: 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 50;
      transition: background 0.2s ease;
    }
    
    @media (pointer: coarse) {
      #settings-btn {
        top: 120px;
      }
    }
    
    #settings-btn:hover {
      background: rgba(255,255,255,0.3);
    }
    
    #settings-btn svg {
      width: 24px;
      height: 24px;
      fill: #fff;
    }
    
    .hidden {
      display: none !important;
    }
    
    /* Settings Panel */
    #settings-panel {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.9);
      background: linear-gradient(180deg, #4CAF50 0%, #388E3C 100%);
      border: 4px solid #1B5E20;
      border-radius: 24px;
      padding: 30px;
      z-index: 200;
      opacity: 0;
      visibility: hidden;
      transition: all 0.2s ease;
      min-width: 280px;
    }
    
    #settings-panel.visible {
      opacity: 1;
      visibility: visible;
      transform: translate(-50%, -50%) scale(1);
    }
    
    .settings-title {
      font-family: 'Lilita One', cursive;
      font-size: 28px;
      color: #fff;
      text-align: center;
      margin-bottom: 25px;
      text-shadow: 2px 2px 0 rgba(0,0,0,0.2);
    }
    
    .setting-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 18px;
    }
    
    .setting-label {
      font-size: 16px;
      color: #fff;
      font-weight: 600;
    }
    
    .toggle-btn {
      width: 56px;
      height: 30px;
      background: rgba(0,0,0,0.3);
      border: none;
      border-radius: 15px;
      cursor: pointer;
      position: relative;
      transition: background 0.2s ease;
    }
    
    .toggle-btn.active {
      background: #FFEB3B;
    }
    
    .toggle-btn::after {
      content: '';
      position: absolute;
      top: 3px;
      left: 3px;
      width: 24px;
      height: 24px;
      background: #fff;
      border-radius: 50%;
      transition: transform 0.2s ease;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    
    .toggle-btn.active::after {
      transform: translateX(26px);
    }
    
    .close-settings-btn {
      margin-top: 20px;
      width: 100%;
      padding: 12px;
      font-family: 'Lilita One', cursive;
      font-size: 20px;
      color: #388E3C;
      background: #fff;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      box-shadow: 0 4px 0 rgba(0,0,0,0.2);
      transition: transform 0.1s ease;
    }
    
    .close-settings-btn:active {
      transform: translateY(2px);
      box-shadow: 0 2px 0 rgba(0,0,0,0.2);
    }
    
    /* Settings Overlay */
    #settings-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 150;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.2s ease, visibility 0.2s ease;
    }
    
    #settings-overlay.visible {
      opacity: 1;
      visibility: visible;
    }
    
    /* Wind Indicator */
    #wind-indicator {
      position: absolute;
      top: 45px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      align-items: center;
      gap: 8px;
      background: rgba(0,0,0,0.3);
      padding: 6px 14px;
      border-radius: 20px;
      pointer-events: none;
      z-index: 10;
    }
    
    @media (pointer: coarse) {
      #wind-indicator {
        top: 120px;
      }
    }
    
    .wind-label {
      font-size: 12px;
      color: rgba(255,255,255,0.7);
      text-transform: uppercase;
      font-weight: 600;
    }
    
    .wind-arrow {
      font-size: 18px;
      color: #fff;
      transition: transform 0.3s ease;
    }
    
    .wind-value {
      font-weight: 700;
      color: #fff;
      font-size: 14px;
    }
    
    /* Skip/Ball Buttons */
    .action-buttons {
      position: absolute;
      bottom: 30px;
      right: 20px;
      display: flex;
      gap: 10px;
      pointer-events: auto;
      z-index: 20;
    }
    
    @media (pointer: coarse) {
      .action-buttons {
        bottom: 120px;
      }
    }
    
    .action-btn {
      padding: 10px 20px;
      font-family: 'Fredoka', sans-serif;
      font-size: 14px;
      font-weight: 700;
      color: #fff;
      background: rgba(0,0,0,0.4);
      border: 2px solid rgba(255,255,255,0.4);
      border-radius: 25px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: all 0.15s ease;
    }
    
    .action-btn:hover {
      background: rgba(0,0,0,0.6);
    }
    
    .action-btn svg {
      width: 16px;
      height: 16px;
      fill: currentColor;
    }
  </style>
  <script type="module" crossorigin>(function(){const m=document.createElement("link").relList;if(m&&m.supports&&m.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))y(c);new MutationObserver(c=>{for(const t of c)if(t.type==="childList")for(const r of t.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&y(r)}).observe(document,{childList:!0,subtree:!0});function g(c){const t={};return c.integrity&&(t.integrity=c.integrity),c.referrerPolicy&&(t.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?t.credentials="include":c.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function y(c){if(c.ep)return;c.ep=!0;const t=g(c);fetch(c.href,t)}})();var vt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Pt(z){return z&&z.__esModule&&Object.prototype.hasOwnProperty.call(z,"default")?z.default:z}var ct={exports:{}};var At=ct.exports,pt;function Bt(){return pt||(pt=1,(function(z,m){(function(y,c){z.exports=c()})(At,function(){return(function(g){var y={};function c(t){if(y[t])return y[t].exports;var r=y[t]={i:t,l:!1,exports:{}};return g[t].call(r.exports,r,r.exports,c),r.l=!0,r.exports}return c.m=g,c.c=y,c.d=function(t,r,o){c.o(t,r)||Object.defineProperty(t,r,{enumerable:!0,get:o})},c.r=function(t){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},c.t=function(t,r){if(r&1&&(t=c(t)),r&8||r&4&&typeof t=="object"&&t&&t.__esModule)return t;var o=Object.create(null);if(c.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),r&2&&typeof t!="string")for(var n in t)c.d(o,n,function(u){return t[u]}.bind(null,n));return o},c.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return c.d(r,"a",r),r},c.o=function(t,r){return Object.prototype.hasOwnProperty.call(t,r)},c.p="",c(c.s=20)})([(function(g,y){var c={};g.exports=c,(function(){c._baseDelta=1e3/60,c._nextId=0,c._seed=0,c._nowStartTime=+new Date,c._warnedOnce={},c._decomp=null,c.extend=function(r,o){var n,u;typeof o=="boolean"?(n=2,u=o):(n=1,u=!0);for(var i=n;i<arguments.length;i++){var l=arguments[i];if(l)for(var h in l)u&&l[h]&&l[h].constructor===Object&&(!r[h]||r[h].constructor===Object)?(r[h]=r[h]||{},c.extend(r[h],u,l[h])):r[h]=l[h]}return r},c.clone=function(r,o){return c.extend({},o,r)},c.keys=function(r){if(Object.keys)return Object.keys(r);var o=[];for(var n in r)o.push(n);return o},c.values=function(r){var o=[];if(Object.keys){for(var n=Object.keys(r),u=0;u<n.length;u++)o.push(r[n[u]]);return o}for(var i in r)o.push(r[i]);return o},c.get=function(r,o,n,u){o=o.split(".").slice(n,u);for(var i=0;i<o.length;i+=1)r=r[o[i]];return r},c.set=function(r,o,n,u,i){var l=o.split(".").slice(u,i);return c.get(r,o,0,-1)[l[l.length-1]]=n,n},c.shuffle=function(r){for(var o=r.length-1;o>0;o--){var n=Math.floor(c.random()*(o+1)),u=r[o];r[o]=r[n],r[n]=u}return r},c.choose=function(r){return r[Math.floor(c.random()*r.length)]},c.isElement=function(r){return typeof HTMLElement<"u"?r instanceof HTMLElement:!!(r&&r.nodeType&&r.nodeName)},c.isArray=function(r){return Object.prototype.toString.call(r)==="[object Array]"},c.isFunction=function(r){return typeof r=="function"},c.isPlainObject=function(r){return typeof r=="object"&&r.constructor===Object},c.isString=function(r){return toString.call(r)==="[object String]"},c.clamp=function(r,o,n){return r<o?o:r>n?n:r},c.sign=function(r){return r<0?-1:1},c.now=function(){if(typeof window<"u"&&window.performance){if(window.performance.now)return window.performance.now();if(window.performance.webkitNow)return window.performance.webkitNow()}return Date.now?Date.now():new Date-c._nowStartTime},c.random=function(r,o){return r=typeof r<"u"?r:0,o=typeof o<"u"?o:1,r+t()*(o-r)};var t=function(){return c._seed=(c._seed*9301+49297)%233280,c._seed/233280};c.colorToNumber=function(r){return r=r.replace("#",""),r.length==3&&(r=r.charAt(0)+r.charAt(0)+r.charAt(1)+r.charAt(1)+r.charAt(2)+r.charAt(2)),parseInt(r,16)},c.logLevel=1,c.log=function(){console&&c.logLevel>0&&c.logLevel<=3&&console.log.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},c.info=function(){console&&c.logLevel>0&&c.logLevel<=2&&console.info.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},c.warn=function(){console&&c.logLevel>0&&c.logLevel<=3&&console.warn.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},c.warnOnce=function(){var r=Array.prototype.slice.call(arguments).join(" ");c._warnedOnce[r]||(c.warn(r),c._warnedOnce[r]=!0)},c.deprecated=function(r,o,n){r[o]=c.chain(function(){c.warnOnce("ðŸ”… deprecated ðŸ”…",n)},r[o])},c.nextId=function(){return c._nextId++},c.indexOf=function(r,o){if(r.indexOf)return r.indexOf(o);for(var n=0;n<r.length;n++)if(r[n]===o)return n;return-1},c.map=function(r,o){if(r.map)return r.map(o);for(var n=[],u=0;u<r.length;u+=1)n.push(o(r[u]));return n},c.topologicalSort=function(r){var o=[],n=[],u=[];for(var i in r)!n[i]&&!u[i]&&c._topologicalSort(i,n,u,r,o);return o},c._topologicalSort=function(r,o,n,u,i){var l=u[r]||[];n[r]=!0;for(var h=0;h<l.length;h+=1){var e=l[h];n[e]||o[e]||c._topologicalSort(e,o,n,u,i)}n[r]=!1,o[r]=!0,i.push(r)},c.chain=function(){for(var r=[],o=0;o<arguments.length;o+=1){var n=arguments[o];n._chained?r.push.apply(r,n._chained):r.push(n)}var u=function(){for(var i,l=new Array(arguments.length),h=0,e=arguments.length;h<e;h++)l[h]=arguments[h];for(h=0;h<r.length;h+=1){var s=r[h].apply(i,l);typeof s<"u"&&(i=s)}return i};return u._chained=r,u},c.chainPathBefore=function(r,o,n){return c.set(r,o,c.chain(n,c.get(r,o)))},c.chainPathAfter=function(r,o,n){return c.set(r,o,c.chain(c.get(r,o),n))},c.setDecomp=function(r){c._decomp=r},c.getDecomp=function(){var r=c._decomp;try{!r&&typeof window<"u"&&(r=window.decomp),!r&&typeof vt<"u"&&(r=vt.decomp)}catch{r=null}return r}})()}),(function(g,y){var c={};g.exports=c,(function(){c.create=function(t){var r={min:{x:0,y:0},max:{x:0,y:0}};return t&&c.update(r,t),r},c.update=function(t,r,o){t.min.x=1/0,t.max.x=-1/0,t.min.y=1/0,t.max.y=-1/0;for(var n=0;n<r.length;n++){var u=r[n];u.x>t.max.x&&(t.max.x=u.x),u.x<t.min.x&&(t.min.x=u.x),u.y>t.max.y&&(t.max.y=u.y),u.y<t.min.y&&(t.min.y=u.y)}o&&(o.x>0?t.max.x+=o.x:t.min.x+=o.x,o.y>0?t.max.y+=o.y:t.min.y+=o.y)},c.contains=function(t,r){return r.x>=t.min.x&&r.x<=t.max.x&&r.y>=t.min.y&&r.y<=t.max.y},c.overlaps=function(t,r){return t.min.x<=r.max.x&&t.max.x>=r.min.x&&t.max.y>=r.min.y&&t.min.y<=r.max.y},c.translate=function(t,r){t.min.x+=r.x,t.max.x+=r.x,t.min.y+=r.y,t.max.y+=r.y},c.shift=function(t,r){var o=t.max.x-t.min.x,n=t.max.y-t.min.y;t.min.x=r.x,t.max.x=r.x+o,t.min.y=r.y,t.max.y=r.y+n}})()}),(function(g,y){var c={};g.exports=c,(function(){c.create=function(t,r){return{x:t||0,y:r||0}},c.clone=function(t){return{x:t.x,y:t.y}},c.magnitude=function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},c.magnitudeSquared=function(t){return t.x*t.x+t.y*t.y},c.rotate=function(t,r,o){var n=Math.cos(r),u=Math.sin(r);o||(o={});var i=t.x*n-t.y*u;return o.y=t.x*u+t.y*n,o.x=i,o},c.rotateAbout=function(t,r,o,n){var u=Math.cos(r),i=Math.sin(r);n||(n={});var l=o.x+((t.x-o.x)*u-(t.y-o.y)*i);return n.y=o.y+((t.x-o.x)*i+(t.y-o.y)*u),n.x=l,n},c.normalise=function(t){var r=c.magnitude(t);return r===0?{x:0,y:0}:{x:t.x/r,y:t.y/r}},c.dot=function(t,r){return t.x*r.x+t.y*r.y},c.cross=function(t,r){return t.x*r.y-t.y*r.x},c.cross3=function(t,r,o){return(r.x-t.x)*(o.y-t.y)-(r.y-t.y)*(o.x-t.x)},c.add=function(t,r,o){return o||(o={}),o.x=t.x+r.x,o.y=t.y+r.y,o},c.sub=function(t,r,o){return o||(o={}),o.x=t.x-r.x,o.y=t.y-r.y,o},c.mult=function(t,r){return{x:t.x*r,y:t.y*r}},c.div=function(t,r){return{x:t.x/r,y:t.y/r}},c.perp=function(t,r){return r=r===!0?-1:1,{x:r*-t.y,y:r*t.x}},c.neg=function(t){return{x:-t.x,y:-t.y}},c.angle=function(t,r){return Math.atan2(r.y-t.y,r.x-t.x)},c._temp=[c.create(),c.create(),c.create(),c.create(),c.create(),c.create()]})()}),(function(g,y,c){var t={};g.exports=t;var r=c(2),o=c(0);(function(){t.create=function(n,u){for(var i=[],l=0;l<n.length;l++){var h=n[l],e={x:h.x,y:h.y,index:l,body:u,isInternal:!1};i.push(e)}return i},t.fromPath=function(n,u){var i=/L?\s*([-\d.e]+)[\s,]*([-\d.e]+)*/ig,l=[];return n.replace(i,function(h,e,s){l.push({x:parseFloat(e),y:parseFloat(s)})}),t.create(l,u)},t.centre=function(n){for(var u=t.area(n,!0),i={x:0,y:0},l,h,e,s=0;s<n.length;s++)e=(s+1)%n.length,l=r.cross(n[s],n[e]),h=r.mult(r.add(n[s],n[e]),l),i=r.add(i,h);return r.div(i,6*u)},t.mean=function(n){for(var u={x:0,y:0},i=0;i<n.length;i++)u.x+=n[i].x,u.y+=n[i].y;return r.div(u,n.length)},t.area=function(n,u){for(var i=0,l=n.length-1,h=0;h<n.length;h++)i+=(n[l].x-n[h].x)*(n[l].y+n[h].y),l=h;return u?i/2:Math.abs(i)/2},t.inertia=function(n,u){for(var i=0,l=0,h=n,e,s,a=0;a<h.length;a++)s=(a+1)%h.length,e=Math.abs(r.cross(h[s],h[a])),i+=e*(r.dot(h[s],h[s])+r.dot(h[s],h[a])+r.dot(h[a],h[a])),l+=e;return u/6*(i/l)},t.translate=function(n,u,i){i=typeof i<"u"?i:1;var l=n.length,h=u.x*i,e=u.y*i,s;for(s=0;s<l;s++)n[s].x+=h,n[s].y+=e;return n},t.rotate=function(n,u,i){if(u!==0){var l=Math.cos(u),h=Math.sin(u),e=i.x,s=i.y,a=n.length,f,v,P,I;for(I=0;I<a;I++)f=n[I],v=f.x-e,P=f.y-s,f.x=e+(v*l-P*h),f.y=s+(v*h+P*l);return n}},t.contains=function(n,u){for(var i=u.x,l=u.y,h=n.length,e=n[h-1],s,a=0;a<h;a++){if(s=n[a],(i-e.x)*(s.y-e.y)+(l-e.y)*(e.x-s.x)>0)return!1;e=s}return!0},t.scale=function(n,u,i,l){if(u===1&&i===1)return n;l=l||t.centre(n);for(var h,e,s=0;s<n.length;s++)h=n[s],e=r.sub(h,l),n[s].x=l.x+e.x*u,n[s].y=l.y+e.y*i;return n},t.chamfer=function(n,u,i,l,h){typeof u=="number"?u=[u]:u=u||[8],i=typeof i<"u"?i:-1,l=l||2,h=h||14;for(var e=[],s=0;s<n.length;s++){var a=n[s-1>=0?s-1:n.length-1],f=n[s],v=n[(s+1)%n.length],P=u[s<u.length?s:u.length-1];if(P===0){e.push(f);continue}var I=r.normalise({x:f.y-a.y,y:a.x-f.x}),M=r.normalise({x:v.y-f.y,y:f.x-v.x}),d=Math.sqrt(2*Math.pow(P,2)),p=r.mult(o.clone(I),P),S=r.normalise(r.mult(r.add(I,M),.5)),x=r.sub(f,r.mult(S,d)),C=i;i===-1&&(C=Math.pow(P,.32)*1.75),C=o.clamp(C,l,h),C%2===1&&(C+=1);for(var w=Math.acos(r.dot(I,M)),A=w/C,B=0;B<C;B++)e.push(r.add(r.rotate(p,A*B),x))}return e},t.clockwiseSort=function(n){var u=t.mean(n);return n.sort(function(i,l){return r.angle(u,i)-r.angle(u,l)}),n},t.isConvex=function(n){var u=0,i=n.length,l,h,e,s;if(i<3)return null;for(l=0;l<i;l++)if(h=(l+1)%i,e=(l+2)%i,s=(n[h].x-n[l].x)*(n[e].y-n[h].y),s-=(n[h].y-n[l].y)*(n[e].x-n[h].x),s<0?u|=1:s>0&&(u|=2),u===3)return!1;return u!==0?!0:null},t.hull=function(n){var u=[],i=[],l,h;for(n=n.slice(0),n.sort(function(e,s){var a=e.x-s.x;return a!==0?a:e.y-s.y}),h=0;h<n.length;h+=1){for(l=n[h];i.length>=2&&r.cross3(i[i.length-2],i[i.length-1],l)<=0;)i.pop();i.push(l)}for(h=n.length-1;h>=0;h-=1){for(l=n[h];u.length>=2&&r.cross3(u[u.length-2],u[u.length-1],l)<=0;)u.pop();u.push(l)}return u.pop(),i.pop(),u.concat(i)}})()}),(function(g,y,c){var t={};g.exports=t;var r=c(3),o=c(2),n=c(7),u=c(0),i=c(1),l=c(11);(function(){t._timeCorrection=!0,t._inertiaScale=4,t._nextCollidingGroupId=1,t._nextNonCollidingGroupId=-1,t._nextCategory=1,t._baseDelta=1e3/60,t.create=function(e){var s={id:u.nextId(),type:"body",label:"Body",parts:[],plugin:{},angle:0,vertices:r.fromPath("L 0 0 L 40 0 L 40 40 L 0 40"),position:{x:0,y:0},force:{x:0,y:0},torque:0,positionImpulse:{x:0,y:0},constraintImpulse:{x:0,y:0,angle:0},totalContacts:0,speed:0,angularSpeed:0,velocity:{x:0,y:0},angularVelocity:0,isSensor:!1,isStatic:!1,isSleeping:!1,motion:0,sleepThreshold:60,density:.001,restitution:0,friction:.1,frictionStatic:.5,frictionAir:.01,collisionFilter:{category:1,mask:4294967295,group:0},slop:.05,timeScale:1,render:{visible:!0,opacity:1,strokeStyle:null,fillStyle:null,lineWidth:null,sprite:{xScale:1,yScale:1,xOffset:0,yOffset:0}},events:null,bounds:null,chamfer:null,circleRadius:0,positionPrev:null,anglePrev:0,parent:null,axes:null,area:0,mass:0,inertia:0,deltaTime:16.666666666666668,_original:null},a=u.extend(s,e);return h(a,e),a},t.nextGroup=function(e){return e?t._nextNonCollidingGroupId--:t._nextCollidingGroupId++},t.nextCategory=function(){return t._nextCategory=t._nextCategory<<1,t._nextCategory};var h=function(e,s){s=s||{},t.set(e,{bounds:e.bounds||i.create(e.vertices),positionPrev:e.positionPrev||o.clone(e.position),anglePrev:e.anglePrev||e.angle,vertices:e.vertices,parts:e.parts||[e],isStatic:e.isStatic,isSleeping:e.isSleeping,parent:e.parent||e}),r.rotate(e.vertices,e.angle,e.position),l.rotate(e.axes,e.angle),i.update(e.bounds,e.vertices,e.velocity),t.set(e,{axes:s.axes||e.axes,area:s.area||e.area,mass:s.mass||e.mass,inertia:s.inertia||e.inertia});var a=e.isStatic?"#14151f":u.choose(["#f19648","#f5d259","#f55a3c","#063e7b","#ececd1"]),f=e.isStatic?"#555":"#ccc",v=e.isStatic&&e.render.fillStyle===null?1:0;e.render.fillStyle=e.render.fillStyle||a,e.render.strokeStyle=e.render.strokeStyle||f,e.render.lineWidth=e.render.lineWidth||v,e.render.sprite.xOffset+=-(e.bounds.min.x-e.position.x)/(e.bounds.max.x-e.bounds.min.x),e.render.sprite.yOffset+=-(e.bounds.min.y-e.position.y)/(e.bounds.max.y-e.bounds.min.y)};t.set=function(e,s,a){var f;typeof s=="string"&&(f=s,s={},s[f]=a);for(f in s)if(Object.prototype.hasOwnProperty.call(s,f))switch(a=s[f],f){case"isStatic":t.setStatic(e,a);break;case"isSleeping":n.set(e,a);break;case"mass":t.setMass(e,a);break;case"density":t.setDensity(e,a);break;case"inertia":t.setInertia(e,a);break;case"vertices":t.setVertices(e,a);break;case"position":t.setPosition(e,a);break;case"angle":t.setAngle(e,a);break;case"velocity":t.setVelocity(e,a);break;case"angularVelocity":t.setAngularVelocity(e,a);break;case"speed":t.setSpeed(e,a);break;case"angularSpeed":t.setAngularSpeed(e,a);break;case"parts":t.setParts(e,a);break;case"centre":t.setCentre(e,a);break;default:e[f]=a}},t.setStatic=function(e,s){for(var a=0;a<e.parts.length;a++){var f=e.parts[a];s?(f.isStatic||(f._original={restitution:f.restitution,friction:f.friction,mass:f.mass,inertia:f.inertia,density:f.density,inverseMass:f.inverseMass,inverseInertia:f.inverseInertia}),f.restitution=0,f.friction=1,f.mass=f.inertia=f.density=1/0,f.inverseMass=f.inverseInertia=0,f.positionPrev.x=f.position.x,f.positionPrev.y=f.position.y,f.anglePrev=f.angle,f.angularVelocity=0,f.speed=0,f.angularSpeed=0,f.motion=0):f._original&&(f.restitution=f._original.restitution,f.friction=f._original.friction,f.mass=f._original.mass,f.inertia=f._original.inertia,f.density=f._original.density,f.inverseMass=f._original.inverseMass,f.inverseInertia=f._original.inverseInertia,f._original=null),f.isStatic=s}},t.setMass=function(e,s){var a=e.inertia/(e.mass/6);e.inertia=a*(s/6),e.inverseInertia=1/e.inertia,e.mass=s,e.inverseMass=1/e.mass,e.density=e.mass/e.area},t.setDensity=function(e,s){t.setMass(e,s*e.area),e.density=s},t.setInertia=function(e,s){e.inertia=s,e.inverseInertia=1/e.inertia},t.setVertices=function(e,s){s[0].body===e?e.vertices=s:e.vertices=r.create(s,e),e.axes=l.fromVertices(e.vertices),e.area=r.area(e.vertices),t.setMass(e,e.density*e.area);var a=r.centre(e.vertices);r.translate(e.vertices,a,-1),t.setInertia(e,t._inertiaScale*r.inertia(e.vertices,e.mass)),r.translate(e.vertices,e.position),i.update(e.bounds,e.vertices,e.velocity)},t.setParts=function(e,s,a){var f;for(s=s.slice(0),e.parts.length=0,e.parts.push(e),e.parent=e,f=0;f<s.length;f++){var v=s[f];v!==e&&(v.parent=e,e.parts.push(v))}if(e.parts.length!==1){if(a=typeof a<"u"?a:!0,a){var P=[];for(f=0;f<s.length;f++)P=P.concat(s[f].vertices);r.clockwiseSort(P);var I=r.hull(P),M=r.centre(I);t.setVertices(e,I),r.translate(e.vertices,M)}var d=t._totalProperties(e);e.area=d.area,e.parent=e,e.position.x=d.centre.x,e.position.y=d.centre.y,e.positionPrev.x=d.centre.x,e.positionPrev.y=d.centre.y,t.setMass(e,d.mass),t.setInertia(e,d.inertia),t.setPosition(e,d.centre)}},t.setCentre=function(e,s,a){a?(e.positionPrev.x+=s.x,e.positionPrev.y+=s.y,e.position.x+=s.x,e.position.y+=s.y):(e.positionPrev.x=s.x-(e.position.x-e.positionPrev.x),e.positionPrev.y=s.y-(e.position.y-e.positionPrev.y),e.position.x=s.x,e.position.y=s.y)},t.setPosition=function(e,s,a){var f=o.sub(s,e.position);a?(e.positionPrev.x=e.position.x,e.positionPrev.y=e.position.y,e.velocity.x=f.x,e.velocity.y=f.y,e.speed=o.magnitude(f)):(e.positionPrev.x+=f.x,e.positionPrev.y+=f.y);for(var v=0;v<e.parts.length;v++){var P=e.parts[v];P.position.x+=f.x,P.position.y+=f.y,r.translate(P.vertices,f),i.update(P.bounds,P.vertices,e.velocity)}},t.setAngle=function(e,s,a){var f=s-e.angle;a?(e.anglePrev=e.angle,e.angularVelocity=f,e.angularSpeed=Math.abs(f)):e.anglePrev+=f;for(var v=0;v<e.parts.length;v++){var P=e.parts[v];P.angle+=f,r.rotate(P.vertices,f,e.position),l.rotate(P.axes,f),i.update(P.bounds,P.vertices,e.velocity),v>0&&o.rotateAbout(P.position,f,e.position,P.position)}},t.setVelocity=function(e,s){var a=e.deltaTime/t._baseDelta;e.positionPrev.x=e.position.x-s.x*a,e.positionPrev.y=e.position.y-s.y*a,e.velocity.x=(e.position.x-e.positionPrev.x)/a,e.velocity.y=(e.position.y-e.positionPrev.y)/a,e.speed=o.magnitude(e.velocity)},t.getVelocity=function(e){var s=t._baseDelta/e.deltaTime;return{x:(e.position.x-e.positionPrev.x)*s,y:(e.position.y-e.positionPrev.y)*s}},t.getSpeed=function(e){return o.magnitude(t.getVelocity(e))},t.setSpeed=function(e,s){t.setVelocity(e,o.mult(o.normalise(t.getVelocity(e)),s))},t.setAngularVelocity=function(e,s){var a=e.deltaTime/t._baseDelta;e.anglePrev=e.angle-s*a,e.angularVelocity=(e.angle-e.anglePrev)/a,e.angularSpeed=Math.abs(e.angularVelocity)},t.getAngularVelocity=function(e){return(e.angle-e.anglePrev)*t._baseDelta/e.deltaTime},t.getAngularSpeed=function(e){return Math.abs(t.getAngularVelocity(e))},t.setAngularSpeed=function(e,s){t.setAngularVelocity(e,u.sign(t.getAngularVelocity(e))*s)},t.translate=function(e,s,a){t.setPosition(e,o.add(e.position,s),a)},t.rotate=function(e,s,a,f){if(!a)t.setAngle(e,e.angle+s,f);else{var v=Math.cos(s),P=Math.sin(s),I=e.position.x-a.x,M=e.position.y-a.y;t.setPosition(e,{x:a.x+(I*v-M*P),y:a.y+(I*P+M*v)},f),t.setAngle(e,e.angle+s,f)}},t.scale=function(e,s,a,f){var v=0,P=0;f=f||e.position;for(var I=0;I<e.parts.length;I++){var M=e.parts[I];r.scale(M.vertices,s,a,f),M.axes=l.fromVertices(M.vertices),M.area=r.area(M.vertices),t.setMass(M,e.density*M.area),r.translate(M.vertices,{x:-M.position.x,y:-M.position.y}),t.setInertia(M,t._inertiaScale*r.inertia(M.vertices,M.mass)),r.translate(M.vertices,{x:M.position.x,y:M.position.y}),I>0&&(v+=M.area,P+=M.inertia),M.position.x=f.x+(M.position.x-f.x)*s,M.position.y=f.y+(M.position.y-f.y)*a,i.update(M.bounds,M.vertices,e.velocity)}e.parts.length>1&&(e.area=v,e.isStatic||(t.setMass(e,e.density*v),t.setInertia(e,P))),e.circleRadius&&(s===a?e.circleRadius*=s:e.circleRadius=null)},t.update=function(e,s){s=(typeof s<"u"?s:1e3/60)*e.timeScale;var a=s*s,f=t._timeCorrection?s/(e.deltaTime||s):1,v=1-e.frictionAir*(s/u._baseDelta),P=(e.position.x-e.positionPrev.x)*f,I=(e.position.y-e.positionPrev.y)*f;e.velocity.x=P*v+e.force.x/e.mass*a,e.velocity.y=I*v+e.force.y/e.mass*a,e.positionPrev.x=e.position.x,e.positionPrev.y=e.position.y,e.position.x+=e.velocity.x,e.position.y+=e.velocity.y,e.deltaTime=s,e.angularVelocity=(e.angle-e.anglePrev)*v*f+e.torque/e.inertia*a,e.anglePrev=e.angle,e.angle+=e.angularVelocity;for(var M=0;M<e.parts.length;M++){var d=e.parts[M];r.translate(d.vertices,e.velocity),M>0&&(d.position.x+=e.velocity.x,d.position.y+=e.velocity.y),e.angularVelocity!==0&&(r.rotate(d.vertices,e.angularVelocity,e.position),l.rotate(d.axes,e.angularVelocity),M>0&&o.rotateAbout(d.position,e.angularVelocity,e.position,d.position)),i.update(d.bounds,d.vertices,e.velocity)}},t.updateVelocities=function(e){var s=t._baseDelta/e.deltaTime,a=e.velocity;a.x=(e.position.x-e.positionPrev.x)*s,a.y=(e.position.y-e.positionPrev.y)*s,e.speed=Math.sqrt(a.x*a.x+a.y*a.y),e.angularVelocity=(e.angle-e.anglePrev)*s,e.angularSpeed=Math.abs(e.angularVelocity)},t.applyForce=function(e,s,a){var f={x:s.x-e.position.x,y:s.y-e.position.y};e.force.x+=a.x,e.force.y+=a.y,e.torque+=f.x*a.y-f.y*a.x},t._totalProperties=function(e){for(var s={mass:0,area:0,inertia:0,centre:{x:0,y:0}},a=e.parts.length===1?0:1;a<e.parts.length;a++){var f=e.parts[a],v=f.mass!==1/0?f.mass:1;s.mass+=v,s.area+=f.area,s.inertia+=f.inertia,s.centre=o.add(s.centre,o.mult(f.position,v))}return s.centre=o.div(s.centre,s.mass),s}})()}),(function(g,y,c){var t={};g.exports=t;var r=c(0);(function(){t.on=function(o,n,u){for(var i=n.split(" "),l,h=0;h<i.length;h++)l=i[h],o.events=o.events||{},o.events[l]=o.events[l]||[],o.events[l].push(u);return u},t.off=function(o,n,u){if(!n){o.events={};return}typeof n=="function"&&(u=n,n=r.keys(o.events).join(" "));for(var i=n.split(" "),l=0;l<i.length;l++){var h=o.events[i[l]],e=[];if(u&&h)for(var s=0;s<h.length;s++)h[s]!==u&&e.push(h[s]);o.events[i[l]]=e}},t.trigger=function(o,n,u){var i,l,h,e,s=o.events;if(s&&r.keys(s).length>0){u||(u={}),i=n.split(" ");for(var a=0;a<i.length;a++)if(l=i[a],h=s[l],h){e=r.clone(u,!1),e.name=l,e.source=o;for(var f=0;f<h.length;f++)h[f].apply(o,[e])}}}})()}),(function(g,y,c){var t={};g.exports=t;var r=c(5),o=c(0),n=c(1),u=c(4);(function(){t.create=function(i){return o.extend({id:o.nextId(),type:"composite",parent:null,isModified:!1,bodies:[],constraints:[],composites:[],label:"Composite",plugin:{},cache:{allBodies:null,allConstraints:null,allComposites:null}},i)},t.setModified=function(i,l,h,e){if(i.isModified=l,l&&i.cache&&(i.cache.allBodies=null,i.cache.allConstraints=null,i.cache.allComposites=null),h&&i.parent&&t.setModified(i.parent,l,h,e),e)for(var s=0;s<i.composites.length;s++){var a=i.composites[s];t.setModified(a,l,h,e)}},t.add=function(i,l){var h=[].concat(l);r.trigger(i,"beforeAdd",{object:l});for(var e=0;e<h.length;e++){var s=h[e];switch(s.type){case"body":if(s.parent!==s){o.warn("Composite.add: skipped adding a compound body part (you must add its parent instead)");break}t.addBody(i,s);break;case"constraint":t.addConstraint(i,s);break;case"composite":t.addComposite(i,s);break;case"mouseConstraint":t.addConstraint(i,s.constraint);break}}return r.trigger(i,"afterAdd",{object:l}),i},t.remove=function(i,l,h){var e=[].concat(l);r.trigger(i,"beforeRemove",{object:l});for(var s=0;s<e.length;s++){var a=e[s];switch(a.type){case"body":t.removeBody(i,a,h);break;case"constraint":t.removeConstraint(i,a,h);break;case"composite":t.removeComposite(i,a,h);break;case"mouseConstraint":t.removeConstraint(i,a.constraint);break}}return r.trigger(i,"afterRemove",{object:l}),i},t.addComposite=function(i,l){return i.composites.push(l),l.parent=i,t.setModified(i,!0,!0,!1),i},t.removeComposite=function(i,l,h){var e=o.indexOf(i.composites,l);if(e!==-1){var s=t.allBodies(l);t.removeCompositeAt(i,e);for(var a=0;a<s.length;a++)s[a].sleepCounter=0}if(h)for(var a=0;a<i.composites.length;a++)t.removeComposite(i.composites[a],l,!0);return i},t.removeCompositeAt=function(i,l){return i.composites.splice(l,1),t.setModified(i,!0,!0,!1),i},t.addBody=function(i,l){return i.bodies.push(l),t.setModified(i,!0,!0,!1),i},t.removeBody=function(i,l,h){var e=o.indexOf(i.bodies,l);if(e!==-1&&(t.removeBodyAt(i,e),l.sleepCounter=0),h)for(var s=0;s<i.composites.length;s++)t.removeBody(i.composites[s],l,!0);return i},t.removeBodyAt=function(i,l){return i.bodies.splice(l,1),t.setModified(i,!0,!0,!1),i},t.addConstraint=function(i,l){return i.constraints.push(l),t.setModified(i,!0,!0,!1),i},t.removeConstraint=function(i,l,h){var e=o.indexOf(i.constraints,l);if(e!==-1&&t.removeConstraintAt(i,e),h)for(var s=0;s<i.composites.length;s++)t.removeConstraint(i.composites[s],l,!0);return i},t.removeConstraintAt=function(i,l){return i.constraints.splice(l,1),t.setModified(i,!0,!0,!1),i},t.clear=function(i,l,h){if(h)for(var e=0;e<i.composites.length;e++)t.clear(i.composites[e],l,!0);return l?i.bodies=i.bodies.filter(function(s){return s.isStatic}):i.bodies.length=0,i.constraints.length=0,i.composites.length=0,t.setModified(i,!0,!0,!1),i},t.allBodies=function(i){if(i.cache&&i.cache.allBodies)return i.cache.allBodies;for(var l=[].concat(i.bodies),h=0;h<i.composites.length;h++)l=l.concat(t.allBodies(i.composites[h]));return i.cache&&(i.cache.allBodies=l),l},t.allConstraints=function(i){if(i.cache&&i.cache.allConstraints)return i.cache.allConstraints;for(var l=[].concat(i.constraints),h=0;h<i.composites.length;h++)l=l.concat(t.allConstraints(i.composites[h]));return i.cache&&(i.cache.allConstraints=l),l},t.allComposites=function(i){if(i.cache&&i.cache.allComposites)return i.cache.allComposites;for(var l=[].concat(i.composites),h=0;h<i.composites.length;h++)l=l.concat(t.allComposites(i.composites[h]));return i.cache&&(i.cache.allComposites=l),l},t.get=function(i,l,h){var e,s;switch(h){case"body":e=t.allBodies(i);break;case"constraint":e=t.allConstraints(i);break;case"composite":e=t.allComposites(i).concat(i);break}return e?(s=e.filter(function(a){return a.id.toString()===l.toString()}),s.length===0?null:s[0]):null},t.move=function(i,l,h){return t.remove(i,l),t.add(h,l),i},t.rebase=function(i){for(var l=t.allBodies(i).concat(t.allConstraints(i)).concat(t.allComposites(i)),h=0;h<l.length;h++)l[h].id=o.nextId();return i},t.translate=function(i,l,h){for(var e=h?t.allBodies(i):i.bodies,s=0;s<e.length;s++)u.translate(e[s],l);return i},t.rotate=function(i,l,h,e){for(var s=Math.cos(l),a=Math.sin(l),f=e?t.allBodies(i):i.bodies,v=0;v<f.length;v++){var P=f[v],I=P.position.x-h.x,M=P.position.y-h.y;u.setPosition(P,{x:h.x+(I*s-M*a),y:h.y+(I*a+M*s)}),u.rotate(P,l)}return i},t.scale=function(i,l,h,e,s){for(var a=s?t.allBodies(i):i.bodies,f=0;f<a.length;f++){var v=a[f],P=v.position.x-e.x,I=v.position.y-e.y;u.setPosition(v,{x:e.x+P*l,y:e.y+I*h}),u.scale(v,l,h)}return i},t.bounds=function(i){for(var l=t.allBodies(i),h=[],e=0;e<l.length;e+=1){var s=l[e];h.push(s.bounds.min,s.bounds.max)}return n.create(h)}})()}),(function(g,y,c){var t={};g.exports=t;var r=c(4),o=c(5),n=c(0);(function(){t._motionWakeThreshold=.18,t._motionSleepThreshold=.08,t._minBias=.9,t.update=function(u,i){for(var l=i/n._baseDelta,h=t._motionSleepThreshold,e=0;e<u.length;e++){var s=u[e],a=r.getSpeed(s),f=r.getAngularSpeed(s),v=a*a+f*f;if(s.force.x!==0||s.force.y!==0){t.set(s,!1);continue}var P=Math.min(s.motion,v),I=Math.max(s.motion,v);s.motion=t._minBias*P+(1-t._minBias)*I,s.sleepThreshold>0&&s.motion<h?(s.sleepCounter+=1,s.sleepCounter>=s.sleepThreshold/l&&t.set(s,!0)):s.sleepCounter>0&&(s.sleepCounter-=1)}},t.afterCollisions=function(u){for(var i=t._motionSleepThreshold,l=0;l<u.length;l++){var h=u[l];if(h.isActive){var e=h.collision,s=e.bodyA.parent,a=e.bodyB.parent;if(!(s.isSleeping&&a.isSleeping||s.isStatic||a.isStatic)&&(s.isSleeping||a.isSleeping)){var f=s.isSleeping&&!s.isStatic?s:a,v=f===s?a:s;!f.isStatic&&v.motion>i&&t.set(f,!1)}}}},t.set=function(u,i){var l=u.isSleeping;i?(u.isSleeping=!0,u.sleepCounter=u.sleepThreshold,u.positionImpulse.x=0,u.positionImpulse.y=0,u.positionPrev.x=u.position.x,u.positionPrev.y=u.position.y,u.anglePrev=u.angle,u.speed=0,u.angularSpeed=0,u.motion=0,l||o.trigger(u,"sleepStart")):(u.isSleeping=!1,u.sleepCounter=0,l&&o.trigger(u,"sleepEnd"))}})()}),(function(g,y,c){var t={};g.exports=t;var r=c(3),o=c(9);(function(){var n=[],u={overlap:0,axis:null},i={overlap:0,axis:null};t.create=function(l,h){return{pair:null,collided:!1,bodyA:l,bodyB:h,parentA:l.parent,parentB:h.parent,depth:0,normal:{x:0,y:0},tangent:{x:0,y:0},penetration:{x:0,y:0},supports:[null,null],supportCount:0}},t.collides=function(l,h,e){if(t._overlapAxes(u,l.vertices,h.vertices,l.axes),u.overlap<=0||(t._overlapAxes(i,h.vertices,l.vertices,h.axes),i.overlap<=0))return null;var s=e&&e.table[o.id(l,h)],a;s?a=s.collision:(a=t.create(l,h),a.collided=!0,a.bodyA=l.id<h.id?l:h,a.bodyB=l.id<h.id?h:l,a.parentA=a.bodyA.parent,a.parentB=a.bodyB.parent),l=a.bodyA,h=a.bodyB;var f;u.overlap<i.overlap?f=u:f=i;var v=a.normal,P=a.tangent,I=a.penetration,M=a.supports,d=f.overlap,p=f.axis,S=p.x,x=p.y,C=h.position.x-l.position.x,w=h.position.y-l.position.y;S*C+x*w>=0&&(S=-S,x=-x),v.x=S,v.y=x,P.x=-x,P.y=S,I.x=S*d,I.y=x*d,a.depth=d;var A=t._findSupports(l,h,v,1),B=0;if(r.contains(l.vertices,A[0])&&(M[B++]=A[0]),r.contains(l.vertices,A[1])&&(M[B++]=A[1]),B<2){var b=t._findSupports(h,l,v,-1);r.contains(h.vertices,b[0])&&(M[B++]=b[0]),B<2&&r.contains(h.vertices,b[1])&&(M[B++]=b[1])}return B===0&&(M[B++]=A[0]),a.supportCount=B,a},t._overlapAxes=function(l,h,e,s){var a=h.length,f=e.length,v=h[0].x,P=h[0].y,I=e[0].x,M=e[0].y,d=s.length,p=Number.MAX_VALUE,S=0,x,C,w,A,B,b;for(B=0;B<d;B++){var D=s[B],k=D.x,L=D.y,T=v*k+P*L,E=I*k+M*L,R=T,F=E;for(b=1;b<a;b+=1)A=h[b].x*k+h[b].y*L,A>R?R=A:A<T&&(T=A);for(b=1;b<f;b+=1)A=e[b].x*k+e[b].y*L,A>F?F=A:A<E&&(E=A);if(C=R-E,w=F-T,x=C<w?C:w,x<p&&(p=x,S=B,x<=0))break}l.axis=s[S],l.overlap=p},t._findSupports=function(l,h,e,s){var a=h.vertices,f=a.length,v=l.position.x,P=l.position.y,I=e.x*s,M=e.y*s,d=a[0],p=d,S=I*(v-p.x)+M*(P-p.y),x,C,w;for(w=1;w<f;w+=1)p=a[w],C=I*(v-p.x)+M*(P-p.y),C<S&&(S=C,d=p);return x=a[(f+d.index-1)%f],S=I*(v-x.x)+M*(P-x.y),p=a[(d.index+1)%f],I*(v-p.x)+M*(P-p.y)<S?(n[0]=d,n[1]=p,n):(n[0]=d,n[1]=x,n)}})()}),(function(g,y,c){var t={};g.exports=t;var r=c(16);(function(){t.create=function(o,n){var u=o.bodyA,i=o.bodyB,l={id:t.id(u,i),bodyA:u,bodyB:i,collision:o,contacts:[r.create(),r.create()],contactCount:0,separation:0,isActive:!0,isSensor:u.isSensor||i.isSensor,timeCreated:n,timeUpdated:n,inverseMass:0,friction:0,frictionStatic:0,restitution:0,slop:0};return t.update(l,o,n),l},t.update=function(o,n,u){var i=n.supports,l=n.supportCount,h=o.contacts,e=n.parentA,s=n.parentB;o.isActive=!0,o.timeUpdated=u,o.collision=n,o.separation=n.depth,o.inverseMass=e.inverseMass+s.inverseMass,o.friction=e.friction<s.friction?e.friction:s.friction,o.frictionStatic=e.frictionStatic>s.frictionStatic?e.frictionStatic:s.frictionStatic,o.restitution=e.restitution>s.restitution?e.restitution:s.restitution,o.slop=e.slop>s.slop?e.slop:s.slop,o.contactCount=l,n.pair=o;var a=i[0],f=h[0],v=i[1],P=h[1];(P.vertex===a||f.vertex===v)&&(h[1]=f,h[0]=f=P,P=h[1]),f.vertex=a,P.vertex=v},t.setActive=function(o,n,u){n?(o.isActive=!0,o.timeUpdated=u):(o.isActive=!1,o.contactCount=0)},t.id=function(o,n){return o.id<n.id?o.id.toString(36)+":"+n.id.toString(36):n.id.toString(36)+":"+o.id.toString(36)}})()}),(function(g,y,c){var t={};g.exports=t;var r=c(3),o=c(2),n=c(7),u=c(1),i=c(11),l=c(0);(function(){t._warming=.4,t._torqueDampen=1,t._minLength=1e-6,t.create=function(h){var e=h;e.bodyA&&!e.pointA&&(e.pointA={x:0,y:0}),e.bodyB&&!e.pointB&&(e.pointB={x:0,y:0});var s=e.bodyA?o.add(e.bodyA.position,e.pointA):e.pointA,a=e.bodyB?o.add(e.bodyB.position,e.pointB):e.pointB,f=o.magnitude(o.sub(s,a));e.length=typeof e.length<"u"?e.length:f,e.id=e.id||l.nextId(),e.label=e.label||"Constraint",e.type="constraint",e.stiffness=e.stiffness||(e.length>0?1:.7),e.damping=e.damping||0,e.angularStiffness=e.angularStiffness||0,e.angleA=e.bodyA?e.bodyA.angle:e.angleA,e.angleB=e.bodyB?e.bodyB.angle:e.angleB,e.plugin={};var v={visible:!0,lineWidth:2,strokeStyle:"#ffffff",type:"line",anchors:!0};return e.length===0&&e.stiffness>.1?(v.type="pin",v.anchors=!1):e.stiffness<.9&&(v.type="spring"),e.render=l.extend(v,e.render),e},t.preSolveAll=function(h){for(var e=0;e<h.length;e+=1){var s=h[e],a=s.constraintImpulse;s.isStatic||a.x===0&&a.y===0&&a.angle===0||(s.position.x+=a.x,s.position.y+=a.y,s.angle+=a.angle)}},t.solveAll=function(h,e){for(var s=l.clamp(e/l._baseDelta,0,1),a=0;a<h.length;a+=1){var f=h[a],v=!f.bodyA||f.bodyA&&f.bodyA.isStatic,P=!f.bodyB||f.bodyB&&f.bodyB.isStatic;(v||P)&&t.solve(h[a],s)}for(a=0;a<h.length;a+=1)f=h[a],v=!f.bodyA||f.bodyA&&f.bodyA.isStatic,P=!f.bodyB||f.bodyB&&f.bodyB.isStatic,!v&&!P&&t.solve(h[a],s)},t.solve=function(h,e){var s=h.bodyA,a=h.bodyB,f=h.pointA,v=h.pointB;if(!(!s&&!a)){s&&!s.isStatic&&(o.rotate(f,s.angle-h.angleA,f),h.angleA=s.angle),a&&!a.isStatic&&(o.rotate(v,a.angle-h.angleB,v),h.angleB=a.angle);var P=f,I=v;if(s&&(P=o.add(s.position,f)),a&&(I=o.add(a.position,v)),!(!P||!I)){var M=o.sub(P,I),d=o.magnitude(M);d<t._minLength&&(d=t._minLength);var p=(d-h.length)/d,S=h.stiffness>=1||h.length===0,x=S?h.stiffness*e:h.stiffness*e*e,C=h.damping*e,w=o.mult(M,p*x),A=(s?s.inverseMass:0)+(a?a.inverseMass:0),B=(s?s.inverseInertia:0)+(a?a.inverseInertia:0),b=A+B,D,k,L,T,E;if(C>0){var R=o.create();L=o.div(M,d),E=o.sub(a&&o.sub(a.position,a.positionPrev)||R,s&&o.sub(s.position,s.positionPrev)||R),T=o.dot(L,E)}s&&!s.isStatic&&(k=s.inverseMass/A,s.constraintImpulse.x-=w.x*k,s.constraintImpulse.y-=w.y*k,s.position.x-=w.x*k,s.position.y-=w.y*k,C>0&&(s.positionPrev.x-=C*L.x*T*k,s.positionPrev.y-=C*L.y*T*k),D=o.cross(f,w)/b*t._torqueDampen*s.inverseInertia*(1-h.angularStiffness),s.constraintImpulse.angle-=D,s.angle-=D),a&&!a.isStatic&&(k=a.inverseMass/A,a.constraintImpulse.x+=w.x*k,a.constraintImpulse.y+=w.y*k,a.position.x+=w.x*k,a.position.y+=w.y*k,C>0&&(a.positionPrev.x+=C*L.x*T*k,a.positionPrev.y+=C*L.y*T*k),D=o.cross(v,w)/b*t._torqueDampen*a.inverseInertia*(1-h.angularStiffness),a.constraintImpulse.angle+=D,a.angle+=D)}}},t.postSolveAll=function(h){for(var e=0;e<h.length;e++){var s=h[e],a=s.constraintImpulse;if(!(s.isStatic||a.x===0&&a.y===0&&a.angle===0)){n.set(s,!1);for(var f=0;f<s.parts.length;f++){var v=s.parts[f];r.translate(v.vertices,a),f>0&&(v.position.x+=a.x,v.position.y+=a.y),a.angle!==0&&(r.rotate(v.vertices,a.angle,s.position),i.rotate(v.axes,a.angle),f>0&&o.rotateAbout(v.position,a.angle,s.position,v.position)),u.update(v.bounds,v.vertices,s.velocity)}a.angle*=t._warming,a.x*=t._warming,a.y*=t._warming}}},t.pointAWorld=function(h){return{x:(h.bodyA?h.bodyA.position.x:0)+(h.pointA?h.pointA.x:0),y:(h.bodyA?h.bodyA.position.y:0)+(h.pointA?h.pointA.y:0)}},t.pointBWorld=function(h){return{x:(h.bodyB?h.bodyB.position.x:0)+(h.pointB?h.pointB.x:0),y:(h.bodyB?h.bodyB.position.y:0)+(h.pointB?h.pointB.y:0)}},t.currentLength=function(h){var e=(h.bodyA?h.bodyA.position.x:0)+(h.pointA?h.pointA.x:0),s=(h.bodyA?h.bodyA.position.y:0)+(h.pointA?h.pointA.y:0),a=(h.bodyB?h.bodyB.position.x:0)+(h.pointB?h.pointB.x:0),f=(h.bodyB?h.bodyB.position.y:0)+(h.pointB?h.pointB.y:0),v=e-a,P=s-f;return Math.sqrt(v*v+P*P)}})()}),(function(g,y,c){var t={};g.exports=t;var r=c(2),o=c(0);(function(){t.fromVertices=function(n){for(var u={},i=0;i<n.length;i++){var l=(i+1)%n.length,h=r.normalise({x:n[l].y-n[i].y,y:n[i].x-n[l].x}),e=h.y===0?1/0:h.x/h.y;e=e.toFixed(3).toString(),u[e]=h}return o.values(u)},t.rotate=function(n,u){if(u!==0)for(var i=Math.cos(u),l=Math.sin(u),h=0;h<n.length;h++){var e=n[h],s;s=e.x*i-e.y*l,e.y=e.x*l+e.y*i,e.x=s}}})()}),(function(g,y,c){var t={};g.exports=t;var r=c(3),o=c(0),n=c(4),u=c(1),i=c(2);(function(){t.rectangle=function(l,h,e,s,a){a=a||{};var f={label:"Rectangle Body",position:{x:l,y:h},vertices:r.fromPath("L 0 0 L "+e+" 0 L "+e+" "+s+" L 0 "+s)};if(a.chamfer){var v=a.chamfer;f.vertices=r.chamfer(f.vertices,v.radius,v.quality,v.qualityMin,v.qualityMax),delete a.chamfer}return n.create(o.extend({},f,a))},t.trapezoid=function(l,h,e,s,a,f){f=f||{},a>=1&&o.warn("Bodies.trapezoid: slope parameter must be < 1."),a*=.5;var v=(1-a*2)*e,P=e*a,I=P+v,M=I+P,d;a<.5?d="L 0 0 L "+P+" "+-s+" L "+I+" "+-s+" L "+M+" 0":d="L 0 0 L "+I+" "+-s+" L "+M+" 0";var p={label:"Trapezoid Body",position:{x:l,y:h},vertices:r.fromPath(d)};if(f.chamfer){var S=f.chamfer;p.vertices=r.chamfer(p.vertices,S.radius,S.quality,S.qualityMin,S.qualityMax),delete f.chamfer}return n.create(o.extend({},p,f))},t.circle=function(l,h,e,s,a){s=s||{};var f={label:"Circle Body",circleRadius:e};a=a||25;var v=Math.ceil(Math.max(10,Math.min(a,e)));return v%2===1&&(v+=1),t.polygon(l,h,v,e,o.extend({},f,s))},t.polygon=function(l,h,e,s,a){if(a=a||{},e<3)return t.circle(l,h,s,a);for(var f=2*Math.PI/e,v="",P=f*.5,I=0;I<e;I+=1){var M=P+I*f,d=Math.cos(M)*s,p=Math.sin(M)*s;v+="L "+d.toFixed(3)+" "+p.toFixed(3)+" "}var S={label:"Polygon Body",position:{x:l,y:h},vertices:r.fromPath(v)};if(a.chamfer){var x=a.chamfer;S.vertices=r.chamfer(S.vertices,x.radius,x.quality,x.qualityMin,x.qualityMax),delete a.chamfer}return n.create(o.extend({},S,a))},t.fromVertices=function(l,h,e,s,a,f,v,P){var I=o.getDecomp(),M,d,p,S,x,C,w,A,B,b,D;for(M=!!(I&&I.quickDecomp),s=s||{},p=[],a=typeof a<"u"?a:!1,f=typeof f<"u"?f:.01,v=typeof v<"u"?v:10,P=typeof P<"u"?P:.01,o.isArray(e[0])||(e=[e]),b=0;b<e.length;b+=1)if(C=e[b],S=r.isConvex(C),x=!S,x&&!M&&o.warnOnce("Bodies.fromVertices: Install the 'poly-decomp' library and use Common.setDecomp or provide 'decomp' as a global to decompose concave vertices."),S||!M)S?C=r.clockwiseSort(C):C=r.hull(C),p.push({position:{x:l,y:h},vertices:C});else{var k=C.map(function(X){return[X.x,X.y]});I.makeCCW(k),f!==!1&&I.removeCollinearPoints(k,f),P!==!1&&I.removeDuplicatePoints&&I.removeDuplicatePoints(k,P);var L=I.quickDecomp(k);for(w=0;w<L.length;w++){var T=L[w],E=T.map(function(X){return{x:X[0],y:X[1]}});v>0&&r.area(E)<v||p.push({position:r.centre(E),vertices:E})}}for(w=0;w<p.length;w++)p[w]=n.create(o.extend(p[w],s));if(a){var R=5;for(w=0;w<p.length;w++){var F=p[w];for(A=w+1;A<p.length;A++){var O=p[A];if(u.overlaps(F.bounds,O.bounds)){var G=F.vertices,N=O.vertices;for(B=0;B<F.vertices.length;B++)for(D=0;D<O.vertices.length;D++){var $=i.magnitudeSquared(i.sub(G[(B+1)%G.length],N[D])),Y=i.magnitudeSquared(i.sub(G[B],N[(D+1)%N.length]));$<R&&Y<R&&(G[B].isInternal=!0,N[D].isInternal=!0)}}}}}return p.length>1?(d=n.create(o.extend({parts:p.slice(0)},s)),n.setPosition(d,{x:l,y:h}),d):p[0]}})()}),(function(g,y,c){var t={};g.exports=t;var r=c(0),o=c(8);(function(){t.create=function(n){var u={bodies:[],collisions:[],pairs:null};return r.extend(u,n)},t.setBodies=function(n,u){n.bodies=u.slice(0)},t.clear=function(n){n.bodies=[],n.collisions=[]},t.collisions=function(n){var u=n.pairs,i=n.bodies,l=i.length,h=t.canCollide,e=o.collides,s=n.collisions,a=0,f,v;for(i.sort(t._compareBoundsX),f=0;f<l;f++){var P=i[f],I=P.bounds,M=P.bounds.max.x,d=P.bounds.max.y,p=P.bounds.min.y,S=P.isStatic||P.isSleeping,x=P.parts.length,C=x===1;for(v=f+1;v<l;v++){var w=i[v],A=w.bounds;if(A.min.x>M)break;if(!(d<A.min.y||p>A.max.y)&&!(S&&(w.isStatic||w.isSleeping))&&h(P.collisionFilter,w.collisionFilter)){var B=w.parts.length;if(C&&B===1){var b=e(P,w,u);b&&(s[a++]=b)}else for(var D=x>1?1:0,k=B>1?1:0,L=D;L<x;L++)for(var T=P.parts[L],I=T.bounds,E=k;E<B;E++){var R=w.parts[E],A=R.bounds;if(!(I.min.x>A.max.x||I.max.x<A.min.x||I.max.y<A.min.y||I.min.y>A.max.y)){var b=e(T,R,u);b&&(s[a++]=b)}}}}}return s.length!==a&&(s.length=a),s},t.canCollide=function(n,u){return n.group===u.group&&n.group!==0?n.group>0:(n.mask&u.category)!==0&&(u.mask&n.category)!==0},t._compareBoundsX=function(n,u){return n.bounds.min.x-u.bounds.min.x}})()}),(function(g,y,c){var t={};g.exports=t;var r=c(0);(function(){t.create=function(o){var n={};return o||r.log("Mouse.create: element was undefined, defaulting to document.body","warn"),n.element=o||document.body,n.absolute={x:0,y:0},n.position={x:0,y:0},n.mousedownPosition={x:0,y:0},n.mouseupPosition={x:0,y:0},n.offset={x:0,y:0},n.scale={x:1,y:1},n.wheelDelta=0,n.button=-1,n.pixelRatio=parseInt(n.element.getAttribute("data-pixel-ratio"),10)||1,n.sourceEvents={mousemove:null,mousedown:null,mouseup:null,mousewheel:null},n.mousemove=function(u){var i=t._getRelativeMousePosition(u,n.element,n.pixelRatio),l=u.changedTouches;l&&(n.button=0,u.preventDefault()),n.absolute.x=i.x,n.absolute.y=i.y,n.position.x=n.absolute.x*n.scale.x+n.offset.x,n.position.y=n.absolute.y*n.scale.y+n.offset.y,n.sourceEvents.mousemove=u},n.mousedown=function(u){var i=t._getRelativeMousePosition(u,n.element,n.pixelRatio),l=u.changedTouches;l?(n.button=0,u.preventDefault()):n.button=u.button,n.absolute.x=i.x,n.absolute.y=i.y,n.position.x=n.absolute.x*n.scale.x+n.offset.x,n.position.y=n.absolute.y*n.scale.y+n.offset.y,n.mousedownPosition.x=n.position.x,n.mousedownPosition.y=n.position.y,n.sourceEvents.mousedown=u},n.mouseup=function(u){var i=t._getRelativeMousePosition(u,n.element,n.pixelRatio),l=u.changedTouches;l&&u.preventDefault(),n.button=-1,n.absolute.x=i.x,n.absolute.y=i.y,n.position.x=n.absolute.x*n.scale.x+n.offset.x,n.position.y=n.absolute.y*n.scale.y+n.offset.y,n.mouseupPosition.x=n.position.x,n.mouseupPosition.y=n.position.y,n.sourceEvents.mouseup=u},n.mousewheel=function(u){n.wheelDelta=Math.max(-1,Math.min(1,u.wheelDelta||-u.detail)),u.preventDefault(),n.sourceEvents.mousewheel=u},t.setElement(n,n.element),n},t.setElement=function(o,n){o.element=n,n.addEventListener("mousemove",o.mousemove,{passive:!0}),n.addEventListener("mousedown",o.mousedown,{passive:!0}),n.addEventListener("mouseup",o.mouseup,{passive:!0}),n.addEventListener("wheel",o.mousewheel,{passive:!1}),n.addEventListener("touchmove",o.mousemove,{passive:!1}),n.addEventListener("touchstart",o.mousedown,{passive:!1}),n.addEventListener("touchend",o.mouseup,{passive:!1})},t.clearSourceEvents=function(o){o.sourceEvents.mousemove=null,o.sourceEvents.mousedown=null,o.sourceEvents.mouseup=null,o.sourceEvents.mousewheel=null,o.wheelDelta=0},t.setOffset=function(o,n){o.offset.x=n.x,o.offset.y=n.y,o.position.x=o.absolute.x*o.scale.x+o.offset.x,o.position.y=o.absolute.y*o.scale.y+o.offset.y},t.setScale=function(o,n){o.scale.x=n.x,o.scale.y=n.y,o.position.x=o.absolute.x*o.scale.x+o.offset.x,o.position.y=o.absolute.y*o.scale.y+o.offset.y},t._getRelativeMousePosition=function(o,n,u){var i=n.getBoundingClientRect(),l=document.documentElement||document.body.parentNode||document.body,h=window.pageXOffset!==void 0?window.pageXOffset:l.scrollLeft,e=window.pageYOffset!==void 0?window.pageYOffset:l.scrollTop,s=o.changedTouches,a,f;return s?(a=s[0].pageX-i.left-h,f=s[0].pageY-i.top-e):(a=o.pageX-i.left-h,f=o.pageY-i.top-e),{x:a/(n.clientWidth/(n.width||n.clientWidth)*u),y:f/(n.clientHeight/(n.height||n.clientHeight)*u)}}})()}),(function(g,y,c){var t={};g.exports=t;var r=c(0);(function(){t._registry={},t.register=function(o){if(t.isPlugin(o)||r.warn("Plugin.register:",t.toString(o),"does not implement all required fields."),o.name in t._registry){var n=t._registry[o.name],u=t.versionParse(o.version).number,i=t.versionParse(n.version).number;u>i?(r.warn("Plugin.register:",t.toString(n),"was upgraded to",t.toString(o)),t._registry[o.name]=o):u<i?r.warn("Plugin.register:",t.toString(n),"can not be downgraded to",t.toString(o)):o!==n&&r.warn("Plugin.register:",t.toString(o),"is already registered to different plugin object")}else t._registry[o.name]=o;return o},t.resolve=function(o){return t._registry[t.dependencyParse(o).name]},t.toString=function(o){return typeof o=="string"?o:(o.name||"anonymous")+"@"+(o.version||o.range||"0.0.0")},t.isPlugin=function(o){return o&&o.name&&o.version&&o.install},t.isUsed=function(o,n){return o.used.indexOf(n)>-1},t.isFor=function(o,n){var u=o.for&&t.dependencyParse(o.for);return!o.for||n.name===u.name&&t.versionSatisfies(n.version,u.range)},t.use=function(o,n){if(o.uses=(o.uses||[]).concat(n||[]),o.uses.length===0){r.warn("Plugin.use:",t.toString(o),"does not specify any dependencies to install.");return}for(var u=t.dependencies(o),i=r.topologicalSort(u),l=[],h=0;h<i.length;h+=1)if(i[h]!==o.name){var e=t.resolve(i[h]);if(!e){l.push("âŒ "+i[h]);continue}t.isUsed(o,e.name)||(t.isFor(e,o)||(r.warn("Plugin.use:",t.toString(e),"is for",e.for,"but installed on",t.toString(o)+"."),e._warned=!0),e.install?e.install(o):(r.warn("Plugin.use:",t.toString(e),"does not specify an install function."),e._warned=!0),e._warned?(l.push("ðŸ”¶ "+t.toString(e)),delete e._warned):l.push("âœ… "+t.toString(e)),o.used.push(e.name))}l.length>0&&r.info(l.join("  "))},t.dependencies=function(o,n){var u=t.dependencyParse(o),i=u.name;if(n=n||{},!(i in n)){o=t.resolve(o)||o,n[i]=r.map(o.uses||[],function(h){t.isPlugin(h)&&t.register(h);var e=t.dependencyParse(h),s=t.resolve(h);return s&&!t.versionSatisfies(s.version,e.range)?(r.warn("Plugin.dependencies:",t.toString(s),"does not satisfy",t.toString(e),"used by",t.toString(u)+"."),s._warned=!0,o._warned=!0):s||(r.warn("Plugin.dependencies:",t.toString(h),"used by",t.toString(u),"could not be resolved."),o._warned=!0),e.name});for(var l=0;l<n[i].length;l+=1)t.dependencies(n[i][l],n);return n}},t.dependencyParse=function(o){if(r.isString(o)){var n=/^[\w-]+(@(\*|[\^~]?\d+\.\d+\.\d+(-[0-9A-Za-z-+]+)?))?$/;return n.test(o)||r.warn("Plugin.dependencyParse:",o,"is not a valid dependency string."),{name:o.split("@")[0],range:o.split("@")[1]||"*"}}return{name:o.name,range:o.range||o.version}},t.versionParse=function(o){var n=/^(\*)|(\^|~|>=|>)?\s*((\d+)\.(\d+)\.(\d+))(-[0-9A-Za-z-+]+)?$/;n.test(o)||r.warn("Plugin.versionParse:",o,"is not a valid version or range.");var u=n.exec(o),i=Number(u[4]),l=Number(u[5]),h=Number(u[6]);return{isRange:!!(u[1]||u[2]),version:u[3],range:o,operator:u[1]||u[2]||"",major:i,minor:l,patch:h,parts:[i,l,h],prerelease:u[7],number:i*1e8+l*1e4+h}},t.versionSatisfies=function(o,n){n=n||"*";var u=t.versionParse(n),i=t.versionParse(o);if(u.isRange){if(u.operator==="*"||o==="*")return!0;if(u.operator===">")return i.number>u.number;if(u.operator===">=")return i.number>=u.number;if(u.operator==="~")return i.major===u.major&&i.minor===u.minor&&i.patch>=u.patch;if(u.operator==="^")return u.major>0?i.major===u.major&&i.number>=u.number:u.minor>0?i.minor===u.minor&&i.patch>=u.patch:i.patch===u.patch}return o===n||o==="*"}})()}),(function(g,y){var c={};g.exports=c,(function(){c.create=function(t){return{vertex:t,normalImpulse:0,tangentImpulse:0}}})()}),(function(g,y,c){var t={};g.exports=t;var r=c(7),o=c(18),n=c(13),u=c(19),i=c(5),l=c(6),h=c(10),e=c(0),s=c(4);(function(){t._deltaMax=1e3/60,t.create=function(a){a=a||{};var f={positionIterations:6,velocityIterations:4,constraintIterations:2,enableSleeping:!1,events:[],plugin:{},gravity:{x:0,y:1,scale:.001},timing:{timestamp:0,timeScale:1,lastDelta:0,lastElapsed:0,lastUpdatesPerFrame:0}},v=e.extend(f,a);return v.world=a.world||l.create({label:"World"}),v.pairs=a.pairs||u.create(),v.detector=a.detector||n.create(),v.detector.pairs=v.pairs,v.grid={buckets:[]},v.world.gravity=v.gravity,v.broadphase=v.grid,v.metrics={},v},t.update=function(a,f){var v=e.now(),P=a.world,I=a.detector,M=a.pairs,d=a.timing,p=d.timestamp,S;f>t._deltaMax&&e.warnOnce("Matter.Engine.update: delta argument is recommended to be less than or equal to",t._deltaMax.toFixed(3),"ms."),f=typeof f<"u"?f:e._baseDelta,f*=d.timeScale,d.timestamp+=f,d.lastDelta=f;var x={timestamp:d.timestamp,delta:f};i.trigger(a,"beforeUpdate",x);var C=l.allBodies(P),w=l.allConstraints(P);for(P.isModified&&(n.setBodies(I,C),l.setModified(P,!1,!1,!0)),a.enableSleeping&&r.update(C,f),t._bodiesApplyGravity(C,a.gravity),f>0&&t._bodiesUpdate(C,f),i.trigger(a,"beforeSolve",x),h.preSolveAll(C),S=0;S<a.constraintIterations;S++)h.solveAll(w,f);h.postSolveAll(C);var A=n.collisions(I);u.update(M,A,p),a.enableSleeping&&r.afterCollisions(M.list),M.collisionStart.length>0&&i.trigger(a,"collisionStart",{pairs:M.collisionStart,timestamp:d.timestamp,delta:f});var B=e.clamp(20/a.positionIterations,0,1);for(o.preSolvePosition(M.list),S=0;S<a.positionIterations;S++)o.solvePosition(M.list,f,B);for(o.postSolvePosition(C),h.preSolveAll(C),S=0;S<a.constraintIterations;S++)h.solveAll(w,f);for(h.postSolveAll(C),o.preSolveVelocity(M.list),S=0;S<a.velocityIterations;S++)o.solveVelocity(M.list,f);return t._bodiesUpdateVelocities(C),M.collisionActive.length>0&&i.trigger(a,"collisionActive",{pairs:M.collisionActive,timestamp:d.timestamp,delta:f}),M.collisionEnd.length>0&&i.trigger(a,"collisionEnd",{pairs:M.collisionEnd,timestamp:d.timestamp,delta:f}),t._bodiesClearForces(C),i.trigger(a,"afterUpdate",x),a.timing.lastElapsed=e.now()-v,a},t.merge=function(a,f){if(e.extend(a,f),f.world){a.world=f.world,t.clear(a);for(var v=l.allBodies(a.world),P=0;P<v.length;P++){var I=v[P];r.set(I,!1),I.id=e.nextId()}}},t.clear=function(a){u.clear(a.pairs),n.clear(a.detector)},t._bodiesClearForces=function(a){for(var f=a.length,v=0;v<f;v++){var P=a[v];P.force.x=0,P.force.y=0,P.torque=0}},t._bodiesApplyGravity=function(a,f){var v=typeof f.scale<"u"?f.scale:.001,P=a.length;if(!(f.x===0&&f.y===0||v===0))for(var I=0;I<P;I++){var M=a[I];M.isStatic||M.isSleeping||(M.force.y+=M.mass*f.y*v,M.force.x+=M.mass*f.x*v)}},t._bodiesUpdate=function(a,f){for(var v=a.length,P=0;P<v;P++){var I=a[P];I.isStatic||I.isSleeping||s.update(I,f)}},t._bodiesUpdateVelocities=function(a){for(var f=a.length,v=0;v<f;v++)s.updateVelocities(a[v])}})()}),(function(g,y,c){var t={};g.exports=t;var r=c(3),o=c(0),n=c(1);(function(){t._restingThresh=2,t._restingThreshTangent=Math.sqrt(6),t._positionDampen=.9,t._positionWarming=.8,t._frictionNormalMultiplier=5,t._frictionMaxStatic=Number.MAX_VALUE,t.preSolvePosition=function(u){var i,l,h,e=u.length;for(i=0;i<e;i++)l=u[i],l.isActive&&(h=l.contactCount,l.collision.parentA.totalContacts+=h,l.collision.parentB.totalContacts+=h)},t.solvePosition=function(u,i,l){var h,e,s,a,f,v,P,I,M=t._positionDampen*(l||1),d=o.clamp(i/o._baseDelta,0,1),p=u.length;for(h=0;h<p;h++)e=u[h],!(!e.isActive||e.isSensor)&&(s=e.collision,a=s.parentA,f=s.parentB,v=s.normal,e.separation=s.depth+v.x*(f.positionImpulse.x-a.positionImpulse.x)+v.y*(f.positionImpulse.y-a.positionImpulse.y));for(h=0;h<p;h++)e=u[h],!(!e.isActive||e.isSensor)&&(s=e.collision,a=s.parentA,f=s.parentB,v=s.normal,I=e.separation-e.slop*d,(a.isStatic||f.isStatic)&&(I*=2),a.isStatic||a.isSleeping||(P=M/a.totalContacts,a.positionImpulse.x+=v.x*I*P,a.positionImpulse.y+=v.y*I*P),f.isStatic||f.isSleeping||(P=M/f.totalContacts,f.positionImpulse.x-=v.x*I*P,f.positionImpulse.y-=v.y*I*P))},t.postSolvePosition=function(u){for(var i=t._positionWarming,l=u.length,h=r.translate,e=n.update,s=0;s<l;s++){var a=u[s],f=a.positionImpulse,v=f.x,P=f.y,I=a.velocity;if(a.totalContacts=0,v!==0||P!==0){for(var M=0;M<a.parts.length;M++){var d=a.parts[M];h(d.vertices,f),e(d.bounds,d.vertices,I),d.position.x+=v,d.position.y+=P}a.positionPrev.x+=v,a.positionPrev.y+=P,v*I.x+P*I.y<0?(f.x=0,f.y=0):(f.x*=i,f.y*=i)}}},t.preSolveVelocity=function(u){var i=u.length,l,h;for(l=0;l<i;l++){var e=u[l];if(!(!e.isActive||e.isSensor)){var s=e.contacts,a=e.contactCount,f=e.collision,v=f.parentA,P=f.parentB,I=f.normal,M=f.tangent;for(h=0;h<a;h++){var d=s[h],p=d.vertex,S=d.normalImpulse,x=d.tangentImpulse;if(S!==0||x!==0){var C=I.x*S+M.x*x,w=I.y*S+M.y*x;v.isStatic||v.isSleeping||(v.positionPrev.x+=C*v.inverseMass,v.positionPrev.y+=w*v.inverseMass,v.anglePrev+=v.inverseInertia*((p.x-v.position.x)*w-(p.y-v.position.y)*C)),P.isStatic||P.isSleeping||(P.positionPrev.x-=C*P.inverseMass,P.positionPrev.y-=w*P.inverseMass,P.anglePrev-=P.inverseInertia*((p.x-P.position.x)*w-(p.y-P.position.y)*C))}}}}},t.solveVelocity=function(u,i){var l=i/o._baseDelta,h=l*l,e=h*l,s=-t._restingThresh*l,a=t._restingThreshTangent,f=t._frictionNormalMultiplier*l,v=t._frictionMaxStatic,P=u.length,I,M,d,p;for(d=0;d<P;d++){var S=u[d];if(!(!S.isActive||S.isSensor)){var x=S.collision,C=x.parentA,w=x.parentB,A=x.normal.x,B=x.normal.y,b=x.tangent.x,D=x.tangent.y,k=S.inverseMass,L=S.friction*S.frictionStatic*f,T=S.contacts,E=S.contactCount,R=1/E,F=C.position.x-C.positionPrev.x,O=C.position.y-C.positionPrev.y,G=C.angle-C.anglePrev,N=w.position.x-w.positionPrev.x,$=w.position.y-w.positionPrev.y,Y=w.angle-w.anglePrev;for(p=0;p<E;p++){var X=T[p],q=X.vertex,Z=q.x-C.position.x,et=q.y-C.position.y,K=q.x-w.position.x,j=q.y-w.position.y,Q=F-et*G,_=O+Z*G,tt=N-j*Y,V=$+K*Y,nt=Q-tt,W=_-V,J=A*nt+B*W,it=b*nt+D*W,ut=S.separation+J,ht=Math.min(ut,1);ht=ut<0?0:ht;var dt=ht*L;it<-dt||it>dt?(M=it>0?it:-it,I=S.friction*(it>0?1:-1)*e,I<-M?I=-M:I>M&&(I=M)):(I=it,M=v);var gt=Z*B-et*A,xt=K*B-j*A,mt=R/(k+C.inverseInertia*gt*gt+w.inverseInertia*xt*xt),rt=(1+S.restitution)*J*mt;if(I*=mt,J<s)X.normalImpulse=0;else{var It=X.normalImpulse;X.normalImpulse+=rt,X.normalImpulse>0&&(X.normalImpulse=0),rt=X.normalImpulse-It}if(it<-a||it>a)X.tangentImpulse=0;else{var Lt=X.tangentImpulse;X.tangentImpulse+=I,X.tangentImpulse<-M&&(X.tangentImpulse=-M),X.tangentImpulse>M&&(X.tangentImpulse=M),I=X.tangentImpulse-Lt}var ot=A*rt+b*I,lt=B*rt+D*I;C.isStatic||C.isSleeping||(C.positionPrev.x+=ot*C.inverseMass,C.positionPrev.y+=lt*C.inverseMass,C.anglePrev+=(Z*lt-et*ot)*C.inverseInertia),w.isStatic||w.isSleeping||(w.positionPrev.x-=ot*w.inverseMass,w.positionPrev.y-=lt*w.inverseMass,w.anglePrev-=(K*lt-j*ot)*w.inverseInertia)}}}}})()}),(function(g,y,c){var t={};g.exports=t;var r=c(9),o=c(0);(function(){t.create=function(n){return o.extend({table:{},list:[],collisionStart:[],collisionActive:[],collisionEnd:[]},n)},t.update=function(n,u,i){var l=r.update,h=r.create,e=r.setActive,s=n.table,a=n.list,f=a.length,v=f,P=n.collisionStart,I=n.collisionEnd,M=n.collisionActive,d=u.length,p=0,S=0,x=0,C,w,A;for(A=0;A<d;A++)C=u[A],w=C.pair,w?(w.isActive&&(M[x++]=w),l(w,C,i)):(w=h(C,i),s[w.id]=w,P[p++]=w,a[v++]=w);for(v=0,f=a.length,A=0;A<f;A++)w=a[A],w.timeUpdated>=i?a[v++]=w:(e(w,!1,i),w.collision.bodyA.sleepCounter>0&&w.collision.bodyB.sleepCounter>0?a[v++]=w:(I[S++]=w,delete s[w.id]));a.length!==v&&(a.length=v),P.length!==p&&(P.length=p),I.length!==S&&(I.length=S),M.length!==x&&(M.length=x)},t.clear=function(n){return n.table={},n.list.length=0,n.collisionStart.length=0,n.collisionActive.length=0,n.collisionEnd.length=0,n}})()}),(function(g,y,c){var t=g.exports=c(21);t.Axes=c(11),t.Bodies=c(12),t.Body=c(4),t.Bounds=c(1),t.Collision=c(8),t.Common=c(0),t.Composite=c(6),t.Composites=c(22),t.Constraint=c(10),t.Contact=c(16),t.Detector=c(13),t.Engine=c(17),t.Events=c(5),t.Grid=c(23),t.Mouse=c(14),t.MouseConstraint=c(24),t.Pair=c(9),t.Pairs=c(19),t.Plugin=c(15),t.Query=c(25),t.Render=c(26),t.Resolver=c(18),t.Runner=c(27),t.SAT=c(28),t.Sleeping=c(7),t.Svg=c(29),t.Vector=c(2),t.Vertices=c(3),t.World=c(30),t.Engine.run=t.Runner.run,t.Common.deprecated(t.Engine,"run","Engine.run âž¤ use Matter.Runner.run(engine) instead")}),(function(g,y,c){var t={};g.exports=t;var r=c(15),o=c(0);(function(){t.name="matter-js",t.version="0.20.0",t.uses=[],t.used=[],t.use=function(){r.use(t,Array.prototype.slice.call(arguments))},t.before=function(n,u){return n=n.replace(/^Matter./,""),o.chainPathBefore(t,n,u)},t.after=function(n,u){return n=n.replace(/^Matter./,""),o.chainPathAfter(t,n,u)}})()}),(function(g,y,c){var t={};g.exports=t;var r=c(6),o=c(10),n=c(0),u=c(4),i=c(12),l=n.deprecated;(function(){t.stack=function(h,e,s,a,f,v,P){for(var I=r.create({label:"Stack"}),M=h,d=e,p,S=0,x=0;x<a;x++){for(var C=0,w=0;w<s;w++){var A=P(M,d,w,x,p,S);if(A){var B=A.bounds.max.y-A.bounds.min.y,b=A.bounds.max.x-A.bounds.min.x;B>C&&(C=B),u.translate(A,{x:b*.5,y:B*.5}),M=A.bounds.max.x+f,r.addBody(I,A),p=A,S+=1}else M+=f}d+=C+v,M=h}return I},t.chain=function(h,e,s,a,f,v){for(var P=h.bodies,I=1;I<P.length;I++){var M=P[I-1],d=P[I],p=M.bounds.max.y-M.bounds.min.y,S=M.bounds.max.x-M.bounds.min.x,x=d.bounds.max.y-d.bounds.min.y,C=d.bounds.max.x-d.bounds.min.x,w={bodyA:M,pointA:{x:S*e,y:p*s},bodyB:d,pointB:{x:C*a,y:x*f}},A=n.extend(w,v);r.addConstraint(h,o.create(A))}return h.label+=" Chain",h},t.mesh=function(h,e,s,a,f){var v=h.bodies,P,I,M,d,p;for(P=0;P<s;P++){for(I=1;I<e;I++)M=v[I-1+P*e],d=v[I+P*e],r.addConstraint(h,o.create(n.extend({bodyA:M,bodyB:d},f)));if(P>0)for(I=0;I<e;I++)M=v[I+(P-1)*e],d=v[I+P*e],r.addConstraint(h,o.create(n.extend({bodyA:M,bodyB:d},f))),a&&I>0&&(p=v[I-1+(P-1)*e],r.addConstraint(h,o.create(n.extend({bodyA:p,bodyB:d},f)))),a&&I<e-1&&(p=v[I+1+(P-1)*e],r.addConstraint(h,o.create(n.extend({bodyA:p,bodyB:d},f))))}return h.label+=" Mesh",h},t.pyramid=function(h,e,s,a,f,v,P){return t.stack(h,e,s,a,f,v,function(I,M,d,p,S,x){var C=Math.min(a,Math.ceil(s/2)),w=S?S.bounds.max.x-S.bounds.min.x:0;if(!(p>C)){p=C-p;var A=p,B=s-1-p;if(!(d<A||d>B)){x===1&&u.translate(S,{x:(d+(s%2===1?1:-1))*w,y:0});var b=S?d*w:0;return P(h+b+d*f,M,d,p,S,x)}}})},t.newtonsCradle=function(h,e,s,a,f){for(var v=r.create({label:"Newtons Cradle"}),P=0;P<s;P++){var I=1.9,M=i.circle(h+P*(a*I),e+f,a,{inertia:1/0,restitution:1,friction:0,frictionAir:1e-4,slop:1}),d=o.create({pointA:{x:h+P*(a*I),y:e},bodyB:M});r.addBody(v,M),r.addConstraint(v,d)}return v},l(t,"newtonsCradle","Composites.newtonsCradle âž¤ moved to newtonsCradle example"),t.car=function(h,e,s,a,f){var v=u.nextGroup(!0),P=20,I=-s*.5+P,M=s*.5-P,d=0,p=r.create({label:"Car"}),S=i.rectangle(h,e,s,a,{collisionFilter:{group:v},chamfer:{radius:a*.5},density:2e-4}),x=i.circle(h+I,e+d,f,{collisionFilter:{group:v},friction:.8}),C=i.circle(h+M,e+d,f,{collisionFilter:{group:v},friction:.8}),w=o.create({bodyB:S,pointB:{x:I,y:d},bodyA:x,stiffness:1,length:0}),A=o.create({bodyB:S,pointB:{x:M,y:d},bodyA:C,stiffness:1,length:0});return r.addBody(p,S),r.addBody(p,x),r.addBody(p,C),r.addConstraint(p,w),r.addConstraint(p,A),p},l(t,"car","Composites.car âž¤ moved to car example"),t.softBody=function(h,e,s,a,f,v,P,I,M,d){M=n.extend({inertia:1/0},M),d=n.extend({stiffness:.2,render:{type:"line",anchors:!1}},d);var p=t.stack(h,e,s,a,f,v,function(S,x){return i.circle(S,x,I,M)});return t.mesh(p,s,a,P,d),p.label="Soft Body",p},l(t,"softBody","Composites.softBody âž¤ moved to softBody and cloth examples")})()}),(function(g,y,c){var t={};g.exports=t;var r=c(9),o=c(0),n=o.deprecated;(function(){t.create=function(u){var i={buckets:{},pairs:{},pairsList:[],bucketWidth:48,bucketHeight:48};return o.extend(i,u)},t.update=function(u,i,l,h){var e,s,a,f=l.world,v=u.buckets,P,I,M=!1;for(e=0;e<i.length;e++){var d=i[e];if(!(d.isSleeping&&!h)&&!(f.bounds&&(d.bounds.max.x<f.bounds.min.x||d.bounds.min.x>f.bounds.max.x||d.bounds.max.y<f.bounds.min.y||d.bounds.min.y>f.bounds.max.y))){var p=t._getRegion(u,d);if(!d.region||p.id!==d.region.id||h){(!d.region||h)&&(d.region=p);var S=t._regionUnion(p,d.region);for(s=S.startCol;s<=S.endCol;s++)for(a=S.startRow;a<=S.endRow;a++){I=t._getBucketId(s,a),P=v[I];var x=s>=p.startCol&&s<=p.endCol&&a>=p.startRow&&a<=p.endRow,C=s>=d.region.startCol&&s<=d.region.endCol&&a>=d.region.startRow&&a<=d.region.endRow;!x&&C&&C&&P&&t._bucketRemoveBody(u,P,d),(d.region===p||x&&!C||h)&&(P||(P=t._createBucket(v,I)),t._bucketAddBody(u,P,d))}d.region=p,M=!0}}}M&&(u.pairsList=t._createActivePairsList(u))},n(t,"update","Grid.update âž¤ replaced by Matter.Detector"),t.clear=function(u){u.buckets={},u.pairs={},u.pairsList=[]},n(t,"clear","Grid.clear âž¤ replaced by Matter.Detector"),t._regionUnion=function(u,i){var l=Math.min(u.startCol,i.startCol),h=Math.max(u.endCol,i.endCol),e=Math.min(u.startRow,i.startRow),s=Math.max(u.endRow,i.endRow);return t._createRegion(l,h,e,s)},t._getRegion=function(u,i){var l=i.bounds,h=Math.floor(l.min.x/u.bucketWidth),e=Math.floor(l.max.x/u.bucketWidth),s=Math.floor(l.min.y/u.bucketHeight),a=Math.floor(l.max.y/u.bucketHeight);return t._createRegion(h,e,s,a)},t._createRegion=function(u,i,l,h){return{id:u+","+i+","+l+","+h,startCol:u,endCol:i,startRow:l,endRow:h}},t._getBucketId=function(u,i){return"C"+u+"R"+i},t._createBucket=function(u,i){var l=u[i]=[];return l},t._bucketAddBody=function(u,i,l){var h=u.pairs,e=r.id,s=i.length,a;for(a=0;a<s;a++){var f=i[a];if(!(l.id===f.id||l.isStatic&&f.isStatic)){var v=e(l,f),P=h[v];P?P[2]+=1:h[v]=[l,f,1]}}i.push(l)},t._bucketRemoveBody=function(u,i,l){var h=u.pairs,e=r.id,s;i.splice(o.indexOf(i,l),1);var a=i.length;for(s=0;s<a;s++){var f=h[e(l,i[s])];f&&(f[2]-=1)}},t._createActivePairsList=function(u){var i,l=u.pairs,h=o.keys(l),e=h.length,s=[],a;for(a=0;a<e;a++)i=l[h[a]],i[2]>0?s.push(i):delete l[h[a]];return s}})()}),(function(g,y,c){var t={};g.exports=t;var r=c(3),o=c(7),n=c(14),u=c(5),i=c(13),l=c(10),h=c(6),e=c(0),s=c(1);(function(){t.create=function(a,f){var v=(a?a.mouse:null)||(f?f.mouse:null);v||(a&&a.render&&a.render.canvas?v=n.create(a.render.canvas):f&&f.element?v=n.create(f.element):(v=n.create(),e.warn("MouseConstraint.create: options.mouse was undefined, options.element was undefined, may not function as expected")));var P=l.create({label:"Mouse Constraint",pointA:v.position,pointB:{x:0,y:0},length:.01,stiffness:.1,angularStiffness:1,render:{strokeStyle:"#90EE90",lineWidth:3}}),I={type:"mouseConstraint",mouse:v,element:null,body:null,constraint:P,collisionFilter:{category:1,mask:4294967295,group:0}},M=e.extend(I,f);return u.on(a,"beforeUpdate",function(){var d=h.allBodies(a.world);t.update(M,d),t._triggerEvents(M)}),M},t.update=function(a,f){var v=a.mouse,P=a.constraint,I=a.body;if(v.button===0){if(P.bodyB)o.set(P.bodyB,!1),P.pointA=v.position;else for(var M=0;M<f.length;M++)if(I=f[M],s.contains(I.bounds,v.position)&&i.canCollide(I.collisionFilter,a.collisionFilter))for(var d=I.parts.length>1?1:0;d<I.parts.length;d++){var p=I.parts[d];if(r.contains(p.vertices,v.position)){P.pointA=v.position,P.bodyB=a.body=I,P.pointB={x:v.position.x-I.position.x,y:v.position.y-I.position.y},P.angleB=I.angle,o.set(I,!1),u.trigger(a,"startdrag",{mouse:v,body:I});break}}}else P.bodyB=a.body=null,P.pointB=null,I&&u.trigger(a,"enddrag",{mouse:v,body:I})},t._triggerEvents=function(a){var f=a.mouse,v=f.sourceEvents;v.mousemove&&u.trigger(a,"mousemove",{mouse:f}),v.mousedown&&u.trigger(a,"mousedown",{mouse:f}),v.mouseup&&u.trigger(a,"mouseup",{mouse:f}),n.clearSourceEvents(f)}})()}),(function(g,y,c){var t={};g.exports=t;var r=c(2),o=c(8),n=c(1),u=c(12),i=c(3);(function(){t.collides=function(l,h){for(var e=[],s=h.length,a=l.bounds,f=o.collides,v=n.overlaps,P=0;P<s;P++){var I=h[P],M=I.parts.length,d=M===1?0:1;if(v(I.bounds,a))for(var p=d;p<M;p++){var S=I.parts[p];if(v(S.bounds,a)){var x=f(S,l);if(x){e.push(x);break}}}}return e},t.ray=function(l,h,e,s){s=s||1e-100;for(var a=r.angle(h,e),f=r.magnitude(r.sub(h,e)),v=(e.x+h.x)*.5,P=(e.y+h.y)*.5,I=u.rectangle(v,P,f,s,{angle:a}),M=t.collides(I,l),d=0;d<M.length;d+=1){var p=M[d];p.body=p.bodyB=p.bodyA}return M},t.region=function(l,h,e){for(var s=[],a=0;a<l.length;a++){var f=l[a],v=n.overlaps(f.bounds,h);(v&&!e||!v&&e)&&s.push(f)}return s},t.point=function(l,h){for(var e=[],s=0;s<l.length;s++){var a=l[s];if(n.contains(a.bounds,h))for(var f=a.parts.length===1?0:1;f<a.parts.length;f++){var v=a.parts[f];if(n.contains(v.bounds,h)&&i.contains(v.vertices,h)){e.push(a);break}}}return e}})()}),(function(g,y,c){var t={};g.exports=t;var r=c(4),o=c(0),n=c(6),u=c(1),i=c(5),l=c(2),h=c(14);(function(){var e,s;typeof window<"u"&&(e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(d){window.setTimeout(function(){d(o.now())},1e3/60)},s=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),t._goodFps=30,t._goodDelta=1e3/60,t.create=function(d){var p={engine:null,element:null,canvas:null,mouse:null,frameRequestId:null,timing:{historySize:60,delta:0,deltaHistory:[],lastTime:0,lastTimestamp:0,lastElapsed:0,timestampElapsed:0,timestampElapsedHistory:[],engineDeltaHistory:[],engineElapsedHistory:[],engineUpdatesHistory:[],elapsedHistory:[]},options:{width:800,height:600,pixelRatio:1,background:"#14151f",wireframeBackground:"#14151f",wireframeStrokeStyle:"#bbb",hasBounds:!!d.bounds,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showStats:!1,showPerformance:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1}},S=o.extend(p,d);return S.canvas&&(S.canvas.width=S.options.width||S.canvas.width,S.canvas.height=S.options.height||S.canvas.height),S.mouse=d.mouse,S.engine=d.engine,S.canvas=S.canvas||v(S.options.width,S.options.height),S.context=S.canvas.getContext("2d"),S.textures={},S.bounds=S.bounds||{min:{x:0,y:0},max:{x:S.canvas.width,y:S.canvas.height}},S.controller=t,S.options.showBroadphase=!1,S.options.pixelRatio!==1&&t.setPixelRatio(S,S.options.pixelRatio),o.isElement(S.element)&&S.element.appendChild(S.canvas),S},t.run=function(d){(function p(S){d.frameRequestId=e(p),a(d,S),t.world(d,S),d.context.setTransform(d.options.pixelRatio,0,0,d.options.pixelRatio,0,0),(d.options.showStats||d.options.showDebug)&&t.stats(d,d.context,S),(d.options.showPerformance||d.options.showDebug)&&t.performance(d,d.context,S),d.context.setTransform(1,0,0,1,0,0)})()},t.stop=function(d){s(d.frameRequestId)},t.setPixelRatio=function(d,p){var S=d.options,x=d.canvas;p==="auto"&&(p=P(x)),S.pixelRatio=p,x.setAttribute("data-pixel-ratio",p),x.width=S.width*p,x.height=S.height*p,x.style.width=S.width+"px",x.style.height=S.height+"px"},t.setSize=function(d,p,S){d.options.width=p,d.options.height=S,d.bounds.max.x=d.bounds.min.x+p,d.bounds.max.y=d.bounds.min.y+S,d.options.pixelRatio!==1?t.setPixelRatio(d,d.options.pixelRatio):(d.canvas.width=p,d.canvas.height=S)},t.lookAt=function(d,p,S,x){x=typeof x<"u"?x:!0,p=o.isArray(p)?p:[p],S=S||{x:0,y:0};for(var C={min:{x:1/0,y:1/0},max:{x:-1/0,y:-1/0}},w=0;w<p.length;w+=1){var A=p[w],B=A.bounds?A.bounds.min:A.min||A.position||A,b=A.bounds?A.bounds.max:A.max||A.position||A;B&&b&&(B.x<C.min.x&&(C.min.x=B.x),b.x>C.max.x&&(C.max.x=b.x),B.y<C.min.y&&(C.min.y=B.y),b.y>C.max.y&&(C.max.y=b.y))}var D=C.max.x-C.min.x+2*S.x,k=C.max.y-C.min.y+2*S.y,L=d.canvas.height,T=d.canvas.width,E=T/L,R=D/k,F=1,O=1;R>E?O=R/E:F=E/R,d.options.hasBounds=!0,d.bounds.min.x=C.min.x,d.bounds.max.x=C.min.x+D*F,d.bounds.min.y=C.min.y,d.bounds.max.y=C.min.y+k*O,x&&(d.bounds.min.x+=D*.5-D*F*.5,d.bounds.max.x+=D*.5-D*F*.5,d.bounds.min.y+=k*.5-k*O*.5,d.bounds.max.y+=k*.5-k*O*.5),d.bounds.min.x-=S.x,d.bounds.max.x-=S.x,d.bounds.min.y-=S.y,d.bounds.max.y-=S.y,d.mouse&&(h.setScale(d.mouse,{x:(d.bounds.max.x-d.bounds.min.x)/d.canvas.width,y:(d.bounds.max.y-d.bounds.min.y)/d.canvas.height}),h.setOffset(d.mouse,d.bounds.min))},t.startViewTransform=function(d){var p=d.bounds.max.x-d.bounds.min.x,S=d.bounds.max.y-d.bounds.min.y,x=p/d.options.width,C=S/d.options.height;d.context.setTransform(d.options.pixelRatio/x,0,0,d.options.pixelRatio/C,0,0),d.context.translate(-d.bounds.min.x,-d.bounds.min.y)},t.endViewTransform=function(d){d.context.setTransform(d.options.pixelRatio,0,0,d.options.pixelRatio,0,0)},t.world=function(d,p){var S=o.now(),x=d.engine,C=x.world,w=d.canvas,A=d.context,B=d.options,b=d.timing,D=n.allBodies(C),k=n.allConstraints(C),L=B.wireframes?B.wireframeBackground:B.background,T=[],E=[],R,F={timestamp:x.timing.timestamp};if(i.trigger(d,"beforeRender",F),d.currentBackground!==L&&M(d,L),A.globalCompositeOperation="source-in",A.fillStyle="transparent",A.fillRect(0,0,w.width,w.height),A.globalCompositeOperation="source-over",B.hasBounds){for(R=0;R<D.length;R++){var O=D[R];u.overlaps(O.bounds,d.bounds)&&T.push(O)}for(R=0;R<k.length;R++){var G=k[R],N=G.bodyA,$=G.bodyB,Y=G.pointA,X=G.pointB;N&&(Y=l.add(N.position,G.pointA)),$&&(X=l.add($.position,G.pointB)),!(!Y||!X)&&(u.contains(d.bounds,Y)||u.contains(d.bounds,X))&&E.push(G)}t.startViewTransform(d),d.mouse&&(h.setScale(d.mouse,{x:(d.bounds.max.x-d.bounds.min.x)/d.options.width,y:(d.bounds.max.y-d.bounds.min.y)/d.options.height}),h.setOffset(d.mouse,d.bounds.min))}else E=k,T=D,d.options.pixelRatio!==1&&d.context.setTransform(d.options.pixelRatio,0,0,d.options.pixelRatio,0,0);!B.wireframes||x.enableSleeping&&B.showSleeping?t.bodies(d,T,A):(B.showConvexHulls&&t.bodyConvexHulls(d,T,A),t.bodyWireframes(d,T,A)),B.showBounds&&t.bodyBounds(d,T,A),(B.showAxes||B.showAngleIndicator)&&t.bodyAxes(d,T,A),B.showPositions&&t.bodyPositions(d,T,A),B.showVelocity&&t.bodyVelocity(d,T,A),B.showIds&&t.bodyIds(d,T,A),B.showSeparations&&t.separations(d,x.pairs.list,A),B.showCollisions&&t.collisions(d,x.pairs.list,A),B.showVertexNumbers&&t.vertexNumbers(d,T,A),B.showMousePosition&&t.mousePosition(d,d.mouse,A),t.constraints(E,A),B.hasBounds&&t.endViewTransform(d),i.trigger(d,"afterRender",F),b.lastElapsed=o.now()-S},t.stats=function(d,p,S){for(var x=d.engine,C=x.world,w=n.allBodies(C),A=0,B=55,b=44,D=0,k=0,L=0;L<w.length;L+=1)A+=w[L].parts.length;var T={Part:A,Body:w.length,Cons:n.allConstraints(C).length,Comp:n.allComposites(C).length,Pair:x.pairs.list.length};p.fillStyle="#0e0f19",p.fillRect(D,k,B*5.5,b),p.font="12px Arial",p.textBaseline="top",p.textAlign="right";for(var E in T){var R=T[E];p.fillStyle="#aaa",p.fillText(E,D+B,k+8),p.fillStyle="#eee",p.fillText(R,D+B,k+26),D+=B}},t.performance=function(d,p){var S=d.engine,x=d.timing,C=x.deltaHistory,w=x.elapsedHistory,A=x.timestampElapsedHistory,B=x.engineDeltaHistory,b=x.engineUpdatesHistory,D=x.engineElapsedHistory,k=S.timing.lastUpdatesPerFrame,L=S.timing.lastDelta,T=f(C),E=f(w),R=f(B),F=f(b),O=f(D),G=f(A),N=G/T||0,$=Math.round(T/L),Y=1e3/T||0,X=4,q=12,Z=60,et=34,K=10,j=69;p.fillStyle="#0e0f19",p.fillRect(0,50,q*5+Z*6+22,et),t.status(p,K,j,Z,X,C.length,Math.round(Y)+" fps",Y/t._goodFps,function(Q){return C[Q]/T-1}),t.status(p,K+q+Z,j,Z,X,B.length,L.toFixed(2)+" dt",t._goodDelta/L,function(Q){return B[Q]/R-1}),t.status(p,K+(q+Z)*2,j,Z,X,b.length,k+" upf",Math.pow(o.clamp(F/$||1,0,1),4),function(Q){return b[Q]/F-1}),t.status(p,K+(q+Z)*3,j,Z,X,D.length,O.toFixed(2)+" ut",1-k*O/t._goodFps,function(Q){return D[Q]/O-1}),t.status(p,K+(q+Z)*4,j,Z,X,w.length,E.toFixed(2)+" rt",1-E/t._goodFps,function(Q){return w[Q]/E-1}),t.status(p,K+(q+Z)*5,j,Z,X,A.length,N.toFixed(2)+" x",N*N*N,function(Q){return(A[Q]/C[Q]/N||0)-1})},t.status=function(d,p,S,x,C,w,A,B,b){d.strokeStyle="#888",d.fillStyle="#444",d.lineWidth=1,d.fillRect(p,S+7,x,1),d.beginPath(),d.moveTo(p,S+7-C*o.clamp(.4*b(0),-2,2));for(var D=0;D<x;D+=1)d.lineTo(p+D,S+7-(D<w?C*o.clamp(.4*b(D),-2,2):0));d.stroke(),d.fillStyle="hsl("+o.clamp(25+95*B,0,120)+",100%,60%)",d.fillRect(p,S-7,4,4),d.font="12px Arial",d.textBaseline="middle",d.textAlign="right",d.fillStyle="#eee",d.fillText(A,p+x,S-5)},t.constraints=function(d,p){for(var S=p,x=0;x<d.length;x++){var C=d[x];if(!(!C.render.visible||!C.pointA||!C.pointB)){var w=C.bodyA,A=C.bodyB,B,b;if(w?B=l.add(w.position,C.pointA):B=C.pointA,C.render.type==="pin")S.beginPath(),S.arc(B.x,B.y,3,0,2*Math.PI),S.closePath();else{if(A?b=l.add(A.position,C.pointB):b=C.pointB,S.beginPath(),S.moveTo(B.x,B.y),C.render.type==="spring")for(var D=l.sub(b,B),k=l.perp(l.normalise(D)),L=Math.ceil(o.clamp(C.length/5,12,20)),T,E=1;E<L;E+=1)T=E%2===0?1:-1,S.lineTo(B.x+D.x*(E/L)+k.x*T*4,B.y+D.y*(E/L)+k.y*T*4);S.lineTo(b.x,b.y)}C.render.lineWidth&&(S.lineWidth=C.render.lineWidth,S.strokeStyle=C.render.strokeStyle,S.stroke()),C.render.anchors&&(S.fillStyle=C.render.strokeStyle,S.beginPath(),S.arc(B.x,B.y,3,0,2*Math.PI),S.arc(b.x,b.y,3,0,2*Math.PI),S.closePath(),S.fill())}}},t.bodies=function(d,p,S){var x=S;d.engine;var C=d.options,w=C.showInternalEdges||!C.wireframes,A,B,b,D;for(b=0;b<p.length;b++)if(A=p[b],!!A.render.visible){for(D=A.parts.length>1?1:0;D<A.parts.length;D++)if(B=A.parts[D],!!B.render.visible){if(C.showSleeping&&A.isSleeping?x.globalAlpha=.5*B.render.opacity:B.render.opacity!==1&&(x.globalAlpha=B.render.opacity),B.render.sprite&&B.render.sprite.texture&&!C.wireframes){var k=B.render.sprite,L=I(d,k.texture);x.translate(B.position.x,B.position.y),x.rotate(B.angle),x.drawImage(L,L.width*-k.xOffset*k.xScale,L.height*-k.yOffset*k.yScale,L.width*k.xScale,L.height*k.yScale),x.rotate(-B.angle),x.translate(-B.position.x,-B.position.y)}else{if(B.circleRadius)x.beginPath(),x.arc(B.position.x,B.position.y,B.circleRadius,0,2*Math.PI);else{x.beginPath(),x.moveTo(B.vertices[0].x,B.vertices[0].y);for(var T=1;T<B.vertices.length;T++)!B.vertices[T-1].isInternal||w?x.lineTo(B.vertices[T].x,B.vertices[T].y):x.moveTo(B.vertices[T].x,B.vertices[T].y),B.vertices[T].isInternal&&!w&&x.moveTo(B.vertices[(T+1)%B.vertices.length].x,B.vertices[(T+1)%B.vertices.length].y);x.lineTo(B.vertices[0].x,B.vertices[0].y),x.closePath()}C.wireframes?(x.lineWidth=1,x.strokeStyle=d.options.wireframeStrokeStyle,x.stroke()):(x.fillStyle=B.render.fillStyle,B.render.lineWidth&&(x.lineWidth=B.render.lineWidth,x.strokeStyle=B.render.strokeStyle,x.stroke()),x.fill())}x.globalAlpha=1}}},t.bodyWireframes=function(d,p,S){var x=S,C=d.options.showInternalEdges,w,A,B,b,D;for(x.beginPath(),B=0;B<p.length;B++)if(w=p[B],!!w.render.visible)for(D=w.parts.length>1?1:0;D<w.parts.length;D++){for(A=w.parts[D],x.moveTo(A.vertices[0].x,A.vertices[0].y),b=1;b<A.vertices.length;b++)!A.vertices[b-1].isInternal||C?x.lineTo(A.vertices[b].x,A.vertices[b].y):x.moveTo(A.vertices[b].x,A.vertices[b].y),A.vertices[b].isInternal&&!C&&x.moveTo(A.vertices[(b+1)%A.vertices.length].x,A.vertices[(b+1)%A.vertices.length].y);x.lineTo(A.vertices[0].x,A.vertices[0].y)}x.lineWidth=1,x.strokeStyle=d.options.wireframeStrokeStyle,x.stroke()},t.bodyConvexHulls=function(d,p,S){var x=S,C,w,A;for(x.beginPath(),w=0;w<p.length;w++)if(C=p[w],!(!C.render.visible||C.parts.length===1)){for(x.moveTo(C.vertices[0].x,C.vertices[0].y),A=1;A<C.vertices.length;A++)x.lineTo(C.vertices[A].x,C.vertices[A].y);x.lineTo(C.vertices[0].x,C.vertices[0].y)}x.lineWidth=1,x.strokeStyle="rgba(255,255,255,0.2)",x.stroke()},t.vertexNumbers=function(d,p,S){var x=S,C,w,A;for(C=0;C<p.length;C++){var B=p[C].parts;for(A=B.length>1?1:0;A<B.length;A++){var b=B[A];for(w=0;w<b.vertices.length;w++)x.fillStyle="rgba(255,255,255,0.2)",x.fillText(C+"_"+w,b.position.x+(b.vertices[w].x-b.position.x)*.8,b.position.y+(b.vertices[w].y-b.position.y)*.8)}}},t.mousePosition=function(d,p,S){var x=S;x.fillStyle="rgba(255,255,255,0.8)",x.fillText(p.position.x+"  "+p.position.y,p.position.x+5,p.position.y-5)},t.bodyBounds=function(d,p,S){var x=S;d.engine;var C=d.options;x.beginPath();for(var w=0;w<p.length;w++){var A=p[w];if(A.render.visible)for(var B=p[w].parts,b=B.length>1?1:0;b<B.length;b++){var D=B[b];x.rect(D.bounds.min.x,D.bounds.min.y,D.bounds.max.x-D.bounds.min.x,D.bounds.max.y-D.bounds.min.y)}}C.wireframes?x.strokeStyle="rgba(255,255,255,0.08)":x.strokeStyle="rgba(0,0,0,0.1)",x.lineWidth=1,x.stroke()},t.bodyAxes=function(d,p,S){var x=S;d.engine;var C=d.options,w,A,B,b;for(x.beginPath(),A=0;A<p.length;A++){var D=p[A],k=D.parts;if(D.render.visible)if(C.showAxes)for(B=k.length>1?1:0;B<k.length;B++)for(w=k[B],b=0;b<w.axes.length;b++){var L=w.axes[b];x.moveTo(w.position.x,w.position.y),x.lineTo(w.position.x+L.x*20,w.position.y+L.y*20)}else for(B=k.length>1?1:0;B<k.length;B++)for(w=k[B],b=0;b<w.axes.length;b++)x.moveTo(w.position.x,w.position.y),x.lineTo((w.vertices[0].x+w.vertices[w.vertices.length-1].x)/2,(w.vertices[0].y+w.vertices[w.vertices.length-1].y)/2)}C.wireframes?(x.strokeStyle="indianred",x.lineWidth=1):(x.strokeStyle="rgba(255, 255, 255, 0.4)",x.globalCompositeOperation="overlay",x.lineWidth=2),x.stroke(),x.globalCompositeOperation="source-over"},t.bodyPositions=function(d,p,S){var x=S;d.engine;var C=d.options,w,A,B,b;for(x.beginPath(),B=0;B<p.length;B++)if(w=p[B],!!w.render.visible)for(b=0;b<w.parts.length;b++)A=w.parts[b],x.arc(A.position.x,A.position.y,3,0,2*Math.PI,!1),x.closePath();for(C.wireframes?x.fillStyle="indianred":x.fillStyle="rgba(0,0,0,0.5)",x.fill(),x.beginPath(),B=0;B<p.length;B++)w=p[B],w.render.visible&&(x.arc(w.positionPrev.x,w.positionPrev.y,2,0,2*Math.PI,!1),x.closePath());x.fillStyle="rgba(255,165,0,0.8)",x.fill()},t.bodyVelocity=function(d,p,S){var x=S;x.beginPath();for(var C=0;C<p.length;C++){var w=p[C];if(w.render.visible){var A=r.getVelocity(w);x.moveTo(w.position.x,w.position.y),x.lineTo(w.position.x+A.x,w.position.y+A.y)}}x.lineWidth=3,x.strokeStyle="cornflowerblue",x.stroke()},t.bodyIds=function(d,p,S){var x=S,C,w;for(C=0;C<p.length;C++)if(p[C].render.visible){var A=p[C].parts;for(w=A.length>1?1:0;w<A.length;w++){var B=A[w];x.font="12px Arial",x.fillStyle="rgba(255,255,255,0.5)",x.fillText(B.id,B.position.x+10,B.position.y-10)}}},t.collisions=function(d,p,S){var x=S,C=d.options,w,A,B,b;for(x.beginPath(),B=0;B<p.length;B++)if(w=p[B],!!w.isActive)for(A=w.collision,b=0;b<w.contactCount;b++){var D=w.contacts[b],k=D.vertex;x.rect(k.x-1.5,k.y-1.5,3.5,3.5)}for(C.wireframes?x.fillStyle="rgba(255,255,255,0.7)":x.fillStyle="orange",x.fill(),x.beginPath(),B=0;B<p.length;B++)if(w=p[B],!!w.isActive&&(A=w.collision,w.contactCount>0)){var L=w.contacts[0].vertex.x,T=w.contacts[0].vertex.y;w.contactCount===2&&(L=(w.contacts[0].vertex.x+w.contacts[1].vertex.x)/2,T=(w.contacts[0].vertex.y+w.contacts[1].vertex.y)/2),A.bodyB===A.supports[0].body||A.bodyA.isStatic===!0?x.moveTo(L-A.normal.x*8,T-A.normal.y*8):x.moveTo(L+A.normal.x*8,T+A.normal.y*8),x.lineTo(L,T)}C.wireframes?x.strokeStyle="rgba(255,165,0,0.7)":x.strokeStyle="orange",x.lineWidth=1,x.stroke()},t.separations=function(d,p,S){var x=S,C=d.options,w,A,B,b,D;for(x.beginPath(),D=0;D<p.length;D++)if(w=p[D],!!w.isActive){A=w.collision,B=A.bodyA,b=A.bodyB;var k=1;!b.isStatic&&!B.isStatic&&(k=.5),b.isStatic&&(k=0),x.moveTo(b.position.x,b.position.y),x.lineTo(b.position.x-A.penetration.x*k,b.position.y-A.penetration.y*k),k=1,!b.isStatic&&!B.isStatic&&(k=.5),B.isStatic&&(k=0),x.moveTo(B.position.x,B.position.y),x.lineTo(B.position.x+A.penetration.x*k,B.position.y+A.penetration.y*k)}C.wireframes?x.strokeStyle="rgba(255,165,0,0.5)":x.strokeStyle="orange",x.stroke()},t.inspector=function(d,p){d.engine;var S=d.selected,x=d.render,C=x.options,w;if(C.hasBounds){var A=x.bounds.max.x-x.bounds.min.x,B=x.bounds.max.y-x.bounds.min.y,b=A/x.options.width,D=B/x.options.height;p.scale(1/b,1/D),p.translate(-x.bounds.min.x,-x.bounds.min.y)}for(var k=0;k<S.length;k++){var L=S[k].data;switch(p.translate(.5,.5),p.lineWidth=1,p.strokeStyle="rgba(255,165,0,0.9)",p.setLineDash([1,2]),L.type){case"body":w=L.bounds,p.beginPath(),p.rect(Math.floor(w.min.x-3),Math.floor(w.min.y-3),Math.floor(w.max.x-w.min.x+6),Math.floor(w.max.y-w.min.y+6)),p.closePath(),p.stroke();break;case"constraint":var T=L.pointA;L.bodyA&&(T=L.pointB),p.beginPath(),p.arc(T.x,T.y,10,0,2*Math.PI),p.closePath(),p.stroke();break}p.setLineDash([]),p.translate(-.5,-.5)}d.selectStart!==null&&(p.translate(.5,.5),p.lineWidth=1,p.strokeStyle="rgba(255,165,0,0.6)",p.fillStyle="rgba(255,165,0,0.1)",w=d.selectBounds,p.beginPath(),p.rect(Math.floor(w.min.x),Math.floor(w.min.y),Math.floor(w.max.x-w.min.x),Math.floor(w.max.y-w.min.y)),p.closePath(),p.stroke(),p.fill(),p.translate(-.5,-.5)),C.hasBounds&&p.setTransform(1,0,0,1,0,0)};var a=function(d,p){var S=d.engine,x=d.timing,C=x.historySize,w=S.timing.timestamp;x.delta=p-x.lastTime||t._goodDelta,x.lastTime=p,x.timestampElapsed=w-x.lastTimestamp||0,x.lastTimestamp=w,x.deltaHistory.unshift(x.delta),x.deltaHistory.length=Math.min(x.deltaHistory.length,C),x.engineDeltaHistory.unshift(S.timing.lastDelta),x.engineDeltaHistory.length=Math.min(x.engineDeltaHistory.length,C),x.timestampElapsedHistory.unshift(x.timestampElapsed),x.timestampElapsedHistory.length=Math.min(x.timestampElapsedHistory.length,C),x.engineUpdatesHistory.unshift(S.timing.lastUpdatesPerFrame),x.engineUpdatesHistory.length=Math.min(x.engineUpdatesHistory.length,C),x.engineElapsedHistory.unshift(S.timing.lastElapsed),x.engineElapsedHistory.length=Math.min(x.engineElapsedHistory.length,C),x.elapsedHistory.unshift(x.lastElapsed),x.elapsedHistory.length=Math.min(x.elapsedHistory.length,C)},f=function(d){for(var p=0,S=0;S<d.length;S+=1)p+=d[S];return p/d.length||0},v=function(d,p){var S=document.createElement("canvas");return S.width=d,S.height=p,S.oncontextmenu=function(){return!1},S.onselectstart=function(){return!1},S},P=function(d){var p=d.getContext("2d"),S=window.devicePixelRatio||1,x=p.webkitBackingStorePixelRatio||p.mozBackingStorePixelRatio||p.msBackingStorePixelRatio||p.oBackingStorePixelRatio||p.backingStorePixelRatio||1;return S/x},I=function(d,p){var S=d.textures[p];return S||(S=d.textures[p]=new Image,S.src=p,S)},M=function(d,p){var S=p;/(jpg|gif|png)$/.test(p)&&(S="url("+p+")"),d.canvas.style.background=S,d.canvas.style.backgroundSize="contain",d.currentBackground=p}})()}),(function(g,y,c){var t={};g.exports=t;var r=c(5),o=c(17),n=c(0);(function(){t._maxFrameDelta=1e3/15,t._frameDeltaFallback=1e3/60,t._timeBufferMargin=1.5,t._elapsedNextEstimate=1,t._smoothingLowerBound=.1,t._smoothingUpperBound=.9,t.create=function(i){var l={delta:16.666666666666668,frameDelta:null,frameDeltaSmoothing:!0,frameDeltaSnapping:!0,frameDeltaHistory:[],frameDeltaHistorySize:100,frameRequestId:null,timeBuffer:0,timeLastTick:null,maxUpdates:null,maxFrameTime:33.333333333333336,lastUpdatesDeferred:0,enabled:!0},h=n.extend(l,i);return h.fps=0,h},t.run=function(i,l){return i.timeBuffer=t._frameDeltaFallback,(function h(e){i.frameRequestId=t._onNextFrame(i,h),e&&i.enabled&&t.tick(i,l,e)})(),i},t.tick=function(i,l,h){var e=n.now(),s=i.delta,a=0,f=h-i.timeLastTick;if((!f||!i.timeLastTick||f>Math.max(t._maxFrameDelta,i.maxFrameTime))&&(f=i.frameDelta||t._frameDeltaFallback),i.frameDeltaSmoothing){i.frameDeltaHistory.push(f),i.frameDeltaHistory=i.frameDeltaHistory.slice(-i.frameDeltaHistorySize);var v=i.frameDeltaHistory.slice(0).sort(),P=i.frameDeltaHistory.slice(v.length*t._smoothingLowerBound,v.length*t._smoothingUpperBound),I=u(P);f=I||f}i.frameDeltaSnapping&&(f=1e3/Math.round(1e3/f)),i.frameDelta=f,i.timeLastTick=h,i.timeBuffer+=i.frameDelta,i.timeBuffer=n.clamp(i.timeBuffer,0,i.frameDelta+s*t._timeBufferMargin),i.lastUpdatesDeferred=0;var M=i.maxUpdates||Math.ceil(i.maxFrameTime/s),d={timestamp:l.timing.timestamp};r.trigger(i,"beforeTick",d),r.trigger(i,"tick",d);for(var p=n.now();s>0&&i.timeBuffer>=s*t._timeBufferMargin;){r.trigger(i,"beforeUpdate",d),o.update(l,s),r.trigger(i,"afterUpdate",d),i.timeBuffer-=s,a+=1;var S=n.now()-e,x=n.now()-p,C=S+t._elapsedNextEstimate*x/a;if(a>=M||C>i.maxFrameTime){i.lastUpdatesDeferred=Math.round(Math.max(0,i.timeBuffer/s-t._timeBufferMargin));break}}l.timing.lastUpdatesPerFrame=a,r.trigger(i,"afterTick",d),i.frameDeltaHistory.length>=100&&(i.lastUpdatesDeferred&&Math.round(i.frameDelta/s)>M?n.warnOnce("Matter.Runner: runner reached runner.maxUpdates, see docs."):i.lastUpdatesDeferred&&n.warnOnce("Matter.Runner: runner reached runner.maxFrameTime, see docs."),typeof i.isFixed<"u"&&n.warnOnce("Matter.Runner: runner.isFixed is now redundant, see docs."),(i.deltaMin||i.deltaMax)&&n.warnOnce("Matter.Runner: runner.deltaMin and runner.deltaMax were removed, see docs."),i.fps!==0&&n.warnOnce("Matter.Runner: runner.fps was replaced by runner.delta, see docs."))},t.stop=function(i){t._cancelNextFrame(i)},t._onNextFrame=function(i,l){if(typeof window<"u"&&window.requestAnimationFrame)i.frameRequestId=window.requestAnimationFrame(l);else throw new Error("Matter.Runner: missing required global window.requestAnimationFrame.");return i.frameRequestId},t._cancelNextFrame=function(i){if(typeof window<"u"&&window.cancelAnimationFrame)window.cancelAnimationFrame(i.frameRequestId);else throw new Error("Matter.Runner: missing required global window.cancelAnimationFrame.")};var u=function(i){for(var l=0,h=i.length,e=0;e<h;e+=1)l+=i[e];return l/h||0}})()}),(function(g,y,c){var t={};g.exports=t;var r=c(8),o=c(0),n=o.deprecated;(function(){t.collides=function(u,i){return r.collides(u,i)},n(t,"collides","SAT.collides âž¤ replaced by Collision.collides")})()}),(function(g,y,c){var t={};g.exports=t,c(1);var r=c(0);(function(){t.pathToVertices=function(o,n){typeof window<"u"&&!("SVGPathSeg"in window)&&r.warn("Svg.pathToVertices: SVGPathSeg not defined, a polyfill is required.");var u,i,l,h,e,s,a,f,v,P,I=[],M,d,p=0,S=0,x=0;n=n||15;var C=function(A,B,b){var D=b%2===1&&b>1;if(!v||A!=v.x||B!=v.y){v&&D?(M=v.x,d=v.y):(M=0,d=0);var k={x:M+A,y:d+B};(D||!v)&&(v=k),I.push(k),S=M+A,x=d+B}},w=function(A){var B=A.pathSegTypeAsLetter.toUpperCase();if(B!=="Z"){switch(B){case"M":case"L":case"T":case"C":case"S":case"Q":S=A.x,x=A.y;break;case"H":S=A.x;break;case"V":x=A.y;break}C(S,x,A.pathSegType)}};for(t._svgPathToAbsolute(o),l=o.getTotalLength(),s=[],u=0;u<o.pathSegList.numberOfItems;u+=1)s.push(o.pathSegList.getItem(u));for(a=s.concat();p<l;){if(P=o.getPathSegAtLength(p),e=s[P],e!=f){for(;a.length&&a[0]!=e;)w(a.shift());f=e}switch(e.pathSegTypeAsLetter.toUpperCase()){case"C":case"T":case"S":case"Q":case"A":h=o.getPointAtLength(p),C(h.x,h.y,0);break}p+=n}for(u=0,i=a.length;u<i;++u)w(a[u]);return I},t._svgPathToAbsolute=function(o){for(var n,u,i,l,h,e,s=o.pathSegList,a=0,f=0,v=s.numberOfItems,P=0;P<v;++P){var I=s.getItem(P),M=I.pathSegTypeAsLetter;if(/[MLHVCSQTA]/.test(M))"x"in I&&(a=I.x),"y"in I&&(f=I.y);else switch("x1"in I&&(i=a+I.x1),"x2"in I&&(h=a+I.x2),"y1"in I&&(l=f+I.y1),"y2"in I&&(e=f+I.y2),"x"in I&&(a+=I.x),"y"in I&&(f+=I.y),M){case"m":s.replaceItem(o.createSVGPathSegMovetoAbs(a,f),P);break;case"l":s.replaceItem(o.createSVGPathSegLinetoAbs(a,f),P);break;case"h":s.replaceItem(o.createSVGPathSegLinetoHorizontalAbs(a),P);break;case"v":s.replaceItem(o.createSVGPathSegLinetoVerticalAbs(f),P);break;case"c":s.replaceItem(o.createSVGPathSegCurvetoCubicAbs(a,f,i,l,h,e),P);break;case"s":s.replaceItem(o.createSVGPathSegCurvetoCubicSmoothAbs(a,f,h,e),P);break;case"q":s.replaceItem(o.createSVGPathSegCurvetoQuadraticAbs(a,f,i,l),P);break;case"t":s.replaceItem(o.createSVGPathSegCurvetoQuadraticSmoothAbs(a,f),P);break;case"a":s.replaceItem(o.createSVGPathSegArcAbs(a,f,I.r1,I.r2,I.angle,I.largeArcFlag,I.sweepFlag),P);break;case"z":case"Z":a=n,f=u;break}(M=="M"||M=="m")&&(n=a,u=f)}}})()}),(function(g,y,c){var t={};g.exports=t;var r=c(6);c(0),(function(){t.create=r.create,t.add=r.add,t.remove=r.remove,t.clear=r.clear,t.addComposite=r.addComposite,t.addBody=r.addBody,t.addConstraint=r.addConstraint})()})])})})(ct)),ct.exports}var Tt=Bt();const U=Pt(Tt);var ft,yt;function Mt(){if(yt)return ft;yt=1,ft={decomp:S,quickDecomp:A,isSimple:C,removeCollinearPoints:B,removeDuplicatePoints:b,makeCCW:s};function z(L,T,E){E=E||0;var R=[0,0],F,O,G,N,$,Y,X;return F=L[1][1]-L[0][1],O=L[0][0]-L[1][0],G=F*L[0][0]+O*L[0][1],N=T[1][1]-T[0][1],$=T[0][0]-T[1][0],Y=N*T[0][0]+$*T[0][1],X=F*$-N*O,D(X,0,E)||(R[0]=($*G-O*Y)/X,R[1]=(F*Y-N*G)/X),R}function m(L,T,E,R){var F=T[0]-L[0],O=T[1]-L[1],G=R[0]-E[0],N=R[1]-E[1];if(G*O-N*F===0)return!1;var $=(F*(E[1]-L[1])+O*(L[0]-E[0]))/(G*O-N*F),Y=(G*(L[1]-E[1])+N*(E[0]-L[0]))/(N*F-G*O);return $>=0&&$<=1&&Y>=0&&Y<=1}function g(L,T,E){return(T[0]-L[0])*(E[1]-L[1])-(E[0]-L[0])*(T[1]-L[1])}function y(L,T,E){return g(L,T,E)>0}function c(L,T,E){return g(L,T,E)>=0}function t(L,T,E){return g(L,T,E)<0}function r(L,T,E){return g(L,T,E)<=0}var o=[],n=[];function u(L,T,E,R){if(R){var F=o,O=n;F[0]=T[0]-L[0],F[1]=T[1]-L[1],O[0]=E[0]-T[0],O[1]=E[1]-T[1];var G=F[0]*O[0]+F[1]*O[1],N=Math.sqrt(F[0]*F[0]+F[1]*F[1]),$=Math.sqrt(O[0]*O[0]+O[1]*O[1]),Y=Math.acos(G/(N*$));return Y<R}else return g(L,T,E)===0}function i(L,T){var E=T[0]-L[0],R=T[1]-L[1];return E*E+R*R}function l(L,T){var E=L.length;return L[T<0?T%E+E:T%E]}function h(L){L.length=0}function e(L,T,E,R){for(var F=E;F<R;F++)L.push(T[F])}function s(L){for(var T=0,E=L,R=1;R<L.length;++R)(E[R][1]<E[T][1]||E[R][1]===E[T][1]&&E[R][0]>E[T][0])&&(T=R);return y(l(L,T-1),l(L,T),l(L,T+1))?!1:(a(L),!0)}function a(L){for(var T=[],E=L.length,R=0;R!==E;R++)T.push(L.pop());for(var R=0;R!==E;R++)L[R]=T[R]}function f(L,T){return t(l(L,T-1),l(L,T),l(L,T+1))}var v=[],P=[];function I(L,T,E){var R,F,O=v,G=P;if(c(l(L,T+1),l(L,T),l(L,E))&&r(l(L,T-1),l(L,T),l(L,E)))return!1;F=i(l(L,T),l(L,E));for(var N=0;N!==L.length;++N)if(!((N+1)%L.length===T||N===T)&&c(l(L,T),l(L,E),l(L,N+1))&&r(l(L,T),l(L,E),l(L,N))&&(O[0]=l(L,T),O[1]=l(L,E),G[0]=l(L,N),G[1]=l(L,N+1),R=z(O,G),i(l(L,T),R)<F))return!1;return!0}function M(L,T,E){for(var R=0;R!==L.length;++R)if(!(R===T||R===E||(R+1)%L.length===T||(R+1)%L.length===E)&&m(l(L,T),l(L,E),l(L,R),l(L,R+1)))return!1;return!0}function d(L,T,E,R){var F=R||[];if(h(F),T<E)for(var O=T;O<=E;O++)F.push(L[O]);else{for(var O=0;O<=E;O++)F.push(L[O]);for(var O=T;O<L.length;O++)F.push(L[O])}return F}function p(L){for(var T=[],E=[],R=[],F=[],O=Number.MAX_VALUE,G=0;G<L.length;++G)if(f(L,G)){for(var N=0;N<L.length;++N)if(I(L,G,N)){E=p(d(L,G,N,F)),R=p(d(L,N,G,F));for(var $=0;$<R.length;$++)E.push(R[$]);E.length<O&&(T=E,O=E.length,T.push([l(L,G),l(L,N)]))}}return T}function S(L){var T=p(L);return T.length>0?x(L,T):[L]}function x(L,T){if(T.length===0)return[L];if(T instanceof Array&&T.length&&T[0]instanceof Array&&T[0].length===2&&T[0][0]instanceof Array){for(var E=[L],R=0;R<T.length;R++)for(var F=T[R],O=0;O<E.length;O++){var G=E[O],N=x(G,F);if(N){E.splice(O,1),E.push(N[0],N[1]);break}}return E}else{var F=T,R=L.indexOf(F[0]),O=L.indexOf(F[1]);return R!==-1&&O!==-1?[d(L,R,O),d(L,O,R)]:!1}}function C(L){var T=L,E;for(E=0;E<T.length-1;E++)for(var R=0;R<E-1;R++)if(m(T[E],T[E+1],T[R],T[R+1]))return!1;for(E=1;E<T.length-2;E++)if(m(T[0],T[T.length-1],T[E],T[E+1]))return!1;return!0}function w(L,T,E,R,F){F=F||0;var O=T[1]-L[1],G=L[0]-T[0],N=O*L[0]+G*L[1],$=R[1]-E[1],Y=E[0]-R[0],X=$*E[0]+Y*E[1],q=O*Y-$*G;return D(q,0,F)?[0,0]:[(Y*N-G*X)/q,(O*X-$*N)/q]}function A(L,T,E,R,F,O,G){O=O||100,G=G||0,F=F||25,T=typeof T<"u"?T:[],E=E||[],R=R||[];var N=[0,0],$=[0,0],Y=[0,0],X=0,q=0,Z=0,et=0,K=0,j=0,Q=0,_=[],tt=[],V=L,nt=L;if(nt.length<3)return T;if(G++,G>O)return console.warn("quickDecomp: max level ("+O+") reached."),T;for(var W=0;W<L.length;++W)if(f(V,W)){E.push(V[W]),X=q=Number.MAX_VALUE;for(var J=0;J<L.length;++J)y(l(V,W-1),l(V,W),l(V,J))&&r(l(V,W-1),l(V,W),l(V,J-1))&&(Y=w(l(V,W-1),l(V,W),l(V,J),l(V,J-1)),t(l(V,W+1),l(V,W),Y)&&(Z=i(V[W],Y),Z<q&&(q=Z,$=Y,j=J))),y(l(V,W+1),l(V,W),l(V,J+1))&&r(l(V,W+1),l(V,W),l(V,J))&&(Y=w(l(V,W+1),l(V,W),l(V,J),l(V,J+1)),y(l(V,W-1),l(V,W),Y)&&(Z=i(V[W],Y),Z<X&&(X=Z,N=Y,K=J)));if(j===(K+1)%L.length)Y[0]=($[0]+N[0])/2,Y[1]=($[1]+N[1])/2,R.push(Y),W<K?(e(_,V,W,K+1),_.push(Y),tt.push(Y),j!==0&&e(tt,V,j,V.length),e(tt,V,0,W+1)):(W!==0&&e(_,V,W,V.length),e(_,V,0,K+1),_.push(Y),tt.push(Y),e(tt,V,j,W+1));else{if(j>K&&(K+=L.length),et=Number.MAX_VALUE,K<j)return T;for(var J=j;J<=K;++J)c(l(V,W-1),l(V,W),l(V,J))&&r(l(V,W+1),l(V,W),l(V,J))&&(Z=i(l(V,W),l(V,J)),Z<et&&M(V,W,J)&&(et=Z,Q=J%L.length));W<Q?(e(_,V,W,Q+1),Q!==0&&e(tt,V,Q,nt.length),e(tt,V,0,W+1)):(W!==0&&e(_,V,W,nt.length),e(_,V,0,Q+1),e(tt,V,Q,W+1))}return _.length<tt.length?(A(_,T,E,R,F,O,G),A(tt,T,E,R,F,O,G)):(A(tt,T,E,R,F,O,G),A(_,T,E,R,F,O,G)),T}return T.push(L),T}function B(L,T){for(var E=0,R=L.length-1;L.length>3&&R>=0;--R)u(l(L,R-1),l(L,R),l(L,R+1),T)&&(L.splice(R%L.length,1),E++);return E}function b(L,T){for(var E=L.length-1;E>=1;--E)for(var R=L[E],F=E-1;F>=0;--F)if(k(R,L[F],T)){L.splice(E,1);continue}}function D(L,T,E){return E=E||0,Math.abs(L-T)<=E}function k(L,T,E){return D(L[0],T[0],E)&&D(L[1],T[1],E)}return ft}var Et=Mt();const bt=Pt(Et),Ct=[{id:1,name:"First Swing",par:2,balls:5,ball:{x:100,y:380},hole:{x:500,y:380},terrain:{curves:[{x:0,y:400},{x:200,y:400},{x:400,y:400},{x:600,y:400}]},hazards:[],obstacles:[],wind:{x:0,y:0},camera:{follow:!0,bounds:{minX:0,maxX:600}},background:{skyColor:"#87CEEB",hillColor:"#228B22",groundColor:"#8B4513"}},{id:2,name:"Rolling Hill",par:3,balls:5,ball:{x:80,y:320},hole:{x:700,y:380},terrain:{curves:[{x:0,y:350},{x:150,y:340},{x:300,y:280},{x:450,y:320},{x:600,y:400},{x:800,y:400}]},hazards:[],obstacles:[],wind:{x:0,y:0},camera:{follow:!0,bounds:{minX:0,maxX:800}}},{id:3,name:"Water Crossing",par:3,balls:5,ball:{x:80,y:350},hole:{x:750,y:360},terrain:{curves:[{x:0,y:380},{x:200,y:370},{x:300,y:420},{x:400,y:450},{x:500,y:420},{x:600,y:380},{x:800,y:380}]},hazards:[{type:"water",x:350,y:430,width:100,depth:40}],obstacles:[],wind:{x:0,y:0},camera:{follow:!0,bounds:{minX:0,maxX:850}}},{id:4,name:"Sky Bridge",par:3,balls:5,ball:{x:80,y:350},hole:{x:700,y:220},terrain:{curves:[{x:0,y:380},{x:200,y:380},{x:300,y:400},{x:500,y:450},{x:700,y:500},{x:900,y:500}],platforms:[{x:400,y:300,width:120,height:20,angle:0},{x:600,y:240,width:150,height:20,angle:0}]},hazards:[],obstacles:[],wind:{x:0,y:0},camera:{follow:!0,bounds:{minX:0,maxX:900}}},{id:5,name:"Desert Wind",par:4,balls:5,ball:{x:80,y:340},hole:{x:850,y:360},terrain:{curves:[{x:0,y:370},{x:200,y:360},{x:400,y:320},{x:550,y:380},{x:700,y:400},{x:900,y:380},{x:1e3,y:380}]},hazards:[{type:"sand",x:520,y:365,width:80,depth:20},{type:"wind",x:300,y:150,width:200,height:200,force:{x:3e-4,y:0}}],obstacles:[],wind:{x:1e-4,y:0},camera:{follow:!0,bounds:{minX:0,maxX:1e3}},background:{skyColor:"#F4A460",hillColor:"#DEB887",groundColor:"#8B4513"}},{id:6,name:"Pinball Valley",par:4,balls:5,ball:{x:80,y:300},hole:{x:800,y:380},terrain:{curves:[{x:0,y:340},{x:150,y:350},{x:350,y:450},{x:500,y:480},{x:650,y:450},{x:850,y:400},{x:950,y:400}]},hazards:[{type:"bouncer",x:300,y:320,width:15,height:80,angle:-20,restitution:1.3},{type:"bouncer",x:550,y:350,width:15,height:80,angle:20,restitution:1.3},{type:"water",x:420,y:465,width:80,depth:30}],obstacles:[],wind:{x:0,y:0},camera:{follow:!0,bounds:{minX:0,maxX:950}}},{id:7,name:"Rock Garden",par:4,balls:5,ball:{x:80,y:350},hole:{x:900,y:360},terrain:{curves:[{x:0,y:380},{x:250,y:370},{x:500,y:350},{x:750,y:380},{x:1e3,y:380}]},hazards:[{type:"sand",x:600,y:360,width:100,depth:25}],obstacles:[{type:"static",shape:"circle",x:300,y:340,radius:25},{type:"static",shape:"circle",x:450,y:320,radius:30},{type:"static",shape:"rectangle",x:700,y:350,width:40,height:40,angle:45}],wind:{x:0,y:0},camera:{follow:!0,bounds:{minX:0,maxX:1e3}}},{id:8,name:"The Gauntlet",par:5,balls:5,ball:{x:80,y:280},hole:{x:1050,y:350},terrain:{curves:[{x:0,y:320},{x:150,y:300},{x:300,y:380},{x:450,y:450},{x:600,y:400},{x:750,y:320},{x:900,y:380},{x:1100,y:370},{x:1200,y:370}],platforms:[{x:500,y:280,width:100,height:15,angle:-10}]},hazards:[{type:"water",x:400,y:435,width:100,depth:30},{type:"sand",x:700,y:300,width:80,depth:25},{type:"wind",x:800,y:150,width:150,height:200,force:{x:-3e-4,y:0}},{type:"bouncer",x:250,y:340,width:12,height:60,angle:15,restitution:1.2}],obstacles:[{type:"static",shape:"circle",x:600,y:360,radius:20}],wind:{x:0,y:0},camera:{follow:!0,bounds:{minX:0,maxX:1200}}},{id:9,name:"Pendulum Peril",par:5,balls:5,ball:{x:80,y:320},hole:{x:950,y:360},terrain:{curves:[{x:0,y:360},{x:200,y:350},{x:400,y:380},{x:600,y:400},{x:800,y:380},{x:1e3,y:380},{x:1100,y:380}]},hazards:[{type:"water",x:500,y:390,width:80,depth:25}],obstacles:[{type:"moving",shape:"circle",x:300,y:280,radius:25,path:[{x:300,y:280},{x:300,y:350}],speed:1.5},{type:"moving",shape:"rectangle",x:650,y:300,width:80,height:20,path:[{x:650,y:300},{x:650,y:370}],speed:1.2},{type:"moving",shape:"circle",x:850,y:250,radius:20,path:[{x:800,y:250},{x:900,y:250}],speed:2}],wind:{x:15e-5,y:0},camera:{follow:!0,bounds:{minX:0,maxX:1100}}},{id:10,name:"The Final Hole",par:6,balls:5,ball:{x:80,y:250},hole:{x:1100,y:300},terrain:{curves:[{x:0,y:300},{x:150,y:280},{x:300,y:350},{x:450,y:450},{x:600,y:480},{x:750,y:420},{x:900,y:350},{x:1050,y:320},{x:1200,y:320}],platforms:[{x:350,y:220,width:100,height:15,angle:0},{x:700,y:280,width:120,height:15,angle:5},{x:950,y:240,width:100,height:15,angle:-5}]},hazards:[{type:"water",x:500,y:465,width:120,depth:35},{type:"sand",x:850,y:335,width:80,depth:20},{type:"wind",x:200,y:100,width:150,height:150,force:{x:4e-4,y:0}},{type:"wind",x:700,y:100,width:150,height:180,force:{x:-3e-4,y:1e-4}},{type:"bouncer",x:400,y:380,width:15,height:70,angle:-25,restitution:1.4},{type:"bouncer",x:650,y:400,width:15,height:70,angle:25,restitution:1.4}],obstacles:[{type:"static",shape:"circle",x:250,y:320,radius:22},{type:"static",shape:"circle",x:550,y:420,radius:28},{type:"moving",shape:"circle",x:450,y:180,radius:20,path:[{x:400,y:180},{x:500,y:180}],speed:1.8},{type:"moving",shape:"rectangle",x:800,y:200,width:60,height:15,path:[{x:800,y:200},{x:800,y:280}],speed:1.3}],wind:{x:2e-4,y:0},camera:{follow:!0,bounds:{minX:0,maxX:1200}},background:{skyColor:"#FF7F50",hillColor:"#228B22",groundColor:"#654321"}}];function Rt(z){return Ct.find(m=>m.id===z)}function st(){return Ct.length}U.Common.setDecomp(bt);const H={BALL_RADIUS:12,BALL_DENSITY:.002,BALL_FRICTION:.12,BALL_RESTITUTION:.5,BALL_FRICTION_AIR:.01,MAX_PULL_DISTANCE:120,MAX_LAUNCH_SPEED:25,MIN_LAUNCH_SPEED:3,GRAVITY:1.25,TERRAIN_FRICTION:.45,SAND_FRICTION:2.5,TERRAIN_RESTITUTION:.3,HOLE_RADIUS:18,HOLE_DEPTH:40,BALL_STOP_SPEED:.2,BALL_STOP_DURATION:1800,CAMERA_SMOOTHING:.08,CAMERA_PADDING:100,TRAJECTORY_DOTS:25,TRAJECTORY_STEP:3};function at(z,m,g){return z+(m-z)*g}function St(z,m,g){return Math.max(m,Math.min(g,z))}function Dt(z,m,g,y){return Math.sqrt((g-z)**2+(y-m)**2)}function wt(z,m,g,y,c){const t=c*c,r=t*c;return .5*(2*m+(-z+g)*c+(2*z-5*m+4*g-y)*t+(-z+3*m-3*g+y)*r)}function kt(z,m){if(z.length<2)return z;const g=[];for(let y=0;y<z.length-1;y++){const c=z[Math.max(0,y-1)],t=z[y],r=z[Math.min(z.length-1,y+1)],o=z[Math.min(z.length-1,y+2)];for(let n=0;n<m;n++){const u=n/m;g.push({x:wt(c.x,t.x,r.x,o.x,u),y:wt(c.y,t.y,r.y,o.y,u)})}}return g.push(z[z.length-1]),g}class Ot{particles=[];emit(m,g,y,c,t=3){for(let r=0;r<c;r++){const o=Math.random()*Math.PI*2,n=Math.random()*t+1;this.particles.push({x:m,y:g,vx:Math.cos(o)*n,vy:Math.sin(o)*n-2,life:1,maxLife:1,size:3+Math.random()*4,color:y})}}update(m){for(let g=this.particles.length-1;g>=0;g--){const y=this.particles[g];y.x+=y.vx*m*60,y.y+=y.vy*m*60,y.vy+=.15*m*60,y.life-=.025*m*60,y.life<=0&&this.particles.splice(g,1)}}draw(m,g,y){for(const c of this.particles)m.globalAlpha=c.life,m.fillStyle=c.color,m.beginPath(),m.arc(c.x-g,c.y-y,c.size*c.life,0,Math.PI*2),m.fill();m.globalAlpha=1}clear(){this.particles=[]}}class Ft{canvas;ctx;width=0;height=0;isMobile;gameContainer;engine;world;gameState="START";currentLevelIndex=0;currentLevel=null;strokes=0;ballsRemaining=5;totalScore=0;unlockedLevels=1;ball=null;terrainBodies=[];platformBodies=[];hazardBodies=[];obstacleBodies=[];movingObstacles=[];holeSensor=null;holeSurface=null;sandZones=[];windZones=[];slingshotAnchor=null;aimTarget=null;aimBallPos=null;terrainGrass=[];isAiming=!1;aimStart=null;aimEnd=null;pullDistance=0;lastBallPosition={x:0,y:0};ballStoppedTime=0;ballInHole=!1;cameraX=0;cameraY=0;targetCameraX=0;targetCameraY=0;worldBounds={minX:0,maxX:800,minY:0,maxY:600};scale=1;particles;screenShake={x:0,y:0,intensity:0};audioContext=null;settings={music:!0,fx:!0,haptics:!0};startScreen;hud;levelCompleteScreen;gameOverScreen;settingsBtn;settingsPanel;settingsOverlay;powerMeter;powerFill;aimInfo;windIndicator;actionButtons;lastTime=0;physicsAccumulator=0;constructor(){console.log("[SlingshotGolfGame] Initializing"),this.isMobile=window.matchMedia("(pointer: coarse)").matches,this.gameContainer=document.getElementById("game-container"),this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.gameContainer.appendChild(this.canvas),this.startScreen=document.getElementById("start-screen"),this.hud=document.getElementById("hud"),this.levelCompleteScreen=document.getElementById("level-complete-screen"),this.gameOverScreen=document.getElementById("game-over-screen"),this.settingsBtn=document.getElementById("settings-btn"),this.settingsPanel=document.getElementById("settings-panel"),this.settingsOverlay=document.getElementById("settings-overlay"),this.powerMeter=document.getElementById("power-meter"),this.powerFill=document.getElementById("power-fill"),this.aimInfo=document.getElementById("aim-info"),this.windIndicator=document.getElementById("wind-indicator"),this.actionButtons=document.getElementById("action-buttons"),this.engine=U.Engine.create({gravity:{x:0,y:H.GRAVITY}}),this.engine.enableSleeping=!1,this.world=this.engine.world,this.particles=new Ot,this.loadSettings(),this.loadProgress(),this.setupCanvas(),this.setupEventListeners(),this.setupCollisionHandling(),this.renderLevelSelect(),this.render(),console.log("[SlingshotGolfGame] Initialization complete")}setupCanvas(){console.log("[SlingshotGolfGame.setupCanvas]"),this.resizeCanvas(),window.addEventListener("resize",()=>this.resizeCanvas())}resizeCanvas(){const m=this.gameContainer.getBoundingClientRect();this.width=m.width||window.innerWidth,this.height=m.height||window.innerHeight,this.canvas.width=this.width,this.canvas.height=this.height,this.scale=Math.min(this.width/800,this.height/500)}setupEventListeners(){console.log("[SlingshotGolfGame.setupEventListeners]"),document.getElementById("start-btn").addEventListener("click",()=>{this.triggerHaptic("light"),this.playSound("click"),this.startLevel(1)}),document.getElementById("next-btn").addEventListener("click",()=>{this.triggerHaptic("light"),this.playSound("click"),this.nextLevel()}),document.getElementById("retry-btn").addEventListener("click",()=>{this.triggerHaptic("light"),this.playSound("click"),this.restartLevel()}),document.getElementById("restart-btn").addEventListener("click",()=>{this.triggerHaptic("light"),this.playSound("click"),this.startLevel(1)}),document.getElementById("menu-btn").addEventListener("click",()=>{this.triggerHaptic("light"),this.showStartScreen()}),document.getElementById("skip-btn").addEventListener("click",()=>{this.triggerHaptic("light"),this.currentLevelIndex<st()&&this.nextLevel()}),document.getElementById("new-ball-btn").addEventListener("click",()=>{this.triggerHaptic("light"),this.resetBallToLastPosition()}),this.settingsBtn.addEventListener("click",()=>{this.triggerHaptic("light"),this.openSettings()}),document.getElementById("close-settings").addEventListener("click",()=>{this.triggerHaptic("light"),this.closeSettings()}),this.settingsOverlay.addEventListener("click",()=>{this.closeSettings()}),document.getElementById("toggle-music").addEventListener("click",m=>{this.settings.music=!this.settings.music,m.target.classList.toggle("active",this.settings.music),this.saveSettings(),this.triggerHaptic("light")}),document.getElementById("toggle-fx").addEventListener("click",m=>{this.settings.fx=!this.settings.fx,m.target.classList.toggle("active",this.settings.fx),this.saveSettings(),this.triggerHaptic("light")}),document.getElementById("toggle-haptics").addEventListener("click",m=>{this.settings.haptics=!this.settings.haptics,m.target.classList.toggle("active",this.settings.haptics),this.saveSettings(),this.triggerHaptic("light")}),this.canvas.addEventListener("mousedown",m=>this.handleInputStart(m.clientX,m.clientY)),this.canvas.addEventListener("mousemove",m=>this.handleInputMove(m.clientX,m.clientY)),this.canvas.addEventListener("mouseup",()=>this.handleInputEnd()),this.canvas.addEventListener("mouseleave",()=>this.handleInputEnd()),this.canvas.addEventListener("touchstart",m=>{m.preventDefault();const g=m.touches[0];this.handleInputStart(g.clientX,g.clientY)}),this.canvas.addEventListener("touchmove",m=>{m.preventDefault();const g=m.touches[0];this.handleInputMove(g.clientX,g.clientY)}),this.canvas.addEventListener("touchend",m=>{m.preventDefault(),this.handleInputEnd()})}setupCollisionHandling(){U.Events.on(this.engine,"collisionStart",m=>{for(const g of m.pairs)this.handleCollision(g)})}handleCollision(m){const{bodyA:g,bodyB:y}=m;if(!this.ball)return;const c=g===this.ball,t=y===this.ball;if(!c&&!t)return;const r=c?y:g;if(r===this.holeSensor){this.onBallInHole();return}if(r.label==="water"){this.onBallInWater();return}if(r.label==="bouncer"){this.playSound("bounce"),this.triggerHaptic("medium"),this.particles.emit(this.ball.position.x,this.ball.position.y,"#FFEB3B",8,4);return}(r.label==="terrain"||r.label==="platform")&&U.Body.getSpeed(this.ball)>5&&(this.playSound("hit"),this.triggerHaptic("light"),this.particles.emit(this.ball.position.x,this.ball.position.y,"#8B4513",4,2))}onBallInHole(){if(this.ballInHole)return;console.log("[SlingshotGolfGame.onBallInHole] Ball in hole!"),this.ballInHole=!0,this.gameState="LEVEL_COMPLETE",this.playSound("hole"),this.triggerHaptic("success"),this.particles.emit(this.currentLevel.hole.x,this.currentLevel.hole.y,"#FFD700",20,5),this.shakeScreen(.3);const m=this.currentLevel.par,g=this.strokes-m;this.totalScore+=g,this.currentLevelIndex>=this.unlockedLevels&&this.currentLevelIndex<st()&&(this.unlockedLevels=this.currentLevelIndex+1,this.saveProgress());const y=this.currentLevelIndex+1;setTimeout(()=>{y<st()?this.startLevel(y):this.showGameComplete()},900)}onBallInWater(){console.log("[SlingshotGolfGame.onBallInWater] Ball in water!"),this.playSound("splash"),this.triggerHaptic("error"),this.particles.emit(this.ball.position.x,this.ball.position.y,"#4FC3F7",15,4),this.strokes++,this.updateHUD(),setTimeout(()=>this.resetBallToLastPosition(),500)}resetBallToLastPosition(){if(this.ball){if(this.ballsRemaining--,this.ballsRemaining<=0){this.gameOver();return}U.Body.setPosition(this.ball,this.lastBallPosition),U.Body.setVelocity(this.ball,{x:0,y:0}),U.Body.setAngularVelocity(this.ball,0),this.slingshotAnchor={x:this.ball.position.x,y:this.ball.position.y},this.gameState="PLAYING",this.updateHUD()}}renderLevelSelect(){const m=document.getElementById("level-select");m.innerHTML="";for(let g=1;g<=st();g++){const y=document.createElement("button");y.className="level-btn",y.textContent=g.toString(),g>this.unlockedLevels?(y.classList.add("locked"),y.textContent="ðŸ”’"):g<this.unlockedLevels&&y.classList.add("completed"),g<=this.unlockedLevels&&y.addEventListener("click",()=>{this.triggerHaptic("light"),this.playSound("click"),this.startLevel(g)}),m.appendChild(y)}}startLevel(m){if(console.log("[SlingshotGolfGame.startLevel] Starting level",m),this.currentLevelIndex=m,this.currentLevel=Rt(m),!this.currentLevel){console.error("[SlingshotGolfGame.startLevel] Level not found:",m);return}this.strokes=0,this.ballsRemaining=this.currentLevel.balls,this.ballInHole=!1,this.ballStoppedTime=0,this.clearWorld(),this.buildTerrain(),this.buildHazards(),this.buildObstacles(),this.createHole(),this.createBall(),this.worldBounds={minX:this.currentLevel.camera.bounds.minX,maxX:this.currentLevel.camera.bounds.maxX,minY:this.currentLevel.camera.bounds.minY??0,maxY:this.currentLevel.camera.bounds.maxY??600};const g=this.worldBounds.maxX-this.worldBounds.minX,y=350;this.width>=g?this.cameraX=this.worldBounds.minX-(this.width-g)/2:this.cameraX=this.currentLevel.ball.x-this.width/2,this.cameraY=y-this.height/2,this.targetCameraX=this.cameraX,this.targetCameraY=this.cameraY,this.hideAllScreens(),this.hud.classList.remove("hidden"),this.settingsBtn.classList.remove("hidden"),this.actionButtons.classList.remove("hidden"),this.updateHUD(),this.updateWindIndicator(),this.initAudio(),this.gameState="PLAYING"}clearWorld(){console.log("[SlingshotGolfGame.clearWorld]"),U.Composite.clear(this.world,!1),this.terrainBodies=[],this.platformBodies=[],this.hazardBodies=[],this.obstacleBodies=[],this.movingObstacles=[],this.sandZones=[],this.windZones=[],this.ball=null,this.holeSensor=null,this.holeSurface=null,this.slingshotAnchor=null,this.aimTarget=null,this.aimBallPos=null,this.terrainGrass=[],this.particles.clear()}buildTerrain(){console.log("[SlingshotGolfGame.buildTerrain]");const m=this.currentLevel.terrain,g=kt(m.curves,10);this.terrainPoints=g;const y=this.currentLevel.hole;this.holeSurface=this.getSurfaceFromPoints(g,y.x);const c=H.HOLE_RADIUS*1.05,t=this.holeSurface.point.x,r=t-c,o=t+c;this.buildTerrainGrass(g),this.getSurfaceFromPoints(g,r).point,this.getSurfaceFromPoints(g,o).point;for(const l of g)l.x<=r||l.x>=o;if(m.platforms)for(const l of m.platforms){const h=U.Bodies.rectangle(l.x,l.y,l.width,l.height,{isStatic:!0,friction:l.friction??H.TERRAIN_FRICTION,restitution:l.restitution??H.TERRAIN_RESTITUTION,angle:(l.angle??0)*(Math.PI/180),label:"platform",render:{fillStyle:"#4CAF50"}});U.Composite.add(this.world,h),this.platformBodies.push(h)}const n=U.Bodies.rectangle(-50,300,100,1e3,{isStatic:!0,label:"wall"}),u=U.Bodies.rectangle(this.worldBounds.maxX+50,300,100,1e3,{isStatic:!0,label:"wall"}),i=U.Bodies.rectangle(this.worldBounds.maxX/2,-100,this.worldBounds.maxX+200,100,{isStatic:!0,label:"wall"});U.Composite.add(this.world,[n,u,i])}buildTerrainGrass(m){this.terrainGrass=[];const g=this.holeSurface?.point.x??Number.POSITIVE_INFINITY,y=H.HOLE_RADIUS*1.05;for(let c=0;c<m.length;c+=2){const t=m[c];if(Math.abs(t.x-g)<y)continue;const r=2+c%3;for(let o=0;o<r;o++){const n=(o-(r-1)/2)*6,u=4+(Math.sin(c*.7+o)*.5+.5)*6,i=Math.sin(c*.5+o)*2;this.terrainGrass.push({x:t.x+n,y:t.y,height:u,tilt:i})}}}addTerrainBody(m){if(m.length<2)return;const g=Math.max(...m.map(n=>n.y))+400,y=Math.min(...m.map(n=>n.x)),c=Math.max(...m.map(n=>n.x)),t=[{x:y,y:g},...m.map(n=>({x:n.x,y:n.y})),{x:c,y:g}],r=U.Vertices.centre(t),o=U.Bodies.fromVertices(r.x,r.y,t,{isStatic:!0,friction:H.TERRAIN_FRICTION,restitution:H.TERRAIN_RESTITUTION,label:"terrain",render:{fillStyle:"#228B22"}},!0);if(Array.isArray(o))for(const n of o)U.Composite.add(this.world,n),this.terrainBodies.push(n);else o&&(U.Composite.add(this.world,o),this.terrainBodies.push(o))}buildHazards(){console.log("[SlingshotGolfGame.buildHazards]");const m=this.currentLevel.hazards??[];for(const g of m)switch(g.type){case"water":{const y=U.Bodies.rectangle(g.x,g.y+(g.depth??20)/2,g.width,g.depth??20,{isStatic:!0,isSensor:!0,label:"water",render:{fillStyle:"#2196F3"}});U.Composite.add(this.world,y),this.hazardBodies.push(y);break}case"sand":{const y=U.Bodies.rectangle(g.x,g.y+(g.depth??15)/2,g.width,g.depth??15,{isStatic:!0,friction:H.SAND_FRICTION,label:"sand",render:{fillStyle:"#DEB887"}});U.Composite.add(this.world,y),this.hazardBodies.push(y),this.sandZones.push({x:g.x,y:g.y,width:g.width,body:y});break}case"wind":{this.windZones.push({x:g.x,y:g.y,width:g.width,height:g.height,force:g.force});break}case"bouncer":{const y=U.Bodies.rectangle(g.x,g.y,g.width,g.height,{isStatic:!0,restitution:g.restitution??1.3,angle:(g.angle??0)*(Math.PI/180),label:"bouncer",render:{fillStyle:"#FF5722"}});U.Composite.add(this.world,y),this.hazardBodies.push(y);break}}}buildObstacles(){console.log("[SlingshotGolfGame.buildObstacles]");const m=this.currentLevel.obstacles??[];for(const g of m)if(g.type==="static"){let y;g.shape==="circle"?y=U.Bodies.circle(g.x,g.y,g.radius??20,{isStatic:!0,friction:.5,restitution:.6,label:"obstacle",render:{fillStyle:"#757575"}}):y=U.Bodies.rectangle(g.x,g.y,g.width??30,g.height??30,{isStatic:!0,friction:.5,restitution:.6,angle:(g.angle??0)*(Math.PI/180),label:"obstacle",render:{fillStyle:"#757575"}}),U.Composite.add(this.world,y),this.obstacleBodies.push(y)}else if(g.type==="moving"){let y;g.shape==="circle"?y=U.Bodies.circle(g.x,g.y,g.radius??20,{isStatic:!0,friction:.5,restitution:.6,label:"moving_obstacle",render:{fillStyle:"#E91E63"}}):y=U.Bodies.rectangle(g.x,g.y,g.width??60,g.height??20,{isStatic:!0,friction:.5,restitution:.6,label:"moving_obstacle",render:{fillStyle:"#E91E63"}}),U.Composite.add(this.world,y),this.obstacleBodies.push(y),this.movingObstacles.push({body:y,path:g.path,speed:g.speed,progress:0,direction:1})}}createHole(){console.log("[SlingshotGolfGame.createHole]");const m=this.currentLevel.hole,g=this.holeSurface??this.getTerrainSurfaceAt(m.x);this.holeSurface=g;const y=g.point.x,c=g.point.y,t=H.HOLE_RADIUS*1.05,r=6,o=H.HOLE_DEPTH,n=c+o/2,u=U.Bodies.rectangle(y-t,n,r,o,{isStatic:!0,label:"hole-wall",render:{fillStyle:"#2b2b2b"}}),i=U.Bodies.rectangle(y+t,n,r,o,{isStatic:!0,label:"hole-wall",render:{fillStyle:"#2b2b2b"}}),l=U.Bodies.rectangle(y,c+o,t*2-r,r,{isStatic:!0,label:"hole-bottom",render:{fillStyle:"#1a1a1a"}});this.holeSensor=U.Bodies.circle(y,c+o-4,H.HOLE_RADIUS*.65,{isStatic:!0,isSensor:!0,label:"hole",render:{fillStyle:"transparent"}}),U.Composite.add(this.world,[u,i,l,this.holeSensor])}getSurfaceFromPoints(m,g){if(m.length<2)return{point:{x:g,y:this.currentLevel?.ball.y??400},normal:{x:0,y:-1}};let y=m[0],c=m[1];for(let e=0;e<m.length-1;e++){const s=m[e],a=m[e+1];if(g>=s.x&&g<=a.x){y=s,c=a;break}}g<m[0].x?(y=m[0],c=m[1]):g>m[m.length-1].x&&(y=m[m.length-2],c=m[m.length-1]);const t=c.x-y.x,r=t===0?0:(g-y.x)/t,o=y.y+r*(c.y-y.y),n=c.x-y.x,u=c.y-y.y,i=Math.hypot(n,u)||1;let l=-u/i,h=n/i;return h>0&&(l=-l,h=-h),{point:{x:g,y:o},normal:{x:l,y:h}}}getTerrainSurfaceAt(m){const g=this.terrainPoints;if(!g||g.length<2)return{point:{x:m,y:this.currentLevel?.ball.y??400},normal:{x:0,y:-1}};const y=this.getPhysicsSurfaceAt(m);return y||this.getSurfaceFromPoints(g,m)}getTerrainHeightAt(m){return this.getTerrainSurfaceAt(m).point.y}getPhysicsSurfaceAt(m){const g=[...this.terrainBodies,...this.platformBodies];if(g.length===0)return null;let y=Number.POSITIVE_INFINITY,c=null;for(const t of g){const r=t.vertices;for(let o=0;o<r.length;o++){const n=r[o],u=r[(o+1)%r.length],i=Math.min(n.x,u.x),l=Math.max(n.x,u.x);if(m<i||m>l)continue;const h=u.x-n.x;if(h===0)continue;const e=(m-n.x)/h;if(e<0||e>1)continue;const s=n.y+e*(u.y-n.y);if(s<y){y=s;const a=u.x-n.x;let v=-(u.y-n.y),P=a;const I=Math.hypot(v,P)||1;v/=I,P/=I,P>0&&(v=-v,P=-P),c={x:v,y:P}}}}return!c||y===Number.POSITIVE_INFINITY?null:{point:{x:m,y},normal:c}}createBall(){console.log("[SlingshotGolfGame.createBall]");const m=this.currentLevel.ball.x,g=this.getTerrainSurfaceAt(m),y=g.point.y+g.normal.y*(H.BALL_RADIUS+.5),c=g.point.x+g.normal.x*(H.BALL_RADIUS+.5);this.ball=U.Bodies.circle(c,y,H.BALL_RADIUS,{density:H.BALL_DENSITY,friction:H.BALL_FRICTION,restitution:H.BALL_RESTITUTION,frictionAir:H.BALL_FRICTION_AIR,label:"ball",render:{fillStyle:"#fff"}}),U.Composite.add(this.world,this.ball),this.lastBallPosition={x:this.ball.position.x,y:this.ball.position.y},this.slingshotAnchor={x:this.ball.position.x,y:this.ball.position.y}}handleInputStart(m,g){if(this.gameState!=="PLAYING"||!this.ball||!this.slingshotAnchor||U.Body.getSpeed(this.ball)>.4)return;const{x:c,y:t}=this.getPointerWorld(m,g);Dt(c,t,this.ball.position.x,this.ball.position.y)<60&&(this.isAiming=!0,this.aimStart={x:c,y:t},this.aimEnd={x:c,y:t},this.aimTarget={x:this.ball.position.x,y:this.ball.position.y},this.aimBallPos={x:this.ball.position.x,y:this.ball.position.y},this.gameState="AIMING",this.powerMeter.classList.add("visible"),this.aimInfo.classList.remove("hidden"),this.triggerHaptic("light"))}handleInputMove(m,g){if(!this.isAiming||!this.ball||!this.slingshotAnchor)return;const{x:y,y:c}=this.getPointerWorld(m,g);this.aimEnd={x:y,y:c};const t=y-this.slingshotAnchor.x,r=c-this.slingshotAnchor.y,o=Math.sqrt(t*t+r*r),n=Math.min(o,H.MAX_PULL_DISTANCE),u=o>0?t/o:0,i=o>0?r/o:0;this.pullDistance=n,this.aimTarget={x:this.slingshotAnchor.x+u*n,y:this.slingshotAnchor.y+i*n};const l=this.pullDistance/H.MAX_PULL_DISTANCE*100;this.powerFill.style.height=l+"%",this.aimInfo.textContent="Power: "+Math.round(l)+"%",this.aimInfo.classList.remove("hidden")}handleInputEnd(){!this.isAiming||!this.ball||(this.isAiming=!1,this.powerMeter.classList.remove("visible"),this.aimInfo.classList.add("hidden"),this.pullDistance>15?this.launchBall():this.gameState="PLAYING",this.pullDistance=0,this.aimTarget=null,this.aimBallPos=null)}getPointerWorld(m,g){const y=this.canvas.getBoundingClientRect(),c=m-y.left,t=g-y.top;return{x:c+this.cameraX,y:t+this.cameraY}}launchBall(){if(!this.ball||!this.slingshotAnchor)return;console.log("[SlingshotGolfGame.launchBall]"),this.lastBallPosition={x:this.ball.position.x,y:this.ball.position.y},this.aimTarget&&U.Body.setPosition(this.ball,this.aimTarget);const m=this.aimTarget??this.ball.position,g=this.slingshotAnchor.x-m.x,y=this.slingshotAnchor.y-m.y,c=Math.sqrt(g*g+y*y);if(c<1)return;const t=Math.min(1,this.pullDistance/H.MAX_PULL_DISTANCE),r=Math.pow(t,1.25),o=H.MIN_LAUNCH_SPEED+r*(H.MAX_LAUNCH_SPEED-H.MIN_LAUNCH_SPEED),n=g/c*o,u=y/c*o;U.Body.setVelocity(this.ball,{x:n,y:u}),U.Body.setSpeed(this.ball,Math.min(o,H.MAX_LAUNCH_SPEED)),this.strokes++,this.gameState="BALL_FLYING",this.ballStoppedTime=0,this.playSound("swing"),this.triggerHaptic("medium"),this.updateHUD()}updateMovingObstacles(m){for(const g of this.movingObstacles){g.progress+=g.speed*m*g.direction,g.progress>=1?(g.progress=1,g.direction=-1):g.progress<=0&&(g.progress=0,g.direction=1);const y=g.path[0],c=g.path[g.path.length-1],t=at(y.x,c.x,g.progress),r=at(y.y,c.y,g.progress);U.Body.setPosition(g.body,{x:t,y:r})}}applyWindForces(){if(!this.ball)return;const m=this.ball.position,g=this.currentLevel?.wind??{x:0,y:0};(g.x!==0||g.y!==0)&&U.Body.applyForce(this.ball,m,g);for(const y of this.windZones)m.x>y.x-y.width/2&&m.x<y.x+y.width/2&&m.y>y.y&&m.y<y.y+y.height&&U.Body.applyForce(this.ball,m,y.force)}updateAim(m){if(!this.ball||!this.isAiming||!this.aimTarget)return;this.aimBallPos||(this.aimBallPos={x:this.ball.position.x,y:this.ball.position.y});const g=1-Math.pow(1-.22,m*60);this.aimBallPos.x=at(this.aimBallPos.x,this.aimTarget.x,g),this.aimBallPos.y=at(this.aimBallPos.y,this.aimTarget.y,g),U.Body.setPosition(this.ball,this.aimBallPos),U.Body.setVelocity(this.ball,{x:0,y:0}),U.Body.setAngularVelocity(this.ball,0)}resolveTerrainCollision(){if(!this.ball||!this.currentLevel)return;const m=this.terrainPoints;if(!m||m.length<2)return;this.holeSurface||(this.holeSurface=this.getSurfaceFromPoints(m,this.currentLevel.hole.x));const g=this.holeSurface.point.x,y=this.holeSurface.point.y,c=H.HOLE_RADIUS*1.05;if(this.ball.position.x>g-c&&this.ball.position.x<g+c&&this.ball.position.y>y-H.BALL_RADIUS)return;const t=this.getSurfaceFromPoints(m,this.ball.position.x),r=t.normal,o=this.ball.position.x-t.point.x,n=this.ball.position.y-t.point.y,u=o*r.x+n*r.y;if(u<H.BALL_RADIUS){const i=H.BALL_RADIUS-u;U.Body.setPosition(this.ball,{x:this.ball.position.x+r.x*i,y:this.ball.position.y+r.y*i});const l=this.ball.velocity,h=l.x*r.x+l.y*r.y;if(h<0){const e=l.x-h*r.x,s=l.y-h*r.y,a=H.TERRAIN_FRICTION*.35,f=H.TERRAIN_RESTITUTION,v=e*(1-a)-h*r.x*f,P=s*(1-a)-h*r.y*f;U.Body.setVelocity(this.ball,{x:v,y:P})}}}checkBallStopped(m){if(!this.ball||this.gameState!=="BALL_FLYING")return;const g=U.Body.getSpeed(this.ball);if(this.holeSurface){const y=this.holeSurface.point.x,c=this.holeSurface.point.y,t=H.HOLE_RADIUS*1.05;if(Math.abs(this.ball.position.x-y)<t&&this.ball.position.y>c-H.HOLE_RADIUS){this.ballStoppedTime=0;return}}g<H.BALL_STOP_SPEED?(this.ballStoppedTime+=m*1e3,this.ballStoppedTime>H.BALL_STOP_DURATION&&(console.log("[SlingshotGolfGame.checkBallStopped] Ball stopped"),this.gameState="PLAYING",this.ballStoppedTime=0,this.slingshotAnchor={x:this.ball.position.x,y:this.ball.position.y})):this.ballStoppedTime=0}updateCamera(){if(!this.ball)return;const m=this.worldBounds.maxX-this.worldBounds.minX,g=this.worldBounds.maxY-this.worldBounds.minY;this.width>=m?this.targetCameraX=this.worldBounds.minX-(this.width-m)/2:(this.targetCameraX=this.ball.position.x-this.width/2,this.targetCameraX=St(this.targetCameraX,this.worldBounds.minX-H.CAMERA_PADDING,this.worldBounds.maxX-this.width+H.CAMERA_PADDING));const y=350;this.height>=g+200?this.targetCameraY=y-this.height/2:(this.targetCameraY=this.ball.position.y-this.height/2,this.targetCameraY=St(this.targetCameraY,-200,this.worldBounds.maxY-this.height/2)),this.cameraX=at(this.cameraX,this.targetCameraX,H.CAMERA_SMOOTHING),this.cameraY=at(this.cameraY,this.targetCameraY,H.CAMERA_SMOOTHING)}updateHUD(){document.getElementById("level-display").textContent=this.currentLevelIndex.toString(),document.getElementById("stroke-display").textContent=this.strokes.toString(),document.getElementById("par-display").textContent=this.currentLevel.par.toString();const m=document.getElementById("ball-counter");m.innerHTML="";for(let g=0;g<this.currentLevel.balls;g++){const y=document.createElement("div");y.className="ball-pip"+(g>=this.ballsRemaining?" used":""),m.appendChild(y)}}updateWindIndicator(){const m=this.currentLevel?.wind??{x:0,y:0};if(m.x===0&&m.y===0){this.windIndicator.classList.add("hidden");return}this.windIndicator.classList.remove("hidden");const g=document.getElementById("wind-arrow"),y=document.getElementById("wind-value"),c=Math.sqrt(m.x*m.x+m.y*m.y)*1e4,t=Math.atan2(m.y,m.x)*(180/Math.PI);g.style.transform="rotate("+t+"deg)",y.textContent=c.toFixed(1)}showLevelComplete(){console.log("[SlingshotGolfGame.showLevelComplete]");const m=this.currentLevel.par,g=this.strokes-m;document.getElementById("complete-strokes").textContent=this.strokes.toString(),document.getElementById("complete-par").textContent=m.toString();const y=document.getElementById("complete-result"),c=document.getElementById("complete-title");this.strokes===1?(c.textContent="HOLE IN ONE!",y.textContent="AMAZING!",y.className="score-result under"):g<0?(c.textContent="EXCELLENT!",y.textContent=g+" UNDER PAR",y.className="score-result under"):g===0?(c.textContent="NICE SHOT!",y.textContent="PAR",y.className="score-result even"):(c.textContent="LEVEL COMPLETE",y.textContent="+"+g+" OVER PAR",y.className="score-result over");const t=document.getElementById("next-btn");this.currentLevelIndex>=st()?t.classList.add("hidden"):t.classList.remove("hidden"),this.levelCompleteScreen.classList.add("visible"),this.hud.classList.add("hidden"),this.settingsBtn.classList.add("hidden"),this.actionButtons.classList.add("hidden")}nextLevel(){this.levelCompleteScreen.classList.remove("visible"),this.currentLevelIndex<st()?this.startLevel(this.currentLevelIndex+1):this.showGameComplete()}restartLevel(){this.levelCompleteScreen.classList.remove("visible"),this.startLevel(this.currentLevelIndex)}gameOver(){console.log("[SlingshotGolfGame.gameOver] Out of balls!"),this.gameState="GAME_OVER",this.playSound("fail"),this.triggerHaptic("error"),document.getElementById("total-score").textContent=(this.totalScore>=0?"+":"")+this.totalScore,this.gameOverScreen.classList.add("visible"),this.hud.classList.add("hidden"),this.settingsBtn.classList.add("hidden"),this.actionButtons.classList.add("hidden")}showGameComplete(){console.log("[SlingshotGolfGame.showGameComplete]"),this.submitScore(Math.max(0,100-this.totalScore*2)),document.getElementById("total-score").textContent=(this.totalScore>=0?"+":"")+this.totalScore,this.gameOverScreen.querySelector(".game-over-title").textContent="GAME COMPLETE!",this.gameOverScreen.classList.add("visible"),this.hud.classList.add("hidden"),this.settingsBtn.classList.add("hidden"),this.actionButtons.classList.add("hidden")}showStartScreen(){this.hideAllScreens(),this.renderLevelSelect(),this.startScreen.classList.remove("hidden"),this.gameState="START"}hideAllScreens(){this.startScreen.classList.add("hidden"),this.levelCompleteScreen.classList.remove("visible"),this.gameOverScreen.classList.remove("visible"),this.hud.classList.add("hidden"),this.settingsBtn.classList.add("hidden"),this.actionButtons.classList.add("hidden")}shakeScreen(m){this.screenShake.intensity=Math.max(this.screenShake.intensity,m)}updateScreenShake(){this.screenShake.intensity>0&&(this.screenShake.x=(Math.random()-.5)*this.screenShake.intensity*10,this.screenShake.y=(Math.random()-.5)*this.screenShake.intensity*10,this.screenShake.intensity*=.9,this.screenShake.intensity<.01&&(this.screenShake.intensity=0,this.screenShake.x=0,this.screenShake.y=0))}render=(m=0)=>{const g=Math.min((m-this.lastTime)/1e3,.1);if(this.lastTime=m,(this.gameState==="BALL_FLYING"||this.gameState==="AIMING"||this.gameState==="PLAYING")&&this.updateMovingObstacles(g),this.gameState==="BALL_FLYING"||this.gameState==="PLAYING"){this.physicsAccumulator+=g*1e3;const y=1e3/60;for(;this.physicsAccumulator>=y;)this.applyWindForces(),U.Engine.update(this.engine,y),this.physicsAccumulator-=y;this.resolveTerrainCollision(),this.checkBallStopped(g)}else this.gameState==="AIMING"&&this.updateAim(g);(this.gameState==="BALL_FLYING"||this.gameState==="AIMING"||this.gameState==="PLAYING")&&this.updateCamera(),this.particles.update(g),this.updateScreenShake(),this.ctx.save(),this.ctx.translate(this.screenShake.x,this.screenShake.y),this.drawBackground(),this.currentLevel&&(this.ctx.save(),this.ctx.translate(-this.cameraX,-this.cameraY),this.drawTerrain(),this.drawHazards(),this.drawObstacles(),this.drawHole(),this.drawBall(),this.isAiming&&(this.drawTrajectory(),this.drawSlingshot()),this.particles.draw(this.ctx,this.cameraX,this.cameraY),this.ctx.restore()),this.ctx.restore(),requestAnimationFrame(this.render)};drawBackground(){const g=(this.currentLevel?.background??{}).skyColor??"#87CEEB",y=this.ctx.createLinearGradient(0,0,0,this.height);y.addColorStop(0,g),y.addColorStop(1,this.adjustColor(g,-20)),this.ctx.fillStyle=y,this.ctx.fillRect(0,0,this.width,this.height),this.ctx.fillStyle="rgba(255, 255, 255, 0.7)";const c=[{x:100,y:80,r:40},{x:140,y:70,r:50},{x:180,y:85,r:35},{x:400,y:100,r:45},{x:450,y:90,r:55},{x:700,y:70,r:40},{x:750,y:80,r:50}];for(const t of c)this.ctx.beginPath(),this.ctx.arc(t.x-this.cameraX*.1,t.y,t.r,0,Math.PI*2),this.ctx.fill();this.ctx.fillStyle="rgba(100, 180, 100, 0.3)",this.ctx.beginPath(),this.ctx.moveTo(0,this.height);for(let t=0;t<=this.width;t+=50){const r=this.height-150+Math.sin(t*.01+this.cameraX*5e-4)*50;this.ctx.lineTo(t,r)}this.ctx.lineTo(this.width,this.height),this.ctx.fill()}drawTerrain(){const m=this.terrainPoints;if(!m||m.length<2)return;const g=this.currentLevel?.background??{},y=g.hillColor??"#228B22",c=g.groundColor??"#8B4513",t=this.currentLevel?.hole,r=t?this.holeSurface??this.getTerrainSurfaceAt(t.x):null,o=H.HOLE_RADIUS*1.05,n=r?r.point.x-o:Number.NEGATIVE_INFINITY,u=r?r.point.x+o:Number.POSITIVE_INFINITY,i=[],l=[];if(r){const e=this.getSurfaceFromPoints(m,n).point,s=this.getSurfaceFromPoints(m,u).point;for(const a of m)a.x<=n?i.push(a):a.x>=u&&l.push(a);i.length>0&&i.push(e),l.length>0&&l.unshift(s)}else i.push(...m);const h=e=>{if(!(e.length<2)){this.ctx.fillStyle=y,this.ctx.beginPath(),this.ctx.moveTo(e[0].x,e[0].y);for(const s of e)this.ctx.lineTo(s.x,s.y);this.ctx.lineTo(e[e.length-1].x,e[e.length-1].y+500),this.ctx.lineTo(e[0].x,e[0].y+500),this.ctx.closePath(),this.ctx.fill(),this.ctx.fillStyle=c,this.ctx.beginPath(),this.ctx.moveTo(e[0].x,e[0].y+20);for(const s of e)this.ctx.lineTo(s.x,s.y+20);this.ctx.lineTo(e[e.length-1].x,e[e.length-1].y+500),this.ctx.lineTo(e[0].x,e[0].y+500),this.ctx.closePath(),this.ctx.fill()}};h(i),h(l),this.ctx.strokeStyle="rgba(0, 100, 0, 0.3)",this.ctx.lineWidth=2;for(const e of this.terrainGrass)this.ctx.beginPath(),this.ctx.moveTo(e.x,e.y),this.ctx.lineTo(e.x+e.tilt,e.y-e.height),this.ctx.stroke();for(const e of this.platformBodies){const s=e.vertices;this.ctx.fillStyle="rgba(0, 0, 0, 0.2)",this.ctx.beginPath(),this.ctx.moveTo(s[0].x+3,s[0].y+3);for(let f=1;f<s.length;f++)this.ctx.lineTo(s[f].x+3,s[f].y+3);this.ctx.closePath(),this.ctx.fill();const a=this.ctx.createLinearGradient(e.position.x,e.position.y-10,e.position.x,e.position.y+10);a.addColorStop(0,"#4CAF50"),a.addColorStop(1,"#388E3C"),this.ctx.fillStyle=a,this.ctx.beginPath(),this.ctx.moveTo(s[0].x,s[0].y);for(let f=1;f<s.length;f++)this.ctx.lineTo(s[f].x,s[f].y);this.ctx.closePath(),this.ctx.fill(),this.ctx.strokeStyle="#2E7D32",this.ctx.lineWidth=2,this.ctx.stroke()}}drawHazards(){for(const m of this.hazardBodies){if(m.label==="water"){const g=m.bounds,y=g.max.x-g.min.x,c=g.max.y-g.min.y,t=this.ctx.createLinearGradient(g.min.x,g.min.y,g.min.x,g.max.y);t.addColorStop(0,"rgba(33, 150, 243, 0.7)"),t.addColorStop(1,"rgba(13, 71, 161, 0.9)"),this.ctx.fillStyle=t,this.ctx.fillRect(g.min.x,g.min.y,y,c),this.ctx.strokeStyle="rgba(255, 255, 255, 0.4)",this.ctx.lineWidth=2;const r=Date.now()/500;for(let o=0;o<3;o++){this.ctx.beginPath();for(let n=g.min.x;n<=g.max.x;n+=5){const u=g.min.y+5+o*6+Math.sin((n+r*50)*.05)*2;n===g.min.x?this.ctx.moveTo(n,u):this.ctx.lineTo(n,u)}this.ctx.stroke()}}if(m.label==="sand"){const g=m.bounds,y=g.max.x-g.min.x,c=g.max.y-g.min.y;this.ctx.fillStyle="#DEB887",this.ctx.fillRect(g.min.x,g.min.y,y,c),this.ctx.fillStyle="rgba(139, 90, 43, 0.3)";for(let t=0;t<10;t++){const r=g.min.x+Math.random()*y,o=g.min.y+Math.random()*c;this.ctx.beginPath(),this.ctx.arc(r,o,1+Math.random()*2,0,Math.PI*2),this.ctx.fill()}}if(m.label==="bouncer"){const g=m.vertices;this.ctx.fillStyle="rgba(255, 87, 34, 0.3)",this.ctx.beginPath(),this.ctx.moveTo(g[0].x,g[0].y);for(let c=1;c<g.length;c++)this.ctx.lineTo(g[c].x,g[c].y);this.ctx.closePath(),this.ctx.fill();const y=this.ctx.createLinearGradient(m.position.x-10,m.position.y,m.position.x+10,m.position.y);y.addColorStop(0,"#FF5722"),y.addColorStop(.5,"#FF8A65"),y.addColorStop(1,"#FF5722"),this.ctx.fillStyle=y,this.ctx.beginPath(),this.ctx.moveTo(g[0].x,g[0].y);for(let c=1;c<g.length;c++)this.ctx.lineTo(g[c].x,g[c].y);this.ctx.closePath(),this.ctx.fill(),this.ctx.strokeStyle="#E64A19",this.ctx.lineWidth=2,this.ctx.stroke()}}for(const m of this.windZones){this.ctx.fillStyle="rgba(135, 206, 235, 0.15)",this.ctx.fillRect(m.x-m.width/2,m.y,m.width,m.height);const g=4,y=Date.now()/1e3;this.ctx.strokeStyle="rgba(135, 206, 235, 0.5)",this.ctx.lineWidth=2;for(let c=0;c<g;c++){const t=(y*50+c*(m.width/g))%m.width-m.width/2,r=m.x+t,o=m.y+m.height/2+(c%2===0?-20:20),n=m.force.x>0?1:-1;this.ctx.beginPath(),this.ctx.moveTo(r-15*n,o),this.ctx.lineTo(r+15*n,o),this.ctx.lineTo(r+8*n,o-5),this.ctx.moveTo(r+15*n,o),this.ctx.lineTo(r+8*n,o+5),this.ctx.stroke()}}}drawObstacles(){for(const m of this.obstacleBodies){const g=m.label==="moving_obstacle",y=g?"#E91E63":"#757575",c=g?"#AD1457":"#424242";if(m.circleRadius){this.ctx.fillStyle="rgba(0, 0, 0, 0.2)",this.ctx.beginPath(),this.ctx.arc(m.position.x+3,m.position.y+3,m.circleRadius,0,Math.PI*2),this.ctx.fill();const t=this.ctx.createRadialGradient(m.position.x-m.circleRadius*.3,m.position.y-m.circleRadius*.3,0,m.position.x,m.position.y,m.circleRadius);t.addColorStop(0,this.adjustColor(y,20)),t.addColorStop(1,y),this.ctx.fillStyle=t,this.ctx.beginPath(),this.ctx.arc(m.position.x,m.position.y,m.circleRadius,0,Math.PI*2),this.ctx.fill(),this.ctx.strokeStyle=c,this.ctx.lineWidth=2,this.ctx.stroke()}else{const t=m.vertices;this.ctx.fillStyle="rgba(0, 0, 0, 0.2)",this.ctx.beginPath(),this.ctx.moveTo(t[0].x+3,t[0].y+3);for(let r=1;r<t.length;r++)this.ctx.lineTo(t[r].x+3,t[r].y+3);this.ctx.closePath(),this.ctx.fill(),this.ctx.fillStyle=y,this.ctx.beginPath(),this.ctx.moveTo(t[0].x,t[0].y);for(let r=1;r<t.length;r++)this.ctx.lineTo(t[r].x,t[r].y);this.ctx.closePath(),this.ctx.fill(),this.ctx.strokeStyle=c,this.ctx.lineWidth=2,this.ctx.stroke()}}}drawHole(){if(!this.currentLevel)return;const m=this.currentLevel.hole,g=this.holeSurface??this.getTerrainSurfaceAt(m.x),y=g.point.x,c=g.point.y,t=H.HOLE_DEPTH,r=H.HOLE_RADIUS*1.05,o=this.ctx.createLinearGradient(y,c,y,c+t);o.addColorStop(0,"#3a2416"),o.addColorStop(1,"#1c110b"),this.ctx.fillStyle=o,this.ctx.beginPath(),this.ctx.moveTo(y-r,c+1),this.ctx.lineTo(y+r,c+1),this.ctx.lineTo(y+r-2,c+t),this.ctx.lineTo(y-r+2,c+t),this.ctx.closePath(),this.ctx.fill(),this.ctx.fillStyle="#150e09",this.ctx.fillRect(y-r+1,c+t,r*2-2,600),this.ctx.fillStyle="#0c0c0c",this.ctx.beginPath(),this.ctx.ellipse(y,c+t,H.HOLE_RADIUS*.85,6,0,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle="#000",this.ctx.beginPath(),this.ctx.ellipse(y,c+2,H.HOLE_RADIUS,5.5,0,0,Math.PI*2),this.ctx.fill(),this.ctx.strokeStyle="#8B4513",this.ctx.lineWidth=3,this.ctx.beginPath(),this.ctx.moveTo(y,c+3),this.ctx.lineTo(y,c-60),this.ctx.stroke();const n=Date.now()/200,u=Math.sin(n)*3;this.ctx.fillStyle="#FF5722",this.ctx.beginPath(),this.ctx.moveTo(y,c-60),this.ctx.quadraticCurveTo(y+20+u,c-50,y+35+u*1.5,c-45),this.ctx.quadraticCurveTo(y+20+u,c-40,y,c-35),this.ctx.closePath(),this.ctx.fill(),this.ctx.strokeStyle="#E64A19",this.ctx.lineWidth=1,this.ctx.stroke()}drawBall(){if(!this.ball)return;const m=this.ball.position;this.ctx.fillStyle="rgba(0, 0, 0, 0.2)",this.ctx.beginPath(),this.ctx.ellipse(m.x,m.y+H.BALL_RADIUS+2,H.BALL_RADIUS*.8,4,0,0,Math.PI*2),this.ctx.fill();const g=this.ctx.createRadialGradient(m.x-H.BALL_RADIUS*.3,m.y-H.BALL_RADIUS*.3,0,m.x,m.y,H.BALL_RADIUS);g.addColorStop(0,"#ffffff"),g.addColorStop(.7,"#f0f0f0"),g.addColorStop(1,"#d0d0d0"),this.ctx.fillStyle=g,this.ctx.beginPath(),this.ctx.arc(m.x,m.y,H.BALL_RADIUS,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle="rgba(200, 200, 200, 0.5)";const y=this.ball.angle;for(let c=0;c<6;c++){const t=y+c/6*Math.PI*2,r=Math.cos(t)*H.BALL_RADIUS*.5,o=Math.sin(t)*H.BALL_RADIUS*.5;this.ctx.beginPath(),this.ctx.arc(m.x+r,m.y+o,2,0,Math.PI*2),this.ctx.fill()}this.ctx.fillStyle="rgba(255, 255, 255, 0.6)",this.ctx.beginPath(),this.ctx.arc(m.x-3,m.y-3,4,0,Math.PI*2),this.ctx.fill()}drawSlingshot(){if(!this.ball||!this.slingshotAnchor)return;const m=this.ball.position,g=this.slingshotAnchor;this.ctx.strokeStyle="#8B4513",this.ctx.lineWidth=4,this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.moveTo(g.x-10,g.y),this.ctx.lineTo(m.x,m.y),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(g.x+10,g.y),this.ctx.lineTo(m.x,m.y),this.ctx.stroke(),this.ctx.fillStyle="#5D4037",this.ctx.beginPath(),this.ctx.arc(g.x-10,g.y,6,0,Math.PI*2),this.ctx.fill(),this.ctx.beginPath(),this.ctx.arc(g.x+10,g.y,6,0,Math.PI*2),this.ctx.fill()}drawTrajectory(){if(!this.ball||!this.slingshotAnchor||this.pullDistance<10)return;const m=this.ball.position,g=this.slingshotAnchor.x-m.x,y=this.slingshotAnchor.y-m.y,c=Math.sqrt(g*g+y*y);if(c<1)return;const t=Math.min(1,this.pullDistance/H.MAX_PULL_DISTANCE),r=Math.pow(t,1.25),o=H.MIN_LAUNCH_SPEED+r*(H.MAX_LAUNCH_SPEED-H.MIN_LAUNCH_SPEED);let n=g/c*o,u=y/c*o,i=m.x,l=m.y;this.ctx.fillStyle="rgba(255, 255, 255, 0.5)";for(let h=0;h<H.TRAJECTORY_DOTS;h++){for(let s=0;s<H.TRAJECTORY_STEP;s++){i+=n,l+=u,u+=H.GRAVITY*.02;const a=this.currentLevel?.wind??{x:0,y:0};n+=a.x*100,u+=a.y*100}const e=1-h/H.TRAJECTORY_DOTS;if(this.ctx.globalAlpha=e*.6,this.ctx.beginPath(),this.ctx.arc(i,l,4*e+2,0,Math.PI*2),this.ctx.fill(),l>this.worldBounds.maxY)break}this.ctx.globalAlpha=1}adjustColor(m,g){const y=m.replace("#",""),c=Math.max(0,Math.min(255,parseInt(y.substring(0,2),16)+g)),t=Math.max(0,Math.min(255,parseInt(y.substring(2,4),16)+g)),r=Math.max(0,Math.min(255,parseInt(y.substring(4,6),16)+g));return"#"+[c,t,r].map(o=>o.toString(16).padStart(2,"0")).join("")}initAudio(){if(!this.audioContext)try{this.audioContext=new(window.AudioContext||window.webkitAudioContext),console.log("[SlingshotGolfGame.initAudio] Audio context initialized")}catch(m){console.warn("[SlingshotGolfGame.initAudio] Failed:",m)}}playSound(m){if(!this.settings.fx||!this.audioContext)return;const g=this.audioContext,y=g.currentTime,c=g.createOscillator(),t=g.createGain();switch(c.connect(t),t.connect(g.destination),m){case"click":c.frequency.value=800,c.type="sine",t.gain.setValueAtTime(.1,y),t.gain.exponentialRampToValueAtTime(.01,y+.05),c.start(y),c.stop(y+.05);break;case"swing":c.frequency.setValueAtTime(200,y),c.frequency.exponentialRampToValueAtTime(500,y+.1),c.type="sawtooth",t.gain.setValueAtTime(.12,y),t.gain.exponentialRampToValueAtTime(.01,y+.15),c.start(y),c.stop(y+.15);break;case"hit":c.frequency.value=150,c.type="triangle",t.gain.setValueAtTime(.08,y),t.gain.exponentialRampToValueAtTime(.01,y+.08),c.start(y),c.stop(y+.1);break;case"bounce":c.frequency.setValueAtTime(400,y),c.frequency.exponentialRampToValueAtTime(600,y+.05),c.type="square",t.gain.setValueAtTime(.1,y),t.gain.exponentialRampToValueAtTime(.01,y+.1),c.start(y),c.stop(y+.1);break;case"splash":const r=g.sampleRate*.2,o=g.createBuffer(1,r,g.sampleRate),n=o.getChannelData(0);for(let h=0;h<r;h++)n[h]=(Math.random()*2-1)*Math.exp(-h/(g.sampleRate*.05));const u=g.createBufferSource();u.buffer=o;const i=g.createBiquadFilter();i.type="lowpass",i.frequency.value=800,u.connect(i),i.connect(t),t.gain.setValueAtTime(.15,y),t.gain.exponentialRampToValueAtTime(.01,y+.2),u.start(y);return;case"hole":[523,659,784,1047].forEach((h,e)=>{const s=g.createOscillator(),a=g.createGain();s.type="triangle",s.frequency.value=h,a.gain.setValueAtTime(.1,y+e*.1),a.gain.exponentialRampToValueAtTime(.01,y+e*.1+.2),s.connect(a),a.connect(g.destination),s.start(y+e*.1),s.stop(y+e*.1+.25)});return;case"fail":c.frequency.setValueAtTime(300,y),c.frequency.exponentialRampToValueAtTime(100,y+.3),c.type="sawtooth",t.gain.setValueAtTime(.1,y),t.gain.exponentialRampToValueAtTime(.01,y+.3),c.start(y),c.stop(y+.35);break}}triggerHaptic(m){this.settings.haptics&&typeof window.triggerHaptic=="function"&&window.triggerHaptic(m)}submitScore(m){console.log("[SlingshotGolfGame.submitScore]",m),typeof window.submitScore=="function"&&window.submitScore(m)}loadSettings(){try{const m=localStorage.getItem("slingshot-golf-settings");m&&(this.settings={...this.settings,...JSON.parse(m)})}catch(m){console.warn("[SlingshotGolfGame.loadSettings] Failed:",m)}document.getElementById("toggle-music").classList.toggle("active",this.settings.music),document.getElementById("toggle-fx").classList.toggle("active",this.settings.fx),document.getElementById("toggle-haptics").classList.toggle("active",this.settings.haptics)}saveSettings(){try{localStorage.setItem("slingshot-golf-settings",JSON.stringify(this.settings))}catch(m){console.warn("[SlingshotGolfGame.saveSettings] Failed:",m)}}loadProgress(){try{const m=localStorage.getItem("slingshot-golf-progress");if(m){const g=JSON.parse(m);this.unlockedLevels=g.unlockedLevels??1}}catch(m){console.warn("[SlingshotGolfGame.loadProgress] Failed:",m)}}saveProgress(){try{localStorage.setItem("slingshot-golf-progress",JSON.stringify({unlockedLevels:this.unlockedLevels}))}catch(m){console.warn("[SlingshotGolfGame.saveProgress] Failed:",m)}}openSettings(){this.settingsPanel.classList.add("visible"),this.settingsOverlay.classList.add("visible")}closeSettings(){this.settingsPanel.classList.remove("visible"),this.settingsOverlay.classList.remove("visible")}}document.addEventListener("DOMContentLoaded",()=>{console.log("[main] Initializing Slingshot Golf"),new Ft});</script>
</head>
<body>
  <div id="game-container">
    <!-- Start Screen -->
    <div id="start-screen">
      <div class="title-container">
        <h1 class="game-title">SLINGSHOT GOLF</h1>
        <p class="subtitle">Drag, Aim, Swing!</p>
      </div>
      <div class="golf-preview">
        <div class="preview-ball"></div>
        <div class="preview-flag">
          <div class="flag-pole"></div>
          <div class="flag-cloth"></div>
        </div>
      </div>
      <button class="start-btn" id="start-btn">PLAY</button>
      <div class="level-select" id="level-select"></div>
    </div>
    
    <!-- HUD -->
    <div id="hud" class="hidden">
      <div class="hud-left">
        <span class="hud-label">Level</span>
        <span class="hud-value" id="level-display">1</span>
      </div>
      <div class="hud-center">
        <span class="hud-label">Strokes</span>
        <div class="stroke-display">
          <span class="stroke-current" id="stroke-display">0</span>
          <span class="stroke-par">/ PAR <span id="par-display">3</span></span>
        </div>
      </div>
      <div class="hud-right">
        <span class="hud-label">Balls</span>
        <div class="ball-counter" id="ball-counter"></div>
      </div>
    </div>
    
    <!-- Wind Indicator -->
    <div id="wind-indicator" class="hidden">
      <span class="wind-label">Wind</span>
      <span class="wind-arrow" id="wind-arrow">â†’</span>
      <span class="wind-value" id="wind-value">0</span>
    </div>
    
    <!-- Power Meter -->
    <div id="power-meter">
      <div class="power-fill" id="power-fill"></div>
    </div>
    
    <!-- Aim Info -->
    <div id="aim-info" class="hidden"></div>
    
    <!-- Action Buttons -->
    <div class="action-buttons hidden" id="action-buttons">
      <button class="action-btn" id="new-ball-btn">
        <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2"/><path d="M12 8v8M8 12h8" stroke="currentColor" stroke-width="2"/></svg>
        BALL
      </button>
      <button class="action-btn" id="skip-btn">
        <svg viewBox="0 0 24 24"><path d="M5 4l10 8-10 8V4zm11 0h3v16h-3V4z"/></svg>
        SKIP
      </button>
    </div>
    
    <!-- Settings Button -->
    <button id="settings-btn" class="hidden">
      <svg viewBox="0 0 24 24"><path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/></svg>
    </button>
    
    <!-- Settings Overlay -->
    <div id="settings-overlay"></div>
    
    <!-- Settings Panel -->
    <div id="settings-panel">
      <h2 class="settings-title">SETTINGS</h2>
      <div class="setting-row">
        <span class="setting-label">Music</span>
        <button class="toggle-btn active" id="toggle-music"></button>
      </div>
      <div class="setting-row">
        <span class="setting-label">Sound FX</span>
        <button class="toggle-btn active" id="toggle-fx"></button>
      </div>
      <div class="setting-row">
        <span class="setting-label">Haptics</span>
        <button class="toggle-btn active" id="toggle-haptics"></button>
      </div>
      <button class="close-settings-btn" id="close-settings">DONE</button>
    </div>
    
    <!-- Level Complete Screen -->
    <div id="level-complete-screen">
      <div class="complete-title" id="complete-title">HOLE IN ONE!</div>
      <div class="score-summary">
        <div class="score-row">
          <div class="score-item">
            <div class="score-label">Strokes</div>
            <div class="score-value" id="complete-strokes">3</div>
          </div>
          <div class="score-item">
            <div class="score-label">Par</div>
            <div class="score-value" id="complete-par">3</div>
          </div>
        </div>
        <div class="score-result" id="complete-result">PAR</div>
      </div>
      <div>
        <button class="next-btn" id="next-btn">NEXT LEVEL</button>
        <button class="retry-btn" id="retry-btn">RETRY</button>
      </div>
    </div>
    
    <!-- Game Over Screen -->
    <div id="game-over-screen">
      <div class="game-over-title">GAME COMPLETE!</div>
      <div class="total-score" id="total-score">+5</div>
      <div class="total-label">Total Score (vs Par)</div>
      <div>
        <button class="retry-btn" id="restart-btn">PLAY AGAIN</button>
        <button class="menu-btn" id="menu-btn">MENU</button>
      </div>
    </div>
  </div>
  
</body>
</html>
